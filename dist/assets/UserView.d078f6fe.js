import{B as O}from"./BreadCrumb.9367f10a.js";import{a as k,c as F,b as V,d as A,e as L,f as P,g as N}from"./form.181df029.js";import{D as G}from"./text-area.c45c04d3.js";import{_ as j}from"./tab-panel.6a570691.js";import{_ as Z,D as z}from"./toolbar.58f20e48.js";import{n as b}from"./notify.250f5449.js";import{D as J,a as M}from"./progress-bar.d98eaefe.js";import{D as H,a as q,b as K,e as Q}from"./data-grid.24b081de.js";import{C as W}from"./index.3bbb47f2.js";import{c as f,p as _,_ as I}from"./index.7b655b97.js";import{r as a,o as S,a as v,f as t,w as n,c as l}from"./vendor.7710df40.js";import{g}from"./notifySetting.1837b01c.js";import{p as w}from"./personsRepository.d2cb1535.js";import"./utils.scroll.55667bed.js";import"./toast.a475c820.js";const X="https://kameyo-api.azurewebsites.net",y=`${X}/api/users`,Y={name:"UserRolesTab",components:{DxDataGrid:H,DxColumn:q,DxScrolling:K,DxEditing:Q},props:{userId:{type:String}},data(){return{userRoles:new W({key:"roleId",load:this.loadRoles,update:(e,o)=>this.updateUserRoles({key:e,values:o}),errorHandler:e=>{console.log(e.message)}})}},methods:{async loadRoles(){return await this.loadDataFetch(`${y}/${this.userId}/roles`).then(e=>(console.log("loadRoles - data -",e),e))},async loadDataFetch(e){return await fetch(`${e}`).then(f).then(_).then(o=>(console.log(`loadDataFetch -> ${e}`,o),o))},async updateUserRoles(e={}){console.log("updateUserRoles - data ->",e);var o={userId:this.userId,roleId:e.key,roleSelected:e.values.roleSelected};fetch(`${y}/${this.userId}/roles`,{method:"PUT",body:JSON.stringify(o),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(async s=>{if(console.log("updateUser - result ",s),s.ok){const r=await s.text();return r&&JSON.parse(r)}throw(await s.json()).Message})}},mounted(){console.log("props - data ->",this.userId)}};function ee(e,o,s,p,r,h){const c=a("DxEditing"),i=a("DxColumn"),u=a("DxScrolling"),d=a("DxDataGrid");return S(),v("div",null,[t(d,{id:"dataGridUserRolesTab","key-expr":"roleId","show-borders":!0,"data-source":r.userRoles,"repaint-changes-only":!0},{default:n(()=>[t(c,{"refresh-mode":e.refreshMode,"allow-updating":!0,mode:"cell"},null,8,["refresh-mode"]),t(i,{"data-field":"userId",caption:"UserId",visible:!1}),t(i,{"data-field":"roleId",caption:"RoleId",visible:!1}),t(i,{"data-field":"roleName",caption:"Rol","data-type":"string","allow-editing":!1}),t(i,{"data-field":"roleSelected",caption:"Rol Seleccionado","data-type":"boolean"}),t(u,{mode:"virtual"})]),_:1},8,["data-source"])])}var oe=I(Y,[["render",ee]]);const te=await w.GetPersonTypes(),se=await w.GetPersonLookUp(),D="https://kameyo-api.azurewebsites.net",T=`${D}/api/users`,ae=`${D}/api/roles`,re=`${D}/api/Files/Images/profiles/users/2863ae38-9aba-4551-a4b2-7cd8b6e4d2cf`,ne={name:"UserView",components:{BreadCrumb:O,DxForm:k,DxTextArea:G,DxGroupItem:F,DxSimpleItem:V,DxLabel:A,DxToolbar:Z,DxItemToolbar:z,DxTabPanel:j,UserRoleTemplate:oe,DxTabbedItem:L,DxTabPanelOptions:P,DxTab:N,DxFileUploader:J,DxProgressBar:M},data(){return{isDropZoneActive:!1,imageSource:"",textVisible:!0,progressVisible:!1,progressValue:0,allowedFileExtensions:[".jpg",".jpeg",".gif",".png"],uploadUrl:re,personTypeEmployee:"f35d8016-c93b-4a05-9301-4c228d639a02",personTypeContact:"f11d7e55-f12e-4214-b100-0989b38f66bc",personTypeDS:te,personDS:se,rolesDS:[],selectedIndex:0,loop:!1,animationEnabled:!0,swipeEnabled:!0,tabs:[{tabName:"Roles",tabTitle:"Roles"}],backButtonOptions:{type:"back",onClick:()=>{this.$router.push({name:"usersView"})}},refreshButtonOptions:{icon:"refresh",onClick:()=>{location.reload()}},addButtonOptions:{icon:"plus",text:"Nuevo",onClick:()=>{this.$router.push({name:"userCreateView"})}},saveButtonOptions:{text:"Grabar",onClick:this.updateUser},formData:{}}},methods:{onDropZoneEnter(e){e.dropZoneElement.id==="dropzone-external"&&(this.isDropZoneActive=!0)},onDropZoneLeave(e){e.dropZoneElement.id==="dropzone-external"&&(this.isDropZoneActive=!1)},onUploaded(e){console.log("onUploaded - ",e);const{file:o}=e,s=new FileReader;s.onload=()=>{this.isDropZoneActive=!1,this.imageSource=s.result},s.readAsDataURL(o),this.textVisible=!1,this.progressVisible=!1,this.progressValue=0},onProgress(e){this.progressValue=e.bytesLoaded/e.bytesTotal*100},onUploadStarted(){this.imageSource="",this.progressVisible=!0},fieldDataChanged:function(e){if(e.dataField==="personTypeId"){var o=e.component.getEditor("personId");let s=o.getDataSource(),p=this.personTypeContact==e.value?e.value:this.personTypeEmployee;s.filter([["personTypeId","=",e.value],"or",["personTypeId","=",p]]),s.load(),o.reset()}},updateUser(){var e={id:this.$route.params.id,email:this.formData.email,personTypeId:this.formData.personTypeId,personId:this.formData.personId};fetch(`${T}/${e.id}`,{method:"PUT",body:JSON.stringify(e),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(f).then(_).then(o=>{if(console.log("data",o),o.succeeded)return b(g("El registro se actualizo correctamente.")),o;b(g("El registro no se actualizo correctamente.","error"))})},async loadRoles(){return await this.loadDataFetch(`${ae}`).then(o=>o.data.data)},async loadDataFetch(e){return await fetch(`${e}`).then(f).then(_).then(o=>o)},async loadEntity(e){const o=await this.loadDataFetch(`${T}/${e}`).then(s=>s);o.succeeded&&o.status==200&&(this.formData=o.data[0])}},async mounted(){this.rolesDS=await this.loadRoles();var e=this.$route.params.id;await this.loadEntity(e)}},ie={id:"main-content"},le={class:"container-fluid"},de={class:"block-header"},pe={class:"row clearfix"},ce={class:"col-md-12"},ue={class:"card"},me={class:"header"},fe={class:"body"};function _e(e,o,s,p,r,h){const c=a("bread-crumb"),i=a("DxItemToolbar"),u=a("DxToolbar"),d=a("DxSimpleItem"),x=a("DxLabel"),m=a("DxGroupItem"),R=a("DxTabPanelOptions"),U=a("UserRoleTemplate"),E=a("DxTab"),B=a("DxTabbedItem"),C=a("DxForm");return S(),v("div",ie,[l("div",le,[l("div",de,[t(c)]),l("div",pe,[l("div",ce,[l("div",ue,[l("div",me,[t(u,null,{default:n(()=>[t(i,{options:r.backButtonOptions,location:"before",widget:"dxButton"},null,8,["options"]),t(i,{options:r.refreshButtonOptions,location:"before",widget:"dxButton"},null,8,["options"]),t(i,{options:r.addButtonOptions,location:"after","locate-in-menu":"auto",widget:"dxButton"},null,8,["options"]),t(i,{options:r.saveButtonOptions,location:"after","locate-in-menu":"auto",widget:"dxButton"},null,8,["options"])]),_:1})]),l("div",fe,[t(C,{"form-data":r.formData,"onUpdate:form-data":o[0]||(o[0]=$=>r.formData=$),onFieldDataChanged:h.fieldDataChanged},{default:n(()=>[t(m,{"col-count":4,"css-class":"first-group"},{default:n(()=>[t(m,{"col-span":3},{default:n(()=>[t(d,{"data-field":"email"}),t(d,{"data-field":"personTypeId","editor-type":"dxSelectBox","editor-options":{items:r.personTypeDS,displayExpr:"name",valueExpr:"id",showClearButton:!0}},{default:n(()=>[t(x,{text:"Tipo de usuario"})]),_:1},8,["editor-options"]),t(d,{"data-field":"personId","editor-type":"dxSelectBox","editor-options":{items:r.personDS,displayExpr:"fullName",valueExpr:"id",searchEnabled:!0,showClearButton:!0}},{default:n(()=>[t(x,{text:"Persona"})]),_:1},8,["editor-options"])]),_:1})]),_:1}),t(m,{"col-count":2,"css-class":"second-group"},{default:n(()=>[t(B,{"col-span":2},{default:n(()=>[t(R,{"defer-rendering":!1}),t(E,{title:"Roles"},{default:n(()=>[t(U,{"user-id":this.$route.params.id},null,8,["user-id"])]),_:1})]),_:1})]),_:1})]),_:1},8,["form-data","onFieldDataChanged"])])])])])])])}var Ce=I(ne,[["render",_e]]);export{Ce as default};
