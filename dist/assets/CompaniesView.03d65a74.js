import{B as ie}from"./BreadCrumb.9367f10a.js";import{D as V,a as A,b as M,c as $,d as j,e as L,f as U,g as B,h as z,i as O,j as H,k as re,l as de,m as le,n as se}from"./data-grid.24b081de.js";import{D as J}from"./form.181df029.js";import{C as T}from"./index.3bbb47f2.js";import{e as ue,F as ce}from"./FileSaver.min.34d9f25a.js";import{e as pe}from"./excel_exporter.6e076f26.js";import{R as P}from"./RepositoryFactory.1ead146f.js";import{r as o,o as Y,a as W,f as t,w as i,c as h}from"./vendor.7710df40.js";import{_ as K}from"./index.7b655b97.js";const y=P.get("catalogs"),Q="https://kameyo-api.azurewebsites.net",_=`${Q}/api/Subsidiaries`,F=`${Q}/api/Company`,me=await y.Get("NAME","COUNTRIES"),G=await y.Get("NAME","STATES"),k=await y.Get("NAME","CITY"),ge=await y.Get("NAME","IDENTIFICATIONTYPE");function xe(e){return e!=null&&e!==""}const _e={components:{DxDataGrid:V,DxColumn:A,DxScrolling:M,DxPager:$,DxPaging:j,DxEditing:L,DxRequiredRule:U,DxPopup:B,DxLookup:z,DxFilterRow:O,DxForm:H,DxItem:J},props:{templateData:{type:Object,default:()=>{}}},data(){return{dataSource:new T({key:"id",load:e=>{e.filter?(e.filter.push("and"),e.filter.push(["CompanyId","=",this.templateData.key])):e.filter=["CompanyId","=",this.templateData.key];let a={};return["skip","take","requireTotalCount","requireGroupCount","sort","filter","totalSummary","group","groupSummary"].forEach(n=>{n in e&&xe(e[n])&&(a[n]=JSON.stringify(e[n]))}),console.log("SubsidiaryDetailTemplate - params -> ",a),this.sendRequest(`${_}/filter`,"GET",a).then(n=>(console.log("data",n),n))},insert:e=>this.sendRequest(`${_}`,"POST",{values:JSON.stringify(e)}),update:(e,a)=>(a.id=e,this.sendRequest(`${_}`,"PUT",{key:e,values:JSON.stringify(a)})),remove:e=>this.sendRequest(`${_}/${e}`,"DELETE",{}),byKey:e=>this.sendRequest(`${_}`,"GET",{Field:"ID",Value:e}).then(a=>a)}),country:me.data.data,state:G.data.data,city:k.data.data,company:new T({key:"id",load:()=>this.sendRequest(`${F}/paginated`,"GET",{}).then(e=>e),byKey:e=>this.sendRequest(`${F}`,"GET",{Field:"ID",Value:e}).then(a=>a)}),catalogTypes:ge.data.data,setCountryValue(e,a){this.defaultSetCellValue(e,a)},setStateValue(e,a){e.catalogRegionCityId=null,this.defaultSetCellValue(e,a)}}},methods:{onEditorPreparing(e){e.parentType==="dataRow"&&e.dataField},async sendRequest(e,a="GET",n={}){const x=Object.keys(n).map(d=>`${encodeURIComponent(d)}=${encodeURIComponent(n[d])}`).join("&");if(a==="GET"){console.log("params",x);const d=await fetch(`${e}?${x}`,{method:a}),p=await d.json();if(d.ok)return p.data;throw p.Message}const r=await fetch(e,{method:a,body:n.values,headers:{"Content-Type":"application/json;charset=UTF-8"}});if(r.ok)return r.text().then(d=>d&&JSON.parse(d));throw(await r.json()).Message},getFilteredStates:e=>({store:G.data.data,filter:e.data?["parentId","=",e.data.catalogRegionCountryId]:null}),getFilteredCities:e=>({store:k.data.data,filter:e.data?["parentId","=",e.data.catalogRegionStateId]:null}),getCatalogs:async function(e,a){const{data:n}=await y.Get(e,a);return n.data}}};function ye(e,a,n,x,r,u){const d=o("DxFilterRow"),p=o("DxScrolling"),I=o("DxPaging"),S=o("DxPager"),R=o("DxPopup"),l=o("DxItem"),E=o("DxForm"),v=o("DxEditing"),s=o("DxColumn"),m=o("DxLookup"),D=o("DxRequiredRule"),b=o("DxDataGrid");return Y(),W("div",null,[t(b,{id:"dataGridSubsidiaryTemplate","data-source":r.dataSource,"show-borders":!0,"repaint-changes-only":!0,"remote-operations":!0,"key-expr":"id",onEditorPreparing:u.onEditorPreparing},{default:i(()=>[t(d,{visible:!0}),t(p,{"row-rendering-mode":"virtual"}),t(I,{"page-size":10}),t(S,{visible:!0,"allowed-page-sizes":[10,20,50],"display-mode":e.displayMode,"show-page-size-selector":!0,"show-info":!1,"show-navigation-buttons":!0},null,8,["display-mode"]),t(v,{"refresh-mode":e.full,"allow-updating":!0,"allow-adding":!0,"allow-deleting":!0,mode:"popup"},{default:i(()=>[t(R,{"show-title":!0,width:700,height:525,title:"Subsidiary Info"}),t(E,null,{default:i(()=>[t(l,{"col-count":1,"col-span":2,"item-type":"group"},{default:i(()=>[t(l,{"data-field":"name"}),t(l,{"data-field":"catalogTypeId"}),t(l,{"data-field":"numberId"}),t(l,{"data-field":"companyId"})]),_:1}),t(l,{"col-count":2,"col-span":2,"item-type":"group",caption:"Home Address"},{default:i(()=>[t(l,{"data-field":"catalogRegionCountryId"}),t(l,{"data-field":"catalogRegionStateId"}),t(l,{"data-field":"catalogRegionCityId"}),t(l,{"data-field":"address"})]),_:1})]),_:1})]),_:1},8,["refresh-mode"]),t(s,{width:150,"data-field":"numberId","data-type":"number",caption:"No. Identificaci\xF3n"}),t(s,{width:0,"data-field":"catalogTypeId",caption:"Tipo Identificaci\xF3n"},{default:i(()=>[t(m,{"data-source":r.catalogTypes,"value-expr":"id","display-expr":"value"},null,8,["data-source"])]),_:1}),t(s,{width:150,"data-field":"name",caption:"Nombre"},{default:i(()=>[t(D)]),_:1}),t(s,{width:150,"data-field":"companyId",caption:"Empresa"},{default:i(()=>[t(D),t(m,{"data-source":r.company,"value-expr":"id","display-expr":"name"},null,8,["data-source"])]),_:1}),t(s,{width:150,"set-cell-value":r.setCountryValue,"data-type":"string","data-field":"catalogRegionCountryId",caption:"Pa\xEDs"},{default:i(()=>[t(m,{"data-source":r.country,"value-expr":"id","display-expr":"value"},null,8,["data-source"])]),_:1},8,["set-cell-value"]),t(s,{width:150,"set-cell-value":r.setStateValue,"data-field":"catalogRegionStateId","data-type":"string",caption:"Estado"},{default:i(()=>[t(m,{"data-source":u.getFilteredStates,"value-expr":"id","display-expr":"value"},null,8,["data-source"])]),_:1},8,["set-cell-value"]),t(s,{width:150,"data-field":"catalogRegionCityId","data-type":"string",caption:"Ciudad"},{default:i(()=>[t(m,{"data-source":u.getFilteredCities,"value-expr":"id","display-expr":"value"},null,8,["data-source"])]),_:1}),t(s,{width:150,"data-field":"address",caption:"Direcci\xF3n"})]),_:1},8,["data-source","onEditorPreparing"])])}var De=K(_e,[["render",ye]]);const C=P.get("catalogs"),w=P.get("companies"),fe="https://kameyo-api.azurewebsites.net",Me=`${fe}/api/Company`,he=await C.Get("NAME","COUNTRIES"),N=await C.Get("NAME","STATES"),q=await C.Get("NAME","CITY");function we(e){return e!=null&&e!==""}const Ce={name:"CompaniesView",components:{BreadCrumb:ie,DxDataGrid:V,DxScrolling:M,DxPaging:j,DxPager:$,DxRequiredRule:U,DxEditing:L,DxPopup:B,DxLookup:z,DxForm:H,DxItem:J,DxColumn:A,DxFilterRow:O,DxHeaderFilter:re,DxSearchPanel:de,DxMasterDetail:le,SubsidiaryDetail:De,DxExport:se},data(){return{dataSource:new T({key:"id",load:e=>{let a={};return["skip","take","requireTotalCount","requireGroupCount","sort","filter","totalSummary","group","groupSummary"].forEach(n=>{n in e&&we(e[n])&&(a[n]=JSON.stringify(e[n]))}),this.getCompanies(a)},insert:e=>this.createCompany(e),update:(e,a)=>(a.id=e,this.updateCompany(a)),remove:e=>this.deleteCompany(e)}),country:he.data.data,state:N.data.data,city:q.data.data,catalogTypes:{},setCountryValue(e,a){e.catalogRegionStateId=null,e.catalogRegionCityId=null,this.defaultSetCellValue(e,a)},setStateValue(e,a){e.catalogRegionCityId=null,this.defaultSetCellValue(e,a)}}},methods:{onEditorPreparing(e){e.parentType==="dataRow"&&e.dataField},getFilteredStates:e=>({store:N.data.data,filter:e.data?["parentId","=",e.data.catalogRegionCountryId]:null}),getFilteredCities:e=>({store:q.data.data,filter:e.data?["parentId","=",e.data.catalogRegionStateId]:null}),onExporting(e){const a=new ue.exports.Workbook,n=a.addWorksheet("Empresas");pe({component:e.component,worksheet:n,autoFilterEnabled:!0}).then(()=>{a.xlsx.writeBuffer().then(x=>{ce.exports.saveAs(new Blob([x],{type:"application/octet-stream"}),"Empresas.xlsx")})}),e.cancel=!0},getCompanies:async function(e){const{data:a}=await w.GetWithFilter(e);return a.data},createCompany:async function(e){const{data:a}=await w.Create(e);return a},updateCompany:async function(e){const{data:a}=await w.Update(e);return a},deleteCompany:async function(e){const{data:a}=await w.Delete(e);return a},getIdentificationTypes:async function(){const{data:e}=await C.Get("NAME","IDENTIFICATIONTYPE");this.catalogTypes=e.data}},async created(){await this.getIdentificationTypes()}},Ie={id:"main-content"},Se={class:"container-fluid"},Re={class:"block-header"},Ee={class:"row clearfix"},ve={class:"col-md-12"};function be(e,a,n,x,r,u){const d=o("bread-crumb"),p=o("DxHeaderFilter"),I=o("DxGroupPanel"),S=o("DxGrouping"),R=o("DxExport"),l=o("DxSelection"),E=o("DxSearchPanel"),v=o("DxFilterRow"),s=o("DxPaging"),m=o("DxScrolling"),D=o("DxPager"),b=o("DxPopup"),c=o("DxItem"),X=o("DxForm"),Z=o("DxEditing"),g=o("DxColumn"),ee=o("DxRequiredRule"),f=o("DxLookup"),te=o("DxMasterDetail"),ae=o("SubsidiaryDetail"),oe=o("DxDataGrid");return Y(),W("div",Ie,[h("div",Se,[h("div",Re,[t(d)]),h("div",Ee,[h("div",ve,[t(oe,{id:"dataGridCompanies","data-source":r.dataSource,"show-borders":!0,"repaint-changes-only":!0,"remote-operations":!0,"key-expr":"id",onEditorPreparing:u.onEditorPreparing,onExporting:u.onExporting},{"master-detail":i(({data:ne})=>[t(ae,{"template-data":ne},null,8,["template-data"])]),default:i(()=>[t(p,{visible:!0}),t(I,{visible:!0}),t(S,{"auto-expand-all":!0}),t(R,{enabled:!0,"allow-export-selected-data":!0}),t(l,{mode:"multiple"}),t(E,{visible:!0,width:240,placeholder:"Search..."}),t(v,{visible:!0}),t(s,{"page-size":10,enabled:"true"}),t(m,{"column-rendering-mode":"virtual"}),t(D,{visible:!0,"allowed-page-sizes":[10,20,50],"display-mode":e.displayMode,"show-page-size-selector":!0,"show-info":!1,"show-navigation-buttons":!0},null,8,["display-mode"]),t(Z,{"refresh-mode":e.full,"allow-updating":!0,"allow-adding":!0,"allow-deleting":!0,mode:"popup"},{default:i(()=>[t(b,{"show-title":!0,width:700,height:525,title:"Informaci\xF3n de Compa\xF1ia"}),t(X,null,{default:i(()=>[t(c,{"col-count":1,"col-span":2,"item-type":"group"},{default:i(()=>[t(c,{"data-field":"name"}),t(c,{"data-field":"catalogTypeId"}),t(c,{"data-field":"numberId"})]),_:1}),t(c,{"col-count":2,"col-span":2,"item-type":"group",caption:"Otros"},{default:i(()=>[t(c,{"data-field":"catalogRegionCountryId"}),t(c,{"data-field":"catalogRegionStateId"}),t(c,{"data-field":"catalogRegionCityId"}),t(c,{"data-field":"address"})]),_:1})]),_:1})]),_:1},8,["refresh-mode"]),t(g,{"data-field":"numberId","data-type":"number",caption:"Num. Ident.",width:150}),t(g,{"data-field":"name",caption:"Nombre",width:150},{default:i(()=>[t(p,{"allow-search":!0}),t(ee)]),_:1}),t(g,{width:0,"data-field":"catalogTypeId",caption:"Tipo de Identificaci\xF3n"},{default:i(()=>[t(f,{"data-source":r.catalogTypes,"value-expr":"id","display-expr":"value"},null,8,["data-source"])]),_:1}),t(g,{width:150,"set-cell-value":r.setCountryValue,"data-type":"string","data-field":"catalogRegionCountryId",caption:"Pa\xEDses"},{default:i(()=>[t(f,{"data-source":r.country,"value-expr":"id","display-expr":"value"},null,8,["data-source"])]),_:1},8,["set-cell-value"]),t(g,{width:150,"set-cell-value":r.setStateValue,"data-field":"catalogRegionStateId","data-type":"string",caption:"Estado"},{default:i(()=>[t(f,{"data-source":u.getFilteredStates,"value-expr":"id","display-expr":"value"},null,8,["data-source"])]),_:1},8,["set-cell-value"]),t(g,{width:150,"data-field":"catalogRegionCityId","data-type":"string",caption:"Ciudad"},{default:i(()=>[t(f,{"data-source":u.getFilteredCities,"value-expr":"id","display-expr":"value"},null,8,["data-source"])]),_:1}),t(g,{width:0,"data-field":"address",caption:"Direcci\xF3n"}),t(te,{enabled:!0,template:"master-detail"})]),_:1},8,["data-source","onEditorPreparing","onExporting"])])])])])}var $e=K(Ce,[["render",be]]);export{$e as default};
