import{C as _}from"./index.3bbb47f2.js";import{B as T}from"./BreadCrumb.9367f10a.js";import{D as I}from"./validator.a755279e.js";import{a as M,b as B,c as V,d as U,D as L}from"./form.181df029.js";import{D as q}from"./select-box.029c2d7e.js";import{_ as N}from"./date-box.adbab50c.js";import{R as m}from"./RepositoryFactory.1ead146f.js";import{_ as A}from"./number-box.9a45bbe3.js";import{_ as z}from"./button.996b9c36.js";import{g as J,n as H,D as K,a as W,v as Y,u as Q,c as X,d as Z,l as $,e as ee,i as te,b as oe,h as ae,k as se}from"./data-grid.24b081de.js";import{c as re}from"./CellLinkTemplate.75b044c2.js";import{_ as ie,a as ne}from"./index.7b655b97.js";import{c as i,r as n,o as ce,a as le,f as s,w as d}from"./vendor.7710df40.js";const y="https://kameyo-api.azurewebsites.net",de=m.get("subsidiaries"),f=m.get("customers"),ue=m.get("contacts"),g=`${y}/api/projectTasks`,x=`${y}/api/ProjectReport`,he=m.get("projectReport"),me=m.get("authenticate");function pe(o){return o!=null&&o!==""}const xe={name:"ActivitiesView",components:{BreadCrumb:T,DxForm:M,DxSimpleItem:B,DxGroupItem:V,DxLabel:U,DxNumberBox:A,DxRequiredRule:I,DxPopup:J,DxExport:H,DxSelectBox:q,DxDateBox:N,DxItem:L,DxButton:z,DxDataGrid:K,DxColumn:W,DxGrouping:Y,DxGroupPanel:Q,DxPager:X,DxPaging:Z,DxSearchPanel:$,DxEditing:ee,DxFilterRow:te,DxScrolling:oe,DxLookup:ae,DxHeaderFilter:se,cellLink:re},data(){return{idSubsidiary:0,idcustomer:0,idProject:0,idTask:0,dataSource:{},subsidiary:[],customer:[],project:[],task:[],years:[],months:[],year:0,hasCustomer:!0,month:0,searchModeOption:"contains",searchExprOption:"name",searchTimeoutOption:200,minSearchLengthOption:0,showDataBeforeSearchOption:!1,employee:new _({key:"id",load:()=>this.sendRequest(`${URLEmployees}/paginated`,"GET",{}).then(o=>{let t=o.map(a=>({id:a.id,name:`${a.lastName} ${a.names}`}));return console.log("carga",t),t}),byKey:o=>this.sendRequest(`${URLEmployees}`,"GET",{Field:"ID",Value:o}).then(t=>t.map(r=>({id:r.id,name:`${r.lastName} ${r.names}`})))}),projects:new _({key:"id",load:()=>this.sendRequest(`${g}/paginated`,"GET",{}).then(o=>o),byKey:o=>this.sendRequest(`${g}`,"GET",{Field:"ID",Value:o}).then(t=>t)})}},methods:{subsidiaryChange:async function(o){this.customer=null,this.project=[],this.task=[];let t=[];t.skip=0,t.take=0,t.requireTotalCount=!0,t.filter='["subsidiaryId","=","'+o.value+'"]';const{data:a}=await f.GetWithFilter(t);this.customer=a.data.data,this.idProject=0,this.idTask=0},getSubsidiaries:async function(){const{data:o}=await de.GetWithPagination({});this.subsidiary=o.data},getCustomers:async function(){const{data:o}=await f.GetWithPagination({});console.log(o),this.customer=o.data},handleSearch:async function(o){console.log("buscar",o),this.loadDataSource(22)},right:(o,t)=>o.substr(o.length-t,o.length),validateUser:async function(){const o=ne();if(o.isAuthenticated){const t=o.getAuthenticatedUser;this.userName=t.userName;let a="";me.ValidateUser(this.userName,"Cliente").then(r=>{r.data.isValid?ue.Get("Id",r.data.personId).then(e=>{a=e.data.data[0].customerId,f.Get("Id",a).then(c=>{this.idSubsidiary=c.data.data[0].subsidiaryId,this.idcustomer=a,this.hasCustomer=!0})}):this.hasCustomer=!1})}},loadPeriods:async function(){const o=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];let t=new Date;for(let a=0;a<12;a++)this.months=[...this.months,{value:a+1,text:o[a]}];for(let a=t.getFullYear()-4;a<=t.getFullYear();a++)this.years=[...this.years,{value:a,text:`${a}`}]},loadDataSource:async function(o){console.log("loaddatasourcecharge ",o),this.idcustomer!=0&&(this.dataSource=new _({key:"id",load:t=>{console.log(t,t.filter,t.length);let a={};return["skip","take","requireTotalCount","requireGroupCount","sort","filter","totalSummary","group","groupSummary"].forEach(r=>{r in t&&pe(t[r])&&(a[r]=JSON.stringify(t[r]))}),console.log(a),console.log(`${x}/filter/bycustomer/${this.idcustomer}/${this.year}/${this.month}/`),this.sendRequest(`${x}/filter/bycustomer/${this.idcustomer}/${this.year}/${this.month}`,"GET",a).then(r=>(console.log("datos,",r),r.data.map(e=>e.status=he.GetStatus(e.state).value),r))},byKey:t=>this.sendRequest(`${x}`,"GET",{Field:"ID",Value:t}).then(a=>a),update:(t,a)=>{const r=new Date;return a.ProjectId=t,a.ProjectReportDate=r,a.Period=this.periodo,console.log(t,a),this.sendRequest(`${x}`,"POST",{values:JSON.stringify(a)})}}))},addMonth:(o,t)=>new Date(o.setMonth(o.getMonth()+t)),sendRequest(o,t="GET",a={}){const r=Object.keys(a).map(e=>`${encodeURIComponent(e)}=${encodeURIComponent(a[e])}`).join("&");return t==="GET"?fetch(`${o}?${r}`,{method:t}).then(e=>e.json().then(c=>{if(e.ok)return c.data;throw c.Message})):fetch(o,{method:t,body:a.values,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(e=>e.ok?e.text().then(c=>c&&JSON.parse(c)):e.json().then(c=>{throw c.Message}))}},async mounted(){await this.getSubsidiaries(),await this.loadPeriods(),await this.validateUser();let o=new Date;this.year=o.getFullYear(),this.month=o.getMonth()+1}},_e={id:"main-content"},fe={class:"container-fluid"},De={class:"block-header"},ge={class:"row clearfix"},ye={class:"col-md-12 cont"},be={class:"dx-field"},ve=i("div",{class:"dx-field-label"},"Subsidiaria",-1),we={class:"dx-field-value"},Se={class:"dx-field"},Re=i("div",{class:"dx-field-label"},"Cliente",-1),Pe={class:"dx-field-value"},Ce={class:"dx-field"},Ge=i("div",{class:"dx-field-label"},"Per\xEDodo",-1),Ee={class:"dx-field-value"},Oe={class:"dx-field"},ke=i("div",{class:"dx-field-label"},"Per\xEDodo",-1),Fe={class:"dx-field-value"},je={class:"row clearfix"},Te={class:"col-md-12 cont"};function Ie(o,t,a,r,e,c){const b=n("bread-crumb"),p=n("DxSelectBox"),D=n("DxGroupItem"),v=n("DxForm"),w=n("DxHeaderFilter"),S=n("DxGroupPanel"),R=n("DxGrouping"),P=n("DxExport"),C=n("DxSearchPanel"),G=n("DxFilterRow"),E=n("DxScrolling"),O=n("DxPaging"),k=n("DxPager"),u=n("DxRequiredRule"),h=n("DxColumn"),F=n("cellLink"),j=n("DxDataGrid");return ce(),le("div",_e,[i("div",fe,[i("div",De,[s(b)]),i("div",ge,[i("div",ye,[s(v,{"form-data":e.project,"col-count":2},{default:d(()=>[s(D,{"col-count":2},{default:d(()=>[i("div",be,[ve,i("div",we,[s(p,{items:e.subsidiary,onValueChanged:c.subsidiaryChange,"display-expr":"name",value:e.idSubsidiary,"onUpdate:value":t[0]||(t[0]=l=>e.idSubsidiary=l),disabled:e.hasCustomer,"search-enabled":!0,"search-mode":e.searchModeOption,"search-expr":e.searchExprOption,"search-timeout":e.searchTimeoutOption,"min-search-length":e.minSearchLengthOption,"show-data-before-search":e.showDataBeforeSearchOption,"value-expr":"id"},null,8,["items","onValueChanged","value","disabled","search-mode","search-expr","search-timeout","min-search-length","show-data-before-search"])])]),i("div",Se,[Re,i("div",Pe,[s(p,{items:e.customer,onValueChanged:c.loadDataSource,"display-expr":"name",value:e.idcustomer,"onUpdate:value":t[1]||(t[1]=l=>e.idcustomer=l),"value-expr":"id","data-field":"Position","search-enable":"true",id:"idcustomer",disabled:e.hasCustomer,"search-enabled":!0,"search-mode":e.searchModeOption,"search-expr":e.searchExprOption,"search-timeout":e.searchTimeoutOption,"min-search-length":e.minSearchLengthOption,"show-data-before-search":e.showDataBeforeSearchOption},null,8,["items","onValueChanged","value","disabled","search-mode","search-expr","search-timeout","min-search-length","show-data-before-search"])])])]),_:1}),s(D,{"col-count":3},{default:d(()=>[i("div",Ce,[Ge,i("div",Ee,[s(p,{items:e.years,onValueChanged:c.loadDataSource,"display-expr":"text",value:e.year,"onUpdate:value":t[2]||(t[2]=l=>e.year=l),"value-expr":"value","search-enable":"true","search-enabled":!0,"search-mode":e.searchModeOption,"search-expr":e.searchExprOption,"search-timeout":e.searchTimeoutOption,"min-search-length":e.minSearchLengthOption,"show-data-before-search":e.showDataBeforeSearchOption},null,8,["items","onValueChanged","value","search-mode","search-expr","search-timeout","min-search-length","show-data-before-search"])])]),i("div",Oe,[ke,i("div",Fe,[s(p,{items:e.months,onValueChanged:c.loadDataSource,"display-expr":"text",value:e.month,"onUpdate:value":t[3]||(t[3]=l=>e.month=l),"value-expr":"value","search-enable":"true","search-enabled":!0,"search-mode":e.searchModeOption,"search-expr":e.searchExprOption,"search-timeout":e.searchTimeoutOption,"min-search-length":e.minSearchLengthOption,"show-data-before-search":e.showDataBeforeSearchOption},null,8,["items","onValueChanged","value","search-mode","search-expr","search-timeout","min-search-length","show-data-before-search"])])])]),_:1})]),_:1},8,["form-data"])]),i("div",je,[i("div",Te,[s(j,{id:"dataGridActivities","show-borders":!0,"data-source":e.dataSource,"column-auto-width":!1,"repaint-changes-only":!0,"remote-operations":!0},{"cell-link-template":d(({data:l})=>[s(F,{"cell-data":l,routePath:{name:"ProjectReportViewDetails",params:{id:l.data.id}}},null,8,["cell-data","routePath"])]),default:d(()=>[s(w,{visible:!0}),s(S,{visible:!0}),s(R,{"auto-expand-all":!0}),s(P,{enabled:!0,"allow-export-selected-data":!0}),s(C,{visible:!0,width:240,placeholder:"Buscar..."}),s(G,{visible:!0}),s(E,{"row-rendering-mode":"virtual"}),s(O,{"page-size":10}),s(k,{visible:!0,"allowed-page-sizes":[10,20,50],"display-mode":"full","show-page-size-selector":!0,"show-info":!1,"show-navigation-buttons":!0}),s(h,{"allow-editing":!1,"data-field":"project.name",caption:"Nombre","cell-template":"cell-link-template"},{default:d(()=>[s(u)]),_:1}),s(h,{"allow-editing":!1,width:170,"data-field":"projectReportDate","data-type":"date",format:"yyyy-MM-dd",caption:"Fecha Generaci\xF3n"},{default:d(()=>[s(u)]),_:1}),s(h,{"allow-editing":!1,width:150,"data-field":"project.startDate","data-type":"date",format:"yyyy-MM-dd",caption:"Fecha Inicio"},{default:d(()=>[s(u)]),_:1}),s(h,{"allow-editing":!1,width:150,"data-field":"project.endDate","data-type":"date",format:"yyyy-MM-dd",caption:"Fecha Fin"},{default:d(()=>[s(u)]),_:1}),s(h,{"allow-editing":!1,width:300,"data-field":"status",caption:"Estado"},{default:d(()=>[s(u)]),_:1})]),_:1},8,["data-source"])])])])])])}var Ye=ie(xe,[["render",Ie]]);export{Ye as default};
