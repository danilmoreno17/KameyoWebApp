import{B as Q}from"./BreadCrumb.9367f10a.js";import{a as X,c as Y,b as Z,d as $,D as ee}from"./form.181df029.js";import{_ as te}from"./number-box.9a45bbe3.js";import{D as oe}from"./validator.a755279e.js";import{D as ae}from"./text-area.c45c04d3.js";import{E as ie,j as ne,g as se,D as le,a as re,v as ue,u as de,c as ce,d as pe,l as me,e as he,n as xe,i as _e,b as ge,k as De,h as fe,F as ve,G as ye}from"./data-grid.24b081de.js";import{D as be}from"./button.996b9c36.js";import{bl as P,C as F}from"./index.3bbb47f2.js";import{D as we}from"./select-box.029c2d7e.js";import{R as h}from"./RepositoryFactory.1ead146f.js";import{b9 as Ce,b1 as R,c as r,r as n,o as Se,a as Te,f as a,w as u}from"./vendor.7710df40.js";import{_ as Ie,a as ke}from"./index.7b655b97.js";import"./excel_exporter.6e076f26.js";import"./utils.scroll.55667bed.js";var d={},Ee=Ce(ie);/*!
 * devextreme-vue
 * Version: 21.2.6
 * Build date: Tue Mar 01 2022
 *
 * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED
 *
 * This software may be modified and distributed under the terms
 * of the MIT license. See the LICENSE file in the root of the project for details.
 *
 * https://github.com/DevExpress/devextreme-vue
 */var Fe=R&&R.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(d,"__esModule",{value:!0});var Re=d.DxRow=Ge=d.DxLocation=Oe=d.DxItem=Ne=d.DxCol=je=d.DxResponsiveBox=void 0,Pe=Fe(Ee),Be=P,D=P,B=Be.createComponent({props:{cols:Array,dataSource:[Array,Object,String],disabled:Boolean,elementAttr:Object,height:[Function,Number,String],hoverStateEnabled:Boolean,itemHoldTimeout:Number,items:Array,itemTemplate:{},onContentReady:Function,onDisposing:Function,onInitialized:Function,onItemClick:Function,onItemContextMenu:Function,onItemHold:Function,onItemRendered:Function,onOptionChanged:Function,rows:Array,rtlEnabled:Boolean,screenByWidth:Function,singleColumnScreen:String,visible:Boolean,width:[Function,Number,String]},emits:{"update:isActive":null,"update:hoveredElement":null,"update:cols":null,"update:dataSource":null,"update:disabled":null,"update:elementAttr":null,"update:height":null,"update:hoverStateEnabled":null,"update:itemHoldTimeout":null,"update:items":null,"update:itemTemplate":null,"update:onContentReady":null,"update:onDisposing":null,"update:onInitialized":null,"update:onItemClick":null,"update:onItemContextMenu":null,"update:onItemHold":null,"update:onItemRendered":null,"update:onOptionChanged":null,"update:rows":null,"update:rtlEnabled":null,"update:screenByWidth":null,"update:singleColumnScreen":null,"update:visible":null,"update:width":null},computed:{instance:function(){return this.$_instance}},beforeCreate:function(){this.$_WidgetClass=Pe.default,this.$_hasAsyncTemplate=!0,this.$_expectedChildren={col:{isCollectionItem:!0,optionName:"cols"},item:{isCollectionItem:!0,optionName:"items"},row:{isCollectionItem:!0,optionName:"rows"}}}}),je=d.DxResponsiveBox=B,y=D.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:baseSize":null,"update:ratio":null,"update:screen":null,"update:shrink":null},props:{baseSize:[Number,String],ratio:Number,screen:String,shrink:Number}}),Ne=d.DxCol=y;y.$_optionName="cols";y.$_isCollectionItem=!0;var f=D.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:disabled":null,"update:html":null,"update:location":null,"update:template":null,"update:text":null,"update:visible":null},props:{disabled:Boolean,html:String,location:[Array,Object],template:{},text:String,visible:Boolean}}),Oe=d.DxItem=f;f.$_optionName="items";f.$_isCollectionItem=!0;f.$_expectedChildren={location:{isCollectionItem:!0,optionName:"location"}};var b=D.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:col":null,"update:colspan":null,"update:row":null,"update:rowspan":null,"update:screen":null},props:{col:Number,colspan:Number,row:Number,rowspan:Number,screen:String}}),Ge=d.DxLocation=b;b.$_optionName="location";b.$_isCollectionItem=!0;var w=D.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:baseSize":null,"update:ratio":null,"update:screen":null,"update:shrink":null},props:{baseSize:[Number,String],ratio:Number,screen:String,shrink:Number}});Re=d.DxRow=w;w.$_optionName="rows";w.$_isCollectionItem=!0;var Ct=d.default=B;const St=h.get("catalogs"),C="https://kameyo-api.azurewebsites.net",Ae=h.get("subsidiaries"),Ve=h.get("customers"),qe=h.get("projects"),He=h.get("projectTasks"),Tt=h.get("employees"),It=`${C}/api/employee`,v=`${C}/api/ProjectResources`,_=`${C}/api/taskactivities`;function Le(t){return t!=null&&t!==""}const Me={name:"ActivitiesView",components:{BreadCrumb:Q,DxTextArea:ae,DxForm:X,DxFormGrid:ne,DxGroupItem:Y,DxSimpleItem:Z,DxLabel:$,DxSelectBox:we,DxPopup:se,DxDataGrid:le,DxColumn:re,DxGrouping:ue,DxGroupPanel:de,DxPager:ce,DxPaging:pe,DxSearchPanel:me,DxEditing:he,DxExport:xe,DxRequiredRule:oe,DxFilterRow:_e,DxScrolling:ge,DxButton:be,DxNumberBox:te,DxItem:ee,DxHeaderFilter:De,DxLookup:fe,DxSummary:ve,DxTotalItem:ye},data(){return{idSubsidiary:0,idCustomer:0,idProject:0,idTask:0,idEmployee:0,subsidiary:[],customer:[],project:[],task:[],employee:new F({key:"id",load:()=>this.idProject!=0?this.sendRequest(`${v}`,"GET",{Field:"ProjectId",Value:this.idProject}).then(t=>{let e=t.map(i=>({id:i.employeeId,name:i.employeName}));return console.log("employee load",e),e}):null,byKey:t=>this.sendRequest(`${v}`,"GET",{Field:"EmployeeId",Value:t}).then(e=>{let i=e.map(s=>({id:s.employeeId,name:s.employeName}));return console.log("employee byKey",i),i})}),dataSource:{},full:!0,searchModeOption:"contains",searchExprOption:"name",searchTimeoutOption:200,minSearchLengthOption:0,showDataBeforeSearchOption:!1,displayMode:"full",setHourSetValue(t,e,i){console.log("setHourSetValue",t,e,i),i.id!=null?i.hourSet==i.hourBalance&&(t.hourBalance=e):t.hourBalance=e,this.defaultSetCellValue(t,e)},setFullDates(t,e,i){if(console.log("setFullDates",t,e,i),i.startDate!=null&&e!=null){const s=e-new Date(i.startDate),o=Math.ceil(s/(1e3*60*60));t.durationHour=o.toFixed(2)}if(i.endDate!=null&&e!=null){const s=new Date(i.endDate)-e,o=Math.ceil(s/(1e3*60*60));t.durationHour=o.toFixed(2)}this.defaultSetCellValue(t,e)},refreshMode:"reshape",allowAdding:t=>{return console.log("permite agregar",this.idTask),!t==null;return this.idTask>0&&this.idTask!=null}}},methods:{logEvent:(t,e)=>{console.log(t,e)},subsidiaryChange:async function(t){this.customer=[],this.project=[],this.task=[],this.dataSource=null;let e=[];e.skip=0,e.take=0,e.requireTotalCount=!0,e.filter='["subsidiaryId","=","'+t.value+'"]';const{data:i}=await Ve.GetWithFilter(e);this.customer=i.data,this.idCustomer=0,this.idProject=0,this.idTask=0},customerChange:async function(t){this.project=[],this.task=[],this.dataSource=null;let e=[];e.skip=0,e.take=0,e.requireTotalCount=!0,e.filter='["CustomerId","=","'+t.value+'"]';let{data:i}=await qe.GetWithFilter(e);console.log(i),this.project=i.data,this.idProject=0,this.idTask=0},projectChange:async function(t){this.task=[];let e=[];this.dataSource=null,e.skip=0,e.take=0,e.requireTotalCount=!0,e.filter='["projectId","=","'+t.value+'"]';const{data:i}=await He.GetWithFilter(e);this.task=i.data,this.idTask=0},taskChange:async function(t){console.log("taskchange"),this.loadDataSource(t.value)},getSubsidiaries:async function(){const{data:t}=await Ae.GetWithPagination({});this.subsidiary=t.data},initNewRow:async function(t){t.data.isBillable=!0},getEmployees:async function(){if(this.idProject!=0)return this.sendRequest(`${v}`,"GET",{Field:"ProjectId",Value:this.idProject}).then(t=>{let e=t.map(i=>({id:i.employeeId,name:i.employeName}));return console.log("employee load",e),e})},loadDataSource:async function(t){this.dataSource=new F({key:"id",load:e=>{if(this.idTask!=null){let i={};return["skip","take","requireTotalCount","requireGroupCount","sort","filter","totalSummary","group","groupSummary"].forEach(s=>{s in e&&Le(e[s])&&(i[s]=JSON.stringify(e[s]))}),console.log(i),this.sendRequest(`${_}/filter/${t}`,"GET",i).then(s=>(console.log("sendrequet",s),s))}},insert:e=>(e.ProjectTaskId=this.idTask,e.ProjectId=this.idProject,console.log("insert",e),this.sendRequest(`${_}`,"POST",{values:JSON.stringify(e)})),update:(e,i)=>(i.id=e,console.log("update",i),this.sendRequest(`${_}`,"PUT",{key:e,values:JSON.stringify(i)})),remove:e=>this.sendRequest(`${_}/${e}`,"DELETE",{}),byKey:e=>this.sendRequest(`${_}`,"GET",{Field:"ID",Value:e}).then(i=>i)})},calculateCellValue(t){let e=new Date(t.startDate),i=new Date(t.endDate);var s=parseFloat(Math.abs(i.getTime()-e.getTime())/36e5);return t.totalTimeHour=s,isNaN(s)?0:s.toFixed(2)},editDate:t=>{console.log("cambio de valor fecha",t)},allowEditing(t){return!t.row.data.inProjectReport},sendRequest(t,e="GET",i={}){const s=Object.keys(i).map(o=>`${encodeURIComponent(o)}=${encodeURIComponent(i[o])}`).join("&");return e==="GET"?fetch(`${t}?${s}`,{method:e}).then(o=>o.json().then(l=>{if(o.ok)return l.data;throw l.Message})):fetch(t,{method:e,body:i.values,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(o=>o.ok?o.text().then(l=>l&&JSON.parse(l)):o.json().then(l=>{throw l.Message}))},onExporting(t){},getPermissions:()=>{const t=ke();if(t.isAuthenticated){const e=t.getAuthenticatedUser;console.log("typeid",t.getUserType.personTypeId),console.log("authUser from activityview ",e)}}},async mounted(){await this.getSubsidiaries(),await this.getEmployees(),await this.getPermissions()}},Ue={id:"main-content"},ze={class:"container-fluid"},We={class:"block-header"},Je={class:"row clearfix"},Ke={class:"col-md-12 cont"},Qe={class:"dx-field"},Xe=r("div",{class:"dx-field-label"},"Subsidiaria",-1),Ye={class:"dx-field-value"},Ze={class:"dx-field"},$e=r("div",{class:"dx-field-label"},"Cliente",-1),et={class:"dx-field-value"},tt={class:"dx-field"},ot=r("div",{class:"dx-field-label"},"Proyecto",-1),at={class:"dx-field-value"},it={class:"dx-field"},nt=r("div",{class:"dx-field-label"},"Tarea",-1),st={class:"dx-field-value"},lt={class:"row clearfix"},rt={class:"col-md-12 cont"};function ut(t,e,i,s,o,l){const j=n("bread-crumb"),g=n("DxSelectBox"),S=n("DxGroupItem"),N=n("DxForm"),T=n("DxHeaderFilter"),O=n("DxGroupPanel"),G=n("DxGrouping"),A=n("DxExport"),V=n("DxSearchPanel"),q=n("DxFilterRow"),I=n("DxScrolling"),k=n("DxPaging"),H=n("DxPager"),L=n("DxPopup"),c=n("DxItem"),M=n("DxFormGrid"),U=n("DxEditing"),x=n("DxRequiredRule"),p=n("DxColumn"),z=n("DxLookup"),E=n("DxButton"),W=n("DxTotalItem"),J=n("DxSummary"),K=n("DxDataGrid");return Se(),Te("div",Ue,[r("div",ze,[r("div",We,[a(j)]),r("div",Je,[r("div",Ke,[a(N,{"form-data":o.project,"col-count":2},{default:u(()=>[a(S,{"col-count":2},{default:u(()=>[r("div",Qe,[Xe,r("div",Ye,[a(g,{items:o.subsidiary,placeholder:"Seleccionar...",onValueChanged:l.subsidiaryChange,"display-expr":"name",value:o.idSubsidiary,"onUpdate:value":e[0]||(e[0]=m=>o.idSubsidiary=m),"search-enabled":!0,"search-mode":o.searchModeOption,"search-expr":o.searchExprOption,"search-timeout":o.searchTimeoutOption,"min-search-length":o.minSearchLengthOption,"show-data-before-search":o.showDataBeforeSearchOption,"value-expr":"id"},null,8,["items","onValueChanged","value","search-mode","search-expr","search-timeout","min-search-length","show-data-before-search"])])]),r("div",Ze,[$e,r("div",et,[a(g,{items:o.customer,placeholder:"Seleccionar...",onValueChanged:l.customerChange,"display-expr":"name",value:o.idCustomer,"onUpdate:value":e[1]||(e[1]=m=>o.idCustomer=m),"value-expr":"id","data-field":"Position","search-enable":"true",id:"idcustomer","search-enabled":!0,"search-mode":o.searchModeOption,"search-expr":o.searchExprOption,"search-timeout":o.searchTimeoutOption,"min-search-length":o.minSearchLengthOption,"show-data-before-search":o.showDataBeforeSearchOption},null,8,["items","onValueChanged","value","search-mode","search-expr","search-timeout","min-search-length","show-data-before-search"])])])]),_:1}),a(S,{"col-count":2},{default:u(()=>[r("div",tt,[ot,r("div",at,[a(g,{items:o.project,placeholder:"Seleccionar...",onValueChanged:l.projectChange,"display-expr":"name",value:o.idProject,"onUpdate:value":e[2]||(e[2]=m=>o.idProject=m),"value-expr":"id",id:"idproject","search-enabled":!0,"search-mode":o.searchModeOption,"search-expr":o.searchExprOption,"search-timeout":o.searchTimeoutOption,"min-search-length":o.minSearchLengthOption,"show-data-before-search":o.showDataBeforeSearchOption},null,8,["items","onValueChanged","value","search-mode","search-expr","search-timeout","min-search-length","show-data-before-search"])])]),r("div",it,[nt,r("div",st,[a(g,{items:o.task,placeholder:"Seleccionar...",onValueChanged:l.taskChange,"display-expr":"name","value-expr":"id",value:o.idTask,"onUpdate:value":e[3]||(e[3]=m=>o.idTask=m),id:"idtask","search-enabled":!0,"search-mode":o.searchModeOption,"search-expr":o.searchExprOption,"search-timeout":o.searchTimeoutOption,"min-search-length":o.minSearchLengthOption,"show-data-before-search":o.showDataBeforeSearchOption},null,8,["items","onValueChanged","value","search-mode","search-expr","search-timeout","min-search-length","show-data-before-search"])])])]),_:1})]),_:1},8,["form-data"])])]),r("div",lt,[r("div",rt,[a(K,{id:"dataGridActivities","data-source":o.dataSource,"show-borders":!0,"column-auto-width":!0,"repaint-changes-only":!0,"remote-operations":!0,onExporting:l.onExporting,onInitNewRow:l.initNewRow},{default:u(()=>[a(T,{visible:!0}),a(O,{visible:!0}),a(G,{"auto-expand-all":!0}),a(A,{enabled:!0,"allow-export-selected-data":!0}),a(V,{visible:!0,width:240,placeholder:"Buscar..."}),a(q,{visible:!0}),a(I,{"row-rendering-mode":"virtual"}),a(k,{"page-size":10}),a(H,{visible:!0,"allowed-page-sizes":[10,20,50],"display-mode":o.displayMode,"show-page-size-selector":!0,"show-info":!1,"show-navigation-buttons":!0},null,8,["display-mode"]),a(U,{"refresh-mode":o.refreshMode,"allow-updating":l.allowEditing,"allow-adding":this.idTask!=0,"allow-deleting":l.allowEditing,mode:"popup"},{default:u(()=>[a(I,{"row-rendering-mode":"virtual"}),a(k,{"page-size":10}),a(L,{"show-title":!0,width:700,height:600,title:"Registro de Actividades"}),a(M,null,{default:u(()=>[a(c,{"col-count":2,"col-span":2,"item-type":"group"},{default:u(()=>[a(c,{"data-field":"startDate"}),a(c,{"data-field":"endDate"}),a(c,{"data-field":"totalTimeHour"}),a(c,{"data-field":"employeeId"})]),_:1}),a(c,{"col-count":1,"col-span":2,"item-type":"group"},{default:u(()=>[a(c,{"data-field":"description","editor-type":"dxTextArea"}),a(c,{"data-field":"isBillable"})]),_:1})]),_:1})]),_:1},8,["refresh-mode","allow-updating","allow-adding","allow-deleting"]),a(p,{width:250,"data-field":"description",caption:"Descripcion"},{default:u(()=>[a(x)]),_:1}),a(p,{width:150,"data-field":"startDate",caption:"Fecha de inicio","set-cell-value":o.setFullDates,onValueChanged:l.editDate,"data-type":"datetime",editorType:"dxDateBox"},{default:u(()=>[a(x)]),_:1},8,["set-cell-value","onValueChanged"]),a(p,{width:150,"data-field":"endDate","set-cell-value":o.setFullDates,editorType:"dxDateBox",onValueChanged:l.editDate,"data-type":"datetime",caption:"Fecha de fin"},{default:u(()=>[a(x)]),_:1},8,["set-cell-value","onValueChanged"]),a(p,{width:150,"data-field":"employeeId",caption:"Empleado"},{default:u(()=>[a(z,{"data-source":o.employee,"value-expr":"id","display-expr":"name"},null,8,["data-source"]),a(x),a(T,{"allow-search":!0})]),_:1}),a(p,{width:150,"data-field":"isBillable",caption:"Facturable",editorType:"dxCheckBox"}),a(p,{width:150,"calculate-cell-value":l.calculateCellValue,"set-cell-value":o.setHourSetValue,"data-field":"totalTimeHour",caption:"Tiempo Total","allow-editing":!1,type:"fixedPoint","show-spin-buttons":!0,"show-clear-button":!0},{default:u(()=>[a(x)]),_:1},8,["calculate-cell-value","set-cell-value"]),a(p,{type:"buttons",width:100},{default:u(()=>[a(E,{name:"delete"}),a(E,{hint:"Clone",icon:"copy"})]),_:1}),a(J,null,{default:u(()=>[a(W,{column:"totalTimeHour","summary-type":"sum"})]),_:1})]),_:1},8,["data-source","onExporting","onInitNewRow"])])])])])}var kt=Ie(Me,[["render",ut]]);export{kt as default};
