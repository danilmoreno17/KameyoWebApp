import{R as b,aT as W,Q as X,S as q,H as w,U as E,D as n,J as y,a5 as j,$ as S,a2 as $,a3 as M,E as U,P as B,be as Z,a7 as ce}from"./vendor.7710df40.js";import{p as J,q as Y}from"./data-grid.24b081de.js";import{L as K}from"./index.3bbb47f2.js";var D=1632,T={thousands:"#,##0{0},&quot;K&quot;",millions:"#,##0{0},,&quot;M&quot;",billions:"#,##0{0},,,&quot;B&quot;",trillions:"#,##0{0},,,,&quot;T&quot;",percent:"0{0}%",decimal:"#{0}",fixedpoint:"#,##0{0}",exponential:"0{0}E+00",currency:" "},Q=/a+/g,I=/E/g,x=/dE+/g,ee=/L/g,te=/h/g,re=/./g;function ae(t,e){var r,a;if(e>0){for(r=t!=="decimal"?".":"",a=0;a<e;a++)r+="0";return r}return""}function oe(t){for(var e,r=0;r<t.length;r++)if(e=t.charCodeAt(r),e>=D&&e<D+10)return!0;return!1}function ne(t){var e=(b.format(new Date(2009,8,8,6,5,4),t)||"").toString(),r=W(a=>b.format(a,t));return r&&(r=le(r),r=ie(e)+r),r}function ie(t){var e=J(),r=e?e.toString(16):"",a="";if(oe(t)){for(;r.length<3;)r="0"+r;a="[$-2010"+r+"]"}else r&&(a="[$-"+r+"]");return a}function le(t){return t.split("/").join("\\/").split("'").map(function(e,r){return r%2===0?e.replace(Q,"AM/PM").replace(x,"d").replace(I,"d").replace(ee,"M").replace(te,"H").split("[").join("\\[").split("]").join("\\]"):e?e.replace(re,"\\$&"):"'"}).join("")}function se(t,e,r){var a,o;return t==="currency"?o=X.getOpenXmlCurrencyFormat(r):o=T[t.toLowerCase()],o&&(a=q(o,ae(t,e))),a}var A={formatObjectConverter(t,e){var r={format:t,precision:t&&t.precision,dataType:e};return w(t)?E(r,t,{format:t.formatter||t.type,currency:t.currency}):r},convertFormat(t,e,r,a){if(n(t)){if(r==="date")return ne(t);if(y(t)&&T[t.toLowerCase()])return se(t,e,a)}}};class ue{constructor(e,r,a,o){this.mergedCells=[],this.mergedRanges=[],this.dataProvider=e,this.helpers=r,this.mergeRowFieldValues=a,this.mergeColumnFieldValues=o}updateMergedRanges(e,r,a){if(this.helpers._isHeaderCell(this.dataProvider,r,a)&&!this.isCellInMergedRanges(r,a)){var{rowspan:o,colspan:i}=this.dataProvider.getCellMerging(r,a),u=i||o;if(u){var s=this.helpers._allowToMergeRange(this.dataProvider,r,a,o,i,this.mergeRowFieldValues,this.mergeColumnFieldValues);this.updateMergedCells(e,r,a,o,i,s),s&&this.mergedRanges.push(j({masterCell:e},{rowspan:o,colspan:i}))}}}isCellInMergedRanges(e,r){return this.mergedCells[e]&&this.mergedCells[e][r]}findMergedCellInfo(e,r){if(this.helpers._isHeaderCell(this.dataProvider,e,r)&&this.isCellInMergedRanges(e,r))return this.mergedCells[e][r]}updateMergedCells(e,r,a,o,i,u){for(var s=r;s<=r+o;s++)for(var f=a;f<=a+i;f++)this.mergedCells[s]||(this.mergedCells[s]=[]),this.mergedCells[s][f]={masterCell:e,unmerged:!u}}applyMergedRages(e){this.mergedRanges.forEach(r=>{var a=r.masterCell.fullAddress.row,o=r.masterCell.fullAddress.col,i=a+r.rowspan,u=o+r.colspan;e.mergeCells(a,o,i,u)})}}var ge="dx-export-loadpanel";class me{constructor(e,r,a,o){this._$targetElement=r,this._$container=a,this._loadPanel=e._createComponent(S("<div>").addClass(ge).appendTo(this._$container),K,this.getOptions(o))}getDefaultOptions(){return{animation:null,shading:!1,height:90,width:200,container:this._$container}}getOptions(e){return n(e.text)?e.message=e.text:e.message=$.format("dxDataGrid-exporting"),E(this.getDefaultOptions(),e)}show(){this._loadPanel.option("position",Y.calculateLoadPanelPosition(this._$targetElement)),this._loadPanel.show()}dispose(){S(this._loadPanel.element()).remove(),delete this._loadPanel}}var de=7,fe=255,z={getFullOptions(t){var e=E({},t);if(!(n(e.worksheet)&&w(e.worksheet)))throw Error('The "worksheet" field must contain an object.');if(!n(e.topLeftCell))e.topLeftCell={row:1,column:1};else if(y(e.topLeftCell)){var{row:r,col:a}=e.worksheet.getCell(e.topLeftCell);e.topLeftCell={row:r,column:a}}return n(e.keepColumnWidths)||(e.keepColumnWidths=!0),n(e.loadPanel)||(e.loadPanel={}),n(e.loadPanel.enabled)||(e.loadPanel.enabled=!0),e},convertDateForExcelJS:t=>new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds())),setNumberFormat(t,e){t.numFmt=e},getCellStyles(t){var e=t.getStyles();return e.forEach(r=>{var a=this.tryConvertToExcelNumberFormat(r.format,r.dataType);n(a)&&(a=a.replace(/&quot;/g,'"')),r.numberFormat=a}),e},tryConvertToExcelNumberFormat(t,e){var r=A.formatObjectConverter(t,e),a=r.currency;return t=r.format,e=r.dataType,A.convertFormat(t,r.precision,e,a)},setAlignment(t,e,r){t.alignment=t.alignment||{},n(e)&&(t.alignment.wrapText=e),n(r)&&(t.alignment.horizontal=r),t.alignment.vertical="top"},setColumnsWidth(t,e,r){if(!!n(e))for(var a=0;a<e.length;a++){var o=e[a];typeof o=="number"&&isFinite(o)&&(t.getColumn(r+a).width=Math.min(fe,Math.floor(o/de*100)/100))}},export(t,e){var r,{customizeCell:a,component:o,worksheet:i,topLeftCell:u,autoFilterEnabled:s,keepColumnWidths:f,selectedRowsOnly:R,loadPanel:g,mergeRowFieldValues:h,mergeColumnFieldValues:l}=t,v=((r=o._getInternalInstance)===null||r===void 0?void 0:r.call(o))||o,c=v.option("loadPanel")&&v.option("loadPanel").enabled;c&&o.option("loadPanel.enabled",!1);var C;if(g.enabled&&M()){var F=e._getLoadPanelTargetElement(o),V=e._getLoadPanelContainer(o);C=new me(o,F,V,g),C.show()}var G=!!o.option("wordWrapEnabled");i.properties.outlineProperties={summaryBelow:!1,summaryRight:!1};var d={from:{row:u.row,column:u.column},to:{row:u.row,column:u.column}},m=o.getDataProvider(R);return new Promise(N=>{m.ready().done(()=>{var P=m.getColumns(),k=m.getRowsCount();f&&this.setColumnsWidth(i,m.getColumnsWidths(),d.from.column);for(var O=new ue(m,e,h,l),H=this.getCellStyles(m),p=0;p<k;p++){var L=i.getRow(d.from.row+p);e._trySetOutlineLevel(m,L,p),this.exportRow(m,e,O,p,P.length,L,d.from.column,a,G,H),p>=1&&d.to.row++}O.applyMergedRages(i),d.to.column+=P.length>0?P.length-1:0;var _=i.views[0]||{};o.option("rtlEnabled")&&(_.rightToLeft=!0),e._isFrozenZone(m)&&(Object.keys(_).indexOf("state")===-1&&E(_,e._getWorksheetFrozenState(m,d)),e._trySetAutoFilter(m,i,d,s)),Object.keys(_).length>0&&(i.views=[_]),N(d)}).always(()=>{c&&o.option("loadPanel.enabled",c),g.enabled&&M()&&C.dispose()})})},exportRow(t,e,r,a,o,i,u,s,f,R){for(var g=0;g<o;g++){var h=t.getCellData(a,g,!0),l=i.getCell(u+g);r.updateMergedRanges(l,a,g);var v=r.findMergedCellInfo(a,g);if(n(v)&&l!==v.masterCell)l.style=v.masterCell.style,l.value=v.masterCell.value;else if(U(h.value)?l.value=this.convertDateForExcelJS(h.value):l.value=h.value,n(l.value)){var{bold:c,alignment:C,numberFormat:F}=R[t.getStyleId(a,g)];n(F)?this.setNumberFormat(l,F):y(l.value)&&/^[@=+-]/.test(l.value)&&this.setNumberFormat(l,"@"),e._trySetFont(l,c),this.setAlignment(l,f,C)}B(s)&&s(e._getCustomizeCellOptions(l,h.cellSourceData))}}},ve={_trySetAutoFilter(t,e,r,a){if(a&&!n(e.autoFilter)&&t.getRowsCount()>0){var o={from:{row:r.from.row+t.getHeaderRowCount()-1,column:r.from.column},to:r.to};e.autoFilter=o}},_trySetFont(t,e){n(e)&&(t.font=t.font||{},t.font.bold=e)},_getWorksheetFrozenState:(t,e)=>({state:"frozen",ySplit:e.from.row+t.getFrozenArea().y-1}),_trySetOutlineLevel(t,e,r){r>=t.getHeaderRowCount()&&(e.outlineLevel=t.getGroupLevel(r))},_getCustomizeCellOptions(t,e){var r={excelCell:t,gridCell:e};return Object.defineProperty(r,"cell",{get(){return Z.log("W0003","CustomizeCell handler argument","cell","20.1","Use the 'excelCell' field instead"),t}}),r},_isFrozenZone:t=>t.getHeaderRowCount()>0,_isHeaderCell:(t,e)=>e<t.getHeaderRowCount(),_allowToMergeRange:()=>!0,_getLoadPanelTargetElement:t=>t.getView("rowsView").element(),_getLoadPanelContainer:t=>t.getView("rowsView").element().parent()};function Fe(t){return z.export(he(t),ve)}function he(t){if(!(n(t)&&w(t)))throw Error('The "exportDataGrid" method requires a configuration object.');if(!(n(t.component)&&w(t.component)&&t.component.NAME==="dxDataGrid"))throw Error('The "component" field must contain a DataGrid instance.');return n(t.selectedRowsOnly)||(t.selectedRowsOnly=!1),n(t.autoFilterEnabled)||(t.autoFilterEnabled=!1),z.getFullOptions(t)}export{Fe as e};
