import{C as M}from"./index.3bbb47f2.js";import{B as V}from"./BreadCrumb.9367f10a.js";import{D as L}from"./validator.a755279e.js";import{a as q,D as A,b as N,c as U,d as H}from"./form.181df029.js";import{D as z}from"./select-box.029c2d7e.js";import{_ as J}from"./date-box.adbab50c.js";import{R as x}from"./RepositoryFactory.1ead146f.js";import{_ as Y}from"./number-box.9a45bbe3.js";import{_ as j}from"./button.996b9c36.js";import{g as W,n as K,D as Q,a as X,v as Z,u as $,c as ee,d as te,l as oe,e as ae,i as ie,b as se,h as ne,k as re}from"./data-grid.24b081de.js";import{c as le}from"./CellLinkTemplate.75b044c2.js";import{c as n,r as s,o as ce,a as de,f as o,w as l}from"./vendor.7710df40.js";import{_ as ue}from"./index.7b655b97.js";const he="https://kameyo-api.azurewebsites.net",pe=x.get("subsidiaries"),me=x.get("employees"),xe=x.get("catalogs"),u=`${he}/api/FinancialParticipation`,y=x.get("financialParticipation"),_e=await xe.Get("NAME","DISCRETIONARYTYPE");function ge(t){return t!=null&&t!==""}const De={name:"ActivitiesView",components:{BreadCrumb:V,DxForm:q,DxItem:A,DxSimpleItem:N,DxGroupItem:U,DxLabel:H,DxNumberBox:Y,DxRequiredRule:L,DxPopup:W,DxExport:K,DxSelectBox:z,DxDateBox:J,DxButton:j,DxDataGrid:Q,DxColumn:X,DxGrouping:Z,DxGroupPanel:$,DxPager:ee,DxPaging:te,DxSearchPanel:oe,DxEditing:ae,DxFilterRow:ie,DxScrolling:se,DxLookup:ne,DxHeaderFilter:re,cellLink:le},data(){return{idSubsidiary:0,idEmployee:null,years:[],dataSource:{},subsidiary:[],employee:[],months:[],type:_e.data.data,year:0,month:0,searchModeOption:"contains",searchExprOption:"name",searchTimeoutOption:200,minSearchLengthOption:0,showDataBeforeSearchOption:!1,saleAmountFormat:{style:"currency",currency:"USD",useGrouping:!0,minimumSignificantDigits:3},refreshMode:"reshape",setTypeValue(t,a){t.catalogRegionStateId=null,t.catalogRegionCityId=null,this.defaultSetCellValue(t,a)}}},methods:{subsidiaryChange:async function(t){this.employee=[];let a=[];a.skip=0,a.take=0,a.requireTotalCount=!0,a.filter='["subsidiaryId","=","'+t.value+'"]';const{data:i}=await me.GetWithFilter(a);this.employee=i.data.data},loadPeriods:async function(){const t=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];let a=new Date;for(let i=0;i<12;i++)this.months=[...this.months,{value:i+1,text:t[i]}];for(let i=a.getFullYear()-4;i<=a.getFullYear();i++)this.years=[...this.years,{value:i,text:`${i}`}]},allowEditing(t){return!t.row.data.status=="G"},changeHandle:async function(){await this.loadDataSource(),console.log("changeHandle")},getSubsidiaries:async function(){const{data:t}=await pe.GetWithPagination({});this.subsidiary=t.data},loadDataSource:async function(){this.dataSource=new M({key:"id",load:t=>{console.log("dataSource",this.idEmployee,this.year,this.month,`${u}/filter/${this.idEmployee}/${this.year}/${this.month}`);let a={};return["skip","take","requireTotalCount","requireGroupCount","sort","filter","totalSummary","group","groupSummary"].forEach(i=>{i in t&&ge(t[i])&&(a[i]=JSON.stringify(t[i]))}),console.log(a),console.log("idemployee",this.idEmployee),this.idEmployee==null?{data:{},totalCount:0}:this.sendRequest(`${u}/filter/discretionary/${this.idEmployee}/${this.year}/${this.month}`,"GET",a).then(i=>(console.log("sendrequet",i),i.data.map(d=>{d.status_str=y.GetStatus(d.status).value,d.tipo_str=y.GetType(d.type).value}),i))},insert:t=>(t.status="G",t.year=this.year,t.month=this.month,t.type="A",t.employeeId=this.idEmployee,console.log("insert",t),this.sendRequest(`${u}`,"POST",{values:JSON.stringify(t)})),update:(t,a)=>(a.id=t,console.log("update",a),this.sendRequest(`${u}`,"PUT",{key:t,values:JSON.stringify(a)})),remove:t=>this.sendRequest(`${u}/${t}`,"DELETE",{}),byKey:t=>this.sendRequest(`${u}`,"GET",{Field:"ID",Value:t}).then(a=>a)})},sendRequest(t,a="GET",i={}){const d=Object.keys(i).map(e=>`${encodeURIComponent(e)}=${encodeURIComponent(i[e])}`).join("&");return a==="GET"?fetch(`${t}?${d}`,{method:a}).then(e=>e.json().then(r=>{if(e.ok)return r.data;throw r.Message})):fetch(t,{method:a,body:i.values,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(e=>e.ok?e.text().then(r=>r&&JSON.parse(r)):e.json().then(r=>{throw r.Message}))}},async beforeMount(){await this.getSubsidiaries(),await this.loadPeriods(),console.log("At this point, events and lifecycle have been initialized.")},async mounted(){let t=new Date;this.year=t.getFullYear(),this.month=t.getMonth()+1,this.loadDataSource()}},fe={id:"main-content"},ye={class:"container-fluid"},be={class:"block-header"},ve={class:"row clearfix"},we={class:"col-md-12 cont"},Se={class:"dx-field"},Ee=n("div",{class:"dx-field-label"},"Subsidiaria",-1),Pe={class:"dx-field-value"},Ge={class:"dx-field"},Oe=n("div",{class:"dx-field-label"},"Empleado",-1),Re={class:"dx-field-value"},Ce={class:"dx-field"},Fe=n("div",{class:"dx-field-label"},"A\xF1o",-1),Te={class:"dx-field-value"},Ie={class:"dx-field"},ke=n("div",{class:"dx-field-label"},"Mes",-1),Be={class:"dx-field-value"},Me={class:"row clearfix"},Ve={class:"col-md-12 cont"};function Le(t,a,i,d,e,r){const b=s("bread-crumb"),m=s("DxSelectBox"),_=s("DxGroupItem"),v=s("DxForm"),w=s("DxHeaderFilter"),S=s("DxGroupPanel"),E=s("DxGrouping"),P=s("DxExport"),G=s("DxSearchPanel"),O=s("DxFilterRow"),g=s("DxScrolling"),D=s("DxPaging"),R=s("DxPager"),C=s("DxPopup"),h=s("DxItem"),F=s("DxFormGrid"),T=s("DxEditing"),p=s("DxColumn"),f=s("DxRequiredRule"),I=s("DxLookup"),k=s("cellLink"),B=s("DxDataGrid");return ce(),de("div",fe,[n("div",ye,[n("div",be,[o(b)]),n("div",ve,[n("div",we,[o(v,{"col-count":2},{default:l(()=>[o(_,{"col-count":2},{default:l(()=>[n("div",Se,[Ee,n("div",Pe,[o(m,{items:e.subsidiary,onValueChanged:r.subsidiaryChange,"display-expr":"name",value:e.idSubsidiary,"onUpdate:value":a[0]||(a[0]=c=>e.idSubsidiary=c),"search-enabled":!0,"search-mode":e.searchModeOption,"search-expr":e.searchExprOption,"search-timeout":e.searchTimeoutOption,"min-search-length":e.minSearchLengthOption,"show-data-before-search":e.showDataBeforeSearchOption,"value-expr":"id"},null,8,["items","onValueChanged","value","search-mode","search-expr","search-timeout","min-search-length","show-data-before-search"])])]),n("div",Ge,[Oe,n("div",Re,[o(m,{items:e.employee,onValueChanged:r.changeHandle,"display-expr":"fullName",value:e.idEmployee,"onUpdate:value":a[1]||(a[1]=c=>e.idEmployee=c),"value-expr":"id","data-field":"Position","search-enable":"true",id:"idemployee","search-enabled":!0,"search-mode":e.searchModeOption,"search-expr":e.searchExprOption,"search-timeout":e.searchTimeoutOption,"min-search-length":e.minSearchLengthOption,"show-data-before-search":e.showDataBeforeSearchOption},null,8,["items","onValueChanged","value","search-mode","search-expr","search-timeout","min-search-length","show-data-before-search"])])])]),_:1}),o(_,{"col-count":3},{default:l(()=>[n("div",Ce,[Fe,n("div",Te,[o(m,{items:e.years,onValueChanged:r.changeHandle,"display-expr":"text",value:e.year,"onUpdate:value":a[2]||(a[2]=c=>e.year=c),"value-expr":"value","search-enable":"true","search-enabled":!0,"search-mode":e.searchModeOption,"search-expr":e.searchExprOption,"search-timeout":e.searchTimeoutOption,"min-search-length":e.minSearchLengthOption,"show-data-before-search":e.showDataBeforeSearchOption},null,8,["items","onValueChanged","value","search-mode","search-expr","search-timeout","min-search-length","show-data-before-search"])])]),n("div",Ie,[ke,n("div",Be,[o(m,{items:e.months,onValueChanged:r.changeHandle,"display-expr":"text",value:e.month,"onUpdate:value":a[3]||(a[3]=c=>e.month=c),"value-expr":"value","search-enable":"true","search-enabled":!0,"search-mode":e.searchModeOption,"search-expr":e.searchExprOption,"search-timeout":e.searchTimeoutOption,"min-search-length":e.minSearchLengthOption,"show-data-before-search":e.showDataBeforeSearchOption},null,8,["items","onValueChanged","value","search-mode","search-expr","search-timeout","min-search-length","show-data-before-search"])])])]),_:1})]),_:1})])]),n("div",Me,[n("div",Ve,[o(B,{id:"dataGridActivities","show-borders":!0,"data-source":e.dataSource,"column-auto-width":!0,"repaint-changes-only":!0,"remote-operations":!0},{"cell-link-template":l(({data:c})=>[o(k,{"cell-data":c,routePath:{name:"DirectParticipation",params:{id:c.data.id}}},null,8,["cell-data","routePath"])]),default:l(()=>[o(w,{visible:!0}),o(S,{visible:!0}),o(E,{"auto-expand-all":!0}),o(P,{enabled:!0,"allow-export-selected-data":!0}),o(G,{visible:!0,width:240,placeholder:"Buscar..."}),o(O,{visible:!0}),o(g,{"row-rendering-mode":"virtual"}),o(D,{"page-size":10}),o(R,{visible:!0,"allowed-page-sizes":[10,20,50],"show-page-size-selector":!0,"show-info":!1,"show-navigation-buttons":!0}),o(T,{"refresh-mode":e.refreshMode,"allow-updating":r.allowEditing,"allow-adding":this.idEmployee!=null,"allow-deleting":r.allowEditing,mode:"popup"},{default:l(()=>[o(g,{"row-rendering-mode":"virtual"}),o(D,{"page-size":10}),o(C,{"show-title":!0,width:700,height:525,title:"Registro de Participaciones por Movimientos"}),o(F,null,{default:l(()=>[o(h,{"col-count":2,"col-span":2,"item-type":"group"},{default:l(()=>[o(h,{"data-field":"catalogDiscretionaryTypeId"}),o(h,{"data-field":"description"}),o(h,{"data-field":"value"}),o(h,{"data-field":"status_str","editor-options":{visible:!1}})]),_:1})]),_:1})]),_:1},8,["refresh-mode","allow-updating","allow-adding","allow-deleting"]),o(p,{"allow-editing":!1,width:300,"data-field":"date",caption:"Fecha"}),o(p,{"allow-editing":!0,"data-field":"description",caption:"Detalle","cell-template":"cell-link-template"},{default:l(()=>[o(f)]),_:1}),o(p,{width:150,"set-cell-value":e.setTypeValue,"data-type":"string","data-field":"catalogDiscretionaryTypeId",caption:"Tipo"},{default:l(()=>[o(I,{"data-source":e.type,"value-expr":"id","display-expr":"value"},null,8,["data-source"])]),_:1},8,["set-cell-value"]),o(p,{"allow-editing":!1,width:300,"data-field":"status_str",caption:"Estado"}),o(p,{"allow-editing":!0,format:e.saleAmountFormat,width:150,"data-field":"value",caption:"Valor"},{default:l(()=>[o(f)]),_:1},8,["format"])]),_:1},8,["data-source"])])])])])}var Ze=ue(De,[["render",Le]]);export{Ze as default};
