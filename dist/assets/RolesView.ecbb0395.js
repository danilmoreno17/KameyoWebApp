import{B as v}from"./BreadCrumb.9367f10a.js";import{_ as R}from"./tab-panel.6a570691.js";import"./fetch.5522b714.js";import{o as p,a as g,r as s,f as n,w as d,c,t as S,b as y,e as b}from"./vendor.7710df40.js";import{_ as x}from"./index.7b655b97.js";import{D as C,a as $,b as N,c as k,d as F,e as j,j as I,i as G,g as U}from"./data-grid.24b081de.js";import{D as O}from"./form.181df029.js";import{C as B}from"./index.3bbb47f2.js";const J={},V={class:"container"};function M(e,t){return p(),g("div",V,"Permissions template")}var z=x(J,[["render",M]]);const q="https://kameyo-api.azurewebsites.net",m=`${q}/api/roles`;function A(e){return e!=null&&e!==""}function L(e){if(console.log("checkStatus",e),e.status>=200&&e.status<300)return e;var t=new Error(e.statusText);throw t.response=e,t}function H(e){return console.log("parseJSON",e),e.json()}const K={name:"UsersView",components:{DxDataGrid:C,DxColumn:$,DxScrolling:N,DxPager:k,DxPaging:F,DxEditing:j,DxForm:I,DxItem:O,DxFilterRow:G,DxPopup:U},data(){return{displayMode:"full",pageSizes:[5,10,"all"],selectedIndex:0,loop:!1,animationEnabled:!0,swipeEnabled:!0,tabs:[{tabName:"Roles"},{tabName:"Permissions"}],dataSource:new B({key:"id",load:this.loadData,insert:e=>this.createEntity(JSON.stringify(e)),update:(e,t)=>this.updateEntity({key:e,values:t}),remove:e=>this.sendRequest(`${m}/${e}`,"DELETE"),errorHandler:e=>{console.log(e.message)}})}},methods:{sendRequest(e,t="GET",o={}){const i=Object.keys(o).map(a=>`${encodeURIComponent(a)}=${encodeURIComponent(o[a])}`).join("&");return console.log("data ",o),console.log("params ",i),t==="GET"?fetch(e,{method:t}).then(a=>a.json().then(l=>{if(a.ok)return l.data;throw l.Message})):fetch(e,{method:t,body:i,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}}).then(a=>a.ok?a.text().then(l=>l&&JSON.parse(l)):a.json().then(l=>{throw l.Message}))},loadData(e){console.log("loadData - loadOptions",e);let t="?";return["skip","take","requireTotalCount","requireGroupCount","sort","filter","totalSummary","group","groupSummary"].forEach(o=>{o in e&&A(e[o])&&(t+=`${o}=${JSON.stringify(e[o])}&`)}),t=t.slice(0,-1),fetch(`${m}${t}`,{method:"GET",headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(o=>o.json()).then(o=>(console.log("loadData.data -> ",o),console.log("loadData.data -> ",o.data.data),{data:o.data.data,totalCount:o.data.totalCount,summary:o.data.summary,groupCount:o.data.groupCount})).catch(()=>{throw new Error("Data Loading Error")})},async createEntity(e={}){const t="POST";return await fetch(`${m}`,{method:t,body:e,headers:{"Content-Type":"application/json"}})},async updateEntity(e={}){console.log("updateEntity - data ->",e);const t="PUT";return fetch(`${m}/${e.key}`,{method:t,body:JSON.stringify(e.values),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(o=>(console.log("updateEntity - result => ",o),o.ok?o.text().then(i=>i&&JSON.parse(i)):o.json().then(i=>{throw i.Message})))},async loadDataFetch(e){return await fetch(`${e}`).then(L).then(H).then(t=>(console.log(`loadDataFetch -> ${e}`,t.data.data),t.data.data))},refresh(){this.dataSource.load()}}};function Q(e,t,o,i,a,l){const u=s("DxFilterRow"),_=s("DxScrolling"),h=s("DxPaging"),f=s("DxPager"),r=s("DxPopup"),D=s("DxItem"),E=s("DxForm"),T=s("DxEditing"),w=s("DxColumn"),P=s("DxDataGrid");return p(),g("div",null,[n(P,{id:"dataGridRoles","data-source":a.dataSource,"show-borders":!0,"repaint-changes-only":!0,"remote-operations":!0},{default:d(()=>[n(u,{visible:!0}),n(_,{"row-rendering-mode":"virtual"}),n(h,{"page-size":10}),n(f,{visible:!0,"allowed-page-sizes":[10,20,50],"display-mode":a.displayMode,"show-page-size-selector":!0,"show-info":!1,"show-navigation-buttons":!0},null,8,["display-mode"]),n(T,{"refresh-mode":e.full,"allow-updating":!0,"allow-adding":!0,"allow-deleting":!0,mode:"popup"},{default:d(()=>[n(r,{"show-title":!0,width:700,height:525,title:"Roles"}),n(E,null,{default:d(()=>[n(D,{"col-count":2,"col-span":2,"item-type":"group"},{default:d(()=>[n(D,{"data-field":"name"})]),_:1})]),_:1})]),_:1},8,["refresh-mode"]),n(w,{"data-field":"id",caption:"id","data-type":"string",visible:!1,width:200}),n(w,{"data-field":"name",caption:"Rol","data-type":"string",width:200})]),_:1},8,["data-source"])])}var W=x(K,[["render",Q]]);const X={name:"UsersView",components:{BreadCrumb:v,DxTabPanel:R,PermissionsTemplate:z,RoleTemplate:W},data(){return{selectedIndex:0,loop:!1,animationEnabled:!0,swipeEnabled:!0,tabs:[{tabName:"Roles",tabTitle:"Roles"},{tabName:"Permissions",tabTitle:"Permisos"}]}}},Y={id:"main-content"},Z={class:"container-fluid"},ee={class:"block-header"},te={class:"row clearfix"},oe={class:"col-md-12"};function ae(e,t,o,i,a,l){const u=s("bread-crumb"),_=s("RoleTemplate"),h=s("PermissionsTemplate"),f=s("DxTabPanel");return p(),g("div",Y,[c("div",Z,[c("div",ee,[n(u)]),c("div",te,[c("div",oe,[n(f,{id:"tabPanelRole","data-source":a.tabs,"selected-index":a.selectedIndex,"onUpdate:selected-index":t[0]||(t[0]=r=>a.selectedIndex=r),loop:a.loop,"animation-enabled":a.animationEnabled,"swipe-enabled":a.swipeEnabled},{title:d(({data:r})=>[c("span",null,S(r.tabTitle),1)]),item:d(({data:r})=>[r.tabName=="Roles"?(p(),y(_,{key:0,"template-data":r},null,8,["template-data"])):b("",!0),r.tabName=="Permissions"?(p(),y(h,{key:1,"template-data":r},null,8,["template-data"])):b("",!0)]),_:1},8,["data-source","selected-index","loop","animation-enabled","swipe-enabled"])])])])])}var me=x(X,[["render",ae]]);export{me as default};
