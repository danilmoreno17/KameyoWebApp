import{B as Be}from"./BreadCrumb.9367f10a.js";import{D as Ae,a as we,b as Oe,c as Ve,d as Le,e as Ne,j as $e,i as Pe,B as Me,h as Re,g as Ue}from"./data-grid.24b081de.js";import{D as ke}from"./button.996b9c36.js";import{D as Ge}from"./form.181df029.js";import{an as je,bq as He,B as ze,a as V,b as Ke,z as We,s as Xe,k as Ze,as as qe,h as G,e as Je,br as Qe,bs as Ye,N as et,bl as ce,C as te}from"./index.3bbb47f2.js";import"./fetch.5522b714.js";import{c as tt}from"./CellLinkTemplate.75b044c2.js";import{U as j,a3 as nt,ac as L,a7 as H,a2 as z,$ as _,D as x,Z as y,_ as K,aa as E,J as ne,H as ae,I as b,C as at,aJ as it,ab as lt,Y as ie,X as le,b9 as ot,b1 as oe,r as u,o as T,b as O,c as D,a as N,n as st,e as F,f as s,w as h}from"./vendor.7710df40.js";import{a as rt}from"./utils.scroll.55667bed.js";import{_ as X}from"./index.7b655b97.js";import{D as ut,a as dt}from"./progress-bar.d98eaefe.js";import{p as he}from"./personsRepository.d2cb1535.js";var o={},A="dxTagData",pt="dx-tagbox",ct="dx-tag-container",w="dx-tag",se="dx-tagbox-multi-tag",re="dx-tag-custom",ue="dx-tag-remove-button",ht="dx-tagbox-only-select",de="dx-tagbox-single-line",mt="dx-tagbox-popup-wrapper",_t="dx-tag-content",gt="dx-tagbox-default-template",ft="dx-tagbox-custom-template",pe="dx-native-click",vt="dx-texteditor-input-container",xt=-.3,me=je.inherit({_supportedKeys:function(){var e=this.callBase(),t=i=>this._list._keyboardHandler(i),n=this.option("rtlEnabled");return j({},e,{backspace:function(i){if(!!this._isCaretAtTheStart()){this._processKeyboardEvent(i),this._isTagRemoved=!0;var a=this._$focusedTag||this._tagElements().last();this._$focusedTag&&this._moveTagFocus("prev",!0),a.length!==0&&(this._preserveFocusedTag=!0,this._removeTagElement(a),delete this._preserveFocusedTag)}},upArrow:(i,a)=>i.altKey||!this._list?e.upArrow.call(this,i):t(a),downArrow:(i,a)=>i.altKey||!this._list?e.downArrow.call(this,i):t(a),del:function(i){if(!(!this._$focusedTag||!this._isCaretAtTheStart())){this._processKeyboardEvent(i),this._isTagRemoved=!0;var a=this._$focusedTag;this._moveTagFocus("next",!0),this._preserveFocusedTag=!0,this._removeTagElement(a),delete this._preserveFocusedTag}},enter:function(i,a){var l=this._list&&this._list.option("focusedElement")!==null,r=this.option("acceptCustomValue")&&!l;if(r){i.preventDefault(),this._searchValue()!==""&&this._customItemAddedHandler(i);return}this.option("opened")&&(this._saveValueChangeEvent(i),t(a),i.preventDefault())},space:function(i,a){var l=this.option("opened"),r=this._shouldRenderSearchEvent();l&&!r&&(this._saveValueChangeEvent(i),t(a),i.preventDefault())},leftArrow:function(i){if(!(!this._isCaretAtTheStart()||this._isEmpty()||this._isEditable()&&n&&!this._$focusedTag)){i.preventDefault();var a=n?"next":"prev";this._moveTagFocus(a),!this.option("multiline")&&this._scrollContainer(a)}},rightArrow:function(i){if(!(!this._isCaretAtTheStart()||this._isEmpty()||this._isEditable()&&!n&&!this._$focusedTag)){i.preventDefault();var a=n?"prev":"next";this._moveTagFocus(a),!this.option("multiline")&&this._scrollContainer(a)}}})},_processKeyboardEvent:function(e){e.preventDefault(),e.stopPropagation(),this._saveValueChangeEvent(e)},_isEmpty:function(){return this._getValue().length===0},_updateTagsContainer:function(e){this._$tagsContainer=e.addClass(ct).addClass(pe),this._$tagsContainer.parent().addClass(pe)},_allowSelectItemByTab:function(){return!1},_isCaretAtTheStart:function(){var e=He(this._input());return e.start===0&&e.end===0},_moveTagFocus:function(e,t){if(!this._$focusedTag){var n=this._tagElements();this._$focusedTag=e==="next"?n.first():n.last(),this._toggleFocusClass(!0,this._$focusedTag);return}var i=this._$focusedTag[e](".".concat(w));i.length>0?this._replaceFocusedTag(i):(t||e==="next"&&this._isEditable())&&this._clearTagFocus()},_replaceFocusedTag:function(e){this._toggleFocusClass(!1,this._$focusedTag),this._$focusedTag=e,this._toggleFocusClass(!0,this._$focusedTag)},_clearTagFocus:function(){!this._$focusedTag||(this._toggleFocusClass(!1,this._$focusedTag),delete this._$focusedTag)},_focusClassTarget:function(e){return e&&e.length&&e[0]!==this._focusTarget()[0]?e:this.callBase()},_getLabelContainer:function(){return this._$tagsContainer},_scrollContainer:function(e){if(!(this.option("multiline")||!nt())&&!!this._$tagsContainer){var t=this._getScrollPosition(e);this._$tagsContainer.scrollLeft(t)}},_getScrollPosition:function(e){return e==="start"||e==="end"?this._getBorderPosition(e):this._$focusedTag?this._getFocusedTagPosition(e):this._getBorderPosition("end")},_getBorderPosition:function(e){var t=this.option("rtlEnabled"),n=e==="end"^t,i=t?-1:1;return n^!t?0:i*(this._$tagsContainer.get(0).scrollWidth-L(this._$tagsContainer))},_getFocusedTagPosition:function(e){var t=this.option("rtlEnabled"),n=e==="next"^t,{left:i}=this._$focusedTag.position(),a=this._$tagsContainer.scrollLeft();return n&&(i+=L(this._$focusedTag,!0)-L(this._$tagsContainer)),n^i<0&&(a+=i),a},_setNextValue:H,_getDefaultOptions:function(){return j(this.callBase(),{value:[],showDropDownButton:!1,maxFilterQueryLength:1500,tagTemplate:"tag",selectAllText:z.format("dxList-selectAll"),hideSelectedItems:!1,selectedItems:[],selectAllMode:"page",onSelectAllValueChanged:null,maxDisplayedTags:void 0,showMultiTagOnly:!0,onMultiTagPreparing:null,multiline:!0,useSubmitBehavior:!0})},_init:function(){this.callBase(),this._selectedItems=[],this._initSelectAllValueChangedAction()},_initActions:function(){this.callBase(),this._initMultiTagPreparingAction()},_initMultiTagPreparingAction:function(){this._multiTagPreparingAction=this._createActionByOption("onMultiTagPreparing",{beforeExecute:function(e){this._multiTagPreparingHandler(e.args[0])}.bind(this),excludeValidators:["disabled","readOnly"]})},_multiTagPreparingHandler:function(e){var{length:t}=this._getValue();this.option("showMultiTagOnly")?e.text=z.getFormatter("dxTagBox-selected")(t):e.text=z.getFormatter("dxTagBox-moreSelected")(t-this.option("maxDisplayedTags")+1)},_initDynamicTemplates:function(){this.callBase(),this._templateManager.addDefaultTemplates({tag:new ze((e,t)=>{var n,i=_("<div>").addClass(_t);_("<span>").text((n=t.text)!==null&&n!==void 0?n:t).appendTo(i),_("<div>").addClass(ue).appendTo(i),e.append(i)},["text"],this.option("integrationOptions.watchMethod"),{text:this._displayGetter})})},_toggleSubmitElement:function(e){e?(this._renderSubmitElement(),this._setSubmitValue()):(this._$submitElement&&this._$submitElement.remove(),delete this._$submitElement)},_renderSubmitElement:function(){!this.option("useSubmitBehavior")||(this._$submitElement=_("<select>").attr("multiple","multiple").css("display","none").appendTo(this.$element()))},_setSubmitValue:function(){if(!!this.option("useSubmitBehavior")){for(var e=this._getValue(),t=[],n=0,i=e.length;n<i;n++){var a=this._shouldUseDisplayValue(e[n]);t.push(_("<option>").val(a?this._displayGetter(e[n]):e[n]).attr("selected","selected"))}this._getSubmitElement().empty().append(t)}},_initMarkup:function(){this._tagElementsCache=_();var e=!this.option("multiline");this.$element().addClass(pt).toggleClass(ht,!(this.option("searchEnabled")||this.option("acceptCustomValue"))).toggleClass(de,e),this._initTagTemplate(),this.callBase()},_render:function(){this.callBase(),this._renderTagRemoveAction(),this._renderSingleLineScroll(),this._scrollContainer("start")},_initTagTemplate:function(){this._tagTemplate=this._getTemplateByOption("tagTemplate")},_renderField:function(){var e=!x(this.option("fieldTemplate"));this.$element().toggleClass(gt,e).toggleClass(ft,!e),this.callBase()},_renderTagRemoveAction:function(){var e=this._createAction(this._removeTagHandler.bind(this)),t=V(Ke,"dxTagBoxTagRemove");y.off(this._$tagsContainer,t),y.on(this._$tagsContainer,t,".".concat(ue),n=>{e({event:n})})},_renderSingleLineScroll:function(){var e=V("dxmousewheel",this.NAME),t=this.$element(),n=this.option("multiline");if(y.off(t,e),We.real().deviceType!=="desktop"){this._$tagsContainer&&this._$tagsContainer.css("overflowX",n?"":"auto");return}n||y.on(t,e,this._tagContainerMouseWheelHandler.bind(this))},_tagContainerMouseWheelHandler:function(e){var t=this._$tagsContainer.scrollLeft(),n=e.delta*xt;if(!Xe(e)&&rt(this._$tagsContainer,n,!0))return this._$tagsContainer.scrollLeft(t+n),!1},_renderEvents:function(){this.callBase();var e=this._input(),t=V("keydown",this.NAME);y.on(e,t,n=>{var i=Ze(n);!this._isControlKey(i)&&this._isEditable()&&this._clearTagFocus()})},_popupWrapperClass:function(){return this.callBase()+" "+mt},_renderInput:function(){this.callBase(),this._renderPreventBlurOnInputClick()},_renderPreventBlurOnInputClick:function(){var e=V("mousedown","dxTagBox");y.off(this._inputWrapper(),e),y.on(this._inputWrapper(),e,t=>{t.target!==this._input()[0]&&t.preventDefault()})},_renderInputValueImpl:function(){return this._renderMultiSelect()},_loadInputValue:function(){return K()},_clearTextValue:function(){this._input().val(""),this._toggleEmptinessEventHandler(),this.option("text","")},_focusInHandler:function(e){this._preventNestedFocusEvent(e)||this._scrollContainer("end"),this.callBase(e)},_renderInputValue:function(){return this.option("displayValue",this._searchValue()),this.callBase()},_restoreInputText:function(e){e||this._clearTextValue()},_focusOutHandler:function(e){this._preventNestedFocusEvent(e)||(this._clearTagFocus(),this._scrollContainer("start")),this.callBase(e)},_getFirstPopupElement:function(){return this.option("showSelectionControls")?this._list.$element():this.callBase()},_initSelectAllValueChangedAction:function(){this._selectAllValueChangeAction=this._createActionByOption("onSelectAllValueChanged")},_renderList:function(){this.callBase(),this._setListDataSourceFilter(),this.option("showSelectionControls")&&(this._list.registerKeyHandler("tab",e=>this._popupElementTabHandler(e)),this._list.registerKeyHandler("escape",e=>this._popupElementEscHandler(e)))},_canListHaveFocus:function(){return this.option("applyValueMode")==="useButtons"},_listConfig:function(){var e=this.option("showSelectionControls")?"all":"multiple";return j(this.callBase(),{selectionMode:e,selectAllText:this.option("selectAllText"),onSelectAllValueChanged:t=>{var{value:n}=t;this._selectAllValueChangeAction({value:n})},selectAllMode:this.option("selectAllMode"),selectedItems:this._selectedItems,onFocusedItemChanged:null})},_renderMultiSelect:function(){var e=new E;return this._updateTagsContainer(this._$textEditorInputContainer),this._renderInputSize(),this._renderTags().done(()=>{this._popup&&this._popup.refreshPosition(),e.resolve()}).fail(e.reject),e.promise()},_listItemClickHandler:function(e){!this.option("showSelectionControls")&&this._clearTextValue(),this.option("applyValueMode")!=="useButtons"&&(this.callBase(e),this._saveValueChangeEvent(void 0))},_shouldClearFilter:function(){var e=this.callBase(),t=this.option("showSelectionControls");return!t&&e},_renderInputSize:function(){var e=this._input(),t=e.val(),n=ne(t)&&t,i="",a="",l=this.option("searchEnabled")||this.option("acceptCustomValue");if(n&&l){var r=qe(e,t,{includePaddings:!0});r.insertAfter(e),i=L(r)+5,r.remove()}else t||(a=1);e.css("width",i),e.attr("size",a)},_renderInputSubstitution:function(){this.callBase(),this._updateWidgetHeight()},_getValue:function(){return this.option("value")||[]},_multiTagRequired:function(){var e=this._getValue(),t=this.option("maxDisplayedTags");return x(t)&&e.length>t},_renderMultiTag:function(e){var t=_("<div>").addClass(w).addClass(se),n={multiTagElement:G(t),selectedItems:this.option("selectedItems")};return this._multiTagPreparingAction(n),n.cancel?!1:(t.data(A,n.text),t.insertBefore(e),this._tagTemplate.render({model:n.text,container:G(t)}),t)},_getFilter:function(e){var t=this._dataSource.filter(),n=e.getCombinedFilter(this.option("valueExpr"),t),i=encodeURI(JSON.stringify(n)).length,a=this.option("maxFilterQueryLength");if(i<=a)return n;Je.log("W1019",a)},_getFilteredItems:function(e){var t,n,i;(t=this._loadFilteredItemsPromise)===null||t===void 0||t.reject();var a=new Qe(e),l=(n=this._list)===null||n===void 0?void 0:n.option("selectedItems"),r=!!l&&((i=this._list.getDataSource())===null||i===void 0?void 0:i.isLoaded()),m=l||this.option("selectedItems"),c=a.getLocalFilter(this._valueGetter),g=m.filter(c),I=g.length===e.length,f=new E,v=this._dataSource;if(v){if((!this._isDataSourceChanged||r)&&I)return f.resolve(g).promise();var{customQueryParams:p,expand:P,select:M}=v.loadOptions(),S=this._getFilter(a);return v.store().load({filter:S,customQueryParams:p,expand:P,select:M}).done((B,R)=>{if(this._isDataSourceChanged=!1,this._disposed){f.reject();return}var{data:U}=Ye(B,R),k=v._applyMapFunction(U);f.resolve(k.filter(c))}).fail(f.reject),this._loadFilteredItemsPromise=f,f.promise()}else return f.resolve([]).promise()},_createTagsData:function(e,t){var n=[],i={},a=this._valueGetterExpr()==="this",l={};t.forEach(c=>{var g=a?JSON.stringify(c):this._valueGetter(c);l[g]=c});var r=[];e.forEach((c,g)=>{var I=l[a?JSON.stringify(c):c];if(a&&!x(I))r.push(this._loadItem(c,i).always(v=>{var p=this._createTagData(n,v,c,g);n.splice(g,0,p)}));else{var f=this._createTagData(n,I,c,g);n.splice(g,0,f)}});var m=new E;return K.apply(this,r).always(function(){m.resolve(n)}),m.promise()},_createTagData:function(e,t,n,i){if(x(t))return this._selectedItems.push(t),t;var a=this.option("selectedItem"),l=this._valueGetter(a)===n?a:n;return l},_isGroupedData:function(){var e;return this.option("grouped")&&!((e=this._dataSource)!==null&&e!==void 0&&e.group())},_getItemsByValues:function(e){var t=[];return e.forEach(function(n){var i=this._getItemFromPlain(n);x(i)&&t.push(i)}.bind(this)),t},_getFilteredGroupedItems:function(e){var t=new E;return this._dataSource&&(this._filteredGroupedItemsLoadPromise&&this._dataSource.cancel(this._filteredGroupedItemsLoadPromise.operationId),this._dataSource.items().length?t.resolve(this._getItemsByValues(e)):this._filteredGroupedItemsLoadPromise=this._dataSource.load().done(()=>{t.resolve(this._getItemsByValues(e))}).fail(()=>{t.resolve([])}).always(()=>{this._filteredGroupedItemsLoadPromise=void 0})),t.promise()},_loadTagsData:function(){var e=this._getValue(),t=new E;this._selectedItems=[];var n=this._isGroupedData()?this._getFilteredGroupedItems(e):this._getFilteredItems(e);return n.done(i=>{var a=this._createTagsData(e,i);a.always(function(l){t.resolve(l)})}).fail(t.reject.bind(this)),t.promise()},_renderTags:function(){var e=new E,t=!1;return this._shouldGetItemsFromPlain(this._valuesToUpdate)&&(this._selectedItems=this._getItemsFromPlain(this._valuesToUpdate),this._selectedItems.length===this._valuesToUpdate.length&&(this._renderTagsImpl(this._selectedItems),t=!0,e.resolve())),t||this._loadTagsData().done(n=>{if(this._disposed){e.reject();return}this._renderTagsImpl(n),e.resolve()}).fail(e.reject),e.promise()},_renderTagsImpl:function(e){this._renderTagsCore(e),this._renderEmptyState(),this._preserveFocusedTag||this._clearTagFocus()},_shouldGetItemsFromPlain:function(e){return e&&this._dataSource.isLoaded()&&e.length<=this._getPlainItems().length},_getItemsFromPlain:function(e){var t=this._getSelectedItemsFromList(e),n=t.length===0&&e.length>0||t.length<e.length;if(n){var i=this._getPlainItems();t=this._filterSelectedItems(i,e)}return t},_getSelectedItemsFromList:function(e){var t,n=(t=this._list)===null||t===void 0?void 0:t.option("selectedItems"),i=[];return e.length===n?.length&&(i=this._filterSelectedItems(n,e)),i},_filterSelectedItems:function(e,t){var n=e.filter(i=>{for(var a,l=0;l<t.length;l++)if(a=t[l],ae(a)){if(this._isValueEquals(i,a))return!0}else if(this._isValueEquals(this._valueGetter(i),a))return!0;return!1},this);return n},_integrateInput:function(){this._isInputReady.resolve(),this.callBase(),this._updateTagsContainer(_(".".concat(vt))),this._renderTagRemoveAction()},_renderTagsCore:function(e){var t;(t=this._isInputReady)===null||t===void 0||t.reject(),this._isInputReady=new E,this._renderField(),this.option("selectedItems",this._selectedItems.slice()),this._cleanTags(),this._input().length>0&&this._isInputReady.resolve(),K(this._isInputReady).done(()=>{this._renderTagsElements(e)})},_renderTagsElements(e){var t=this._multiTagRequired()&&this._renderMultiTag(this._input()),n=this.option("showMultiTagOnly"),i=this.option("maxDisplayedTags");e.forEach((a,l)=>{if(t&&n||t&&!n&&l-i>=-1)return!1;this._renderTag(a,t||this._input())}),this._isFocused()&&this._scrollContainer("end"),this._refreshTagElements()},_cleanTags:function(){if(this._multiTagRequired())this._tagElements().remove();else{var e=this._tagElements(),t=this._getValue();b(e,function(n,i){var a=_(i),l=at(a.data(A),t);l<0&&a.remove()})}},_renderEmptyState:function(){var e=!(this._getValue().length||this._selectedItems.length||this._searchValue());this._toggleEmptiness(e),this._renderDisplayText()},_renderDisplayText:function(){this._renderInputSize()},_refreshTagElements:function(){this._tagElementsCache=this.$element().find(".".concat(w))},_tagElements:function(){return this._tagElementsCache},_applyTagTemplate:function(e,t){this._tagTemplate.render({model:e,container:G(t)})},_renderTag:function(e,t){var n=this._valueGetter(e);if(!!x(n)){var i=this._getTag(n),a=this._displayGetter(e),l=this._getItemModel(e,a);i?(x(a)&&(i.empty(),this._applyTagTemplate(l,i)),i.removeClass(re)):(i=this._createTag(n,t),x(e)?this._applyTagTemplate(l,i):(i.addClass(re),this._applyTagTemplate(n,i)))}},_getItemModel:function(e,t){return ae(e)&&x(t)?e:it(t,"")},_getTag:function(e){for(var t=this._tagElements(),n=t.length,i=!1,a=0;a<n;a++){var l=t[a],r=lt(l,A);if(e===r||ie(e,r)){i=_(l);break}}return i},_createTag:function(e,t){return _("<div>").addClass(w).data(A,e).insertBefore(t)},_toggleEmptinessEventHandler:function(){this._toggleEmptiness(!this._getValue().length&&!this._searchValue().length)},_customItemAddedHandler:function(e){this.callBase(e),this._clearTextValue()},_removeTagHandler:function(e){var t=e.event;t.stopPropagation(),this._saveValueChangeEvent(t);var n=_(t.target).closest(".".concat(w));this._removeTagElement(n)},_removeTagElement:function(e){if(e.hasClass(se)){this.option("showMultiTagOnly")?this.reset():this.option("value",this._getValue().slice(0,this.option("maxDisplayedTags")));return}var t=e.data(A);this._removeTagWithUpdate(t),this._refreshTagElements()},_updateField:H,_removeTagWithUpdate:function(e){var t=this._getValue().slice();this._removeTag(t,e),this.option("value",t),t.length===0&&this._clearTagFocus()},_getCurrentValue:function(){return this._lastValue()},_selectionChangeHandler:function(e){if(this.option("applyValueMode")!=="useButtons"){var t=this._getValue().slice();if(b(e.removedItems||[],(i,a)=>{this._removeTag(t,this._valueGetter(a))}),b(e.addedItems||[],(i,a)=>{this._addTag(t,this._valueGetter(a))}),this._updateWidgetHeight(),!ie(this._list.option("selectedItemKeys"),this.option("value"))){var n=this._list._getSelectionChangeEvent();n&&this._saveValueChangeEvent(n),this.option("value",t)}this._list._saveSelectionChangeEvent(void 0)}},_removeTag:function(e,t){var n=this._valueIndex(t,e);n>=0&&e.splice(n,1)},_addTag:function(e,t){var n=this._valueIndex(t);n<0&&e.push(t)},_fieldRenderData:function(){return this._selectedItems.slice()},_completeSelection:function(e){this.option("showSelectionControls")||this._setValue(e)},_setValue:function(e){if(e!==null){var t=this.option("applyValueMode")==="useButtons",n=this._valueIndex(e),i=(t?this._list.option("selectedItemKeys"):this._getValue()).slice();n>=0?i.splice(n,1):i.push(e),this.option("applyValueMode")==="useButtons"?this._list.option("selectedItemKeys",i):this.option("value",i)}},_isSelectedValue:function(e,t){return this._valueIndex(e,null,t)>-1},_valueIndex:function(e,t,n){var i=-1;return n&&typeof e!="object"&&(n.indexByValues||(n.indexByValues={},t=t||this._getValue(),t.forEach(function(a,l){n.indexByValues[a]=l})),e in n.indexByValues)?n.indexByValues[e]:(t=t||this._getValue(),b(t,(a,l)=>{if(this._isValueEquals(e,l))return i=a,!1}),i)},_lastValue:function(){var e=this._getValue(),t=e[e.length-1];return t??null},_valueChangeEventHandler:H,_shouldRenderSearchEvent:function(){return this.option("searchEnabled")||this.option("acceptCustomValue")},_searchHandler:function(e){this.option("searchEnabled")&&!!e&&!this._isTagRemoved&&(this.callBase(arguments),this._setListDataSourceFilter()),this._updateWidgetHeight(),delete this._isTagRemoved},_updateWidgetHeight:function(){var e=this.$element(),t=le(e);this._renderInputSize();var n=le(e);this._popup&&this.option("opened")&&this._isEditable()&&n!==t&&this._popup.repaint()},_refreshSelected:function(){var e;!((e=this._list)===null||e===void 0)&&e.getDataSource()&&this._list.option("selectedItems",this._selectedItems)},_resetListDataSourceFilter:function(){var e=this._getDataSource();!e||(delete this._userFilter,e.filter(null),e.reload())},_setListDataSourceFilter:function(){if(!(!this.option("hideSelectedItems")||!this._list)){var e=this._getDataSource();if(!!e){var t=this._valueGetterExpr();if(ne(t)&&t!=="this"){var n=this._dataSourceFilterExpr();this._userFilter===void 0&&(this._userFilter=e.filter()||null),this._userFilter&&n.push(this._userFilter),n.length?e.filter(n):e.filter(null)}else e.filter(this._dataSourceFilterFunction.bind(this));e.load()}}},_dataSourceFilterExpr:function(){var e=[];return b(this._getValue(),(t,n)=>{e.push(["!",[this._valueGetterExpr(),n]])}),e},_dataSourceFilterFunction:function(e){var t=this._valueGetter(e),n=!0;return b(this._getValue(),(i,a)=>{if(this._isValueEquals(a,t))return n=!1,!1}),n},_dataSourceChangedHandler:function(){this._isDataSourceChanged=!0,this.callBase.apply(this,arguments)},_applyButtonHandler:function(e){this._saveValueChangeEvent(e.event),this.option("value",this._getSortedListValues()),this._clearTextValue(),this.callBase(),this._cancelSearchIfNeed()},_getSortedListValues:function(){var e=this._getListValues(),t=this.option("value")||[],n=e.length?t.filter(a=>e.indexOf(a)!==-1):[],i=n.length?e.filter(a=>t.indexOf(a)===-1):e;return n.concat(i)},_getListValues:function(){if(!this._list)return[];var e=this._getPlainItems(this._list.option("selectedItems")),t=[];return b(e,(n,i)=>{t[n]=this._valueGetter(i)}),t},_setListDataSource:function(){var e=this._getValue();this.callBase(),e!==this.option("value")&&this.option("value",e),this._refreshSelected()},_renderOpenedState:function(){this.callBase(),this.option("applyValueMode")==="useButtons"&&!this.option("opened")&&this._refreshSelected()},reset:function(){this._restoreInputText();var e=this._getDefaultOptions().value,t=this.option("value");e&&e.length===0&&t&&e.length===t.length||this.callBase()},_clean:function(){this.callBase(),delete this._defaultTagTemplate,delete this._valuesToUpdate,delete this._tagTemplate},_removeDuplicates:function(e,t){var n=[];return b(e,(i,a)=>{var l=t.filter(r=>this._valueGetter(a)===this._valueGetter(r));l.length||n.push(a)}),n},_optionChanged:function(e){switch(e.name){case"onSelectAllValueChanged":this._initSelectAllValueChangedAction();break;case"onMultiTagPreparing":this._initMultiTagPreparingAction(),this._renderTags();break;case"hideSelectedItems":e.value?this._setListDataSourceFilter():this._resetListDataSourceFilter();break;case"useSubmitBehavior":this._toggleSubmitElement(e.value);break;case"displayExpr":this.callBase(e),this._initTemplates(),this._invalidate();break;case"tagTemplate":this._initTagTemplate(),this._invalidate();break;case"selectAllText":this._setListOption("selectAllText",this.option("selectAllText"));break;case"readOnly":case"disabled":this.callBase(e),!e.value&&this._refreshEvents();break;case"value":this._valuesToUpdate=e?.value,this.callBase(e),this._valuesToUpdate=void 0,this._setListDataSourceFilter();break;case"maxDisplayedTags":case"showMultiTagOnly":this._renderTags();break;case"selectAllMode":this._setListOption(e.name,e.value);break;case"selectedItem":break;case"selectedItems":this._selectionChangedAction({addedItems:this._removeDuplicates(e.value,e.previousValue),removedItems:this._removeDuplicates(e.previousValue,e.value)});break;case"multiline":this.$element().toggleClass(de,!e.value),this._renderSingleLineScroll();break;case"maxFilterQueryLength":break;default:this.callBase(e)}},_getActualSearchValue:function(){return this.callBase()||this._searchValue()},_popupHidingHandler:function(){this.callBase(),this._clearFilter()}});et("dxTagBox",me);var Tt=Object.freeze(Object.defineProperty({__proto__:null,default:me},Symbol.toStringTag,{value:"Module"})),St=ot(Tt);/*!
 * devextreme-vue
 * Version: 21.2.6
 * Build date: Tue Mar 01 2022
 *
 * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED
 *
 * This software may be modified and distributed under the terms
 * of the MIT license. See the LICENSE file in the root of the project for details.
 *
 * https://github.com/DevExpress/devextreme-vue
 */var Ct=oe&&oe.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(o,"__esModule",{value:!0});var bt=o.DxToolbarItem=kt=o.DxTo=Ut=o.DxShow=Rt=o.DxPosition=Mt=o.DxOptions=Pt=o.DxOffset=$t=o.DxMy=Nt=o.DxItem=Lt=o.DxHide=Vt=o.DxFrom=Ot=o.DxDropDownOptions=wt=o.DxCollision=At=o.DxButton=Bt=o.DxBoundaryOffset=Ft=o.DxAt=It=o.DxAnimation=Et=o.DxTagBox=void 0,Dt=Ct(St),yt=ce,d=ce,_e=yt.createComponent({props:{acceptCustomValue:Boolean,accessKey:String,activeStateEnabled:Boolean,applyValueMode:String,buttons:Array,dataSource:[Array,Object,String],deferRendering:Boolean,disabled:Boolean,displayExpr:[Function,String],dropDownButtonTemplate:{},dropDownOptions:Object,elementAttr:Object,fieldTemplate:{},focusStateEnabled:Boolean,grouped:Boolean,groupTemplate:{},height:[Function,Number,String],hideSelectedItems:Boolean,hint:String,hoverStateEnabled:Boolean,inputAttr:{},isValid:Boolean,items:Array,itemTemplate:{},label:String,labelMode:String,maxDisplayedTags:Number,maxFilterQueryLength:Number,maxLength:[Number,String],minSearchLength:Number,multiline:Boolean,name:String,noDataText:String,onChange:Function,onClosed:Function,onContentReady:Function,onCustomItemCreating:Function,onDisposing:Function,onEnterKey:Function,onFocusIn:Function,onFocusOut:Function,onInitialized:Function,onInput:Function,onItemClick:Function,onKeyDown:Function,onKeyUp:Function,onMultiTagPreparing:Function,onOpened:Function,onOptionChanged:Function,onSelectAllValueChanged:Function,onSelectionChanged:Function,onValueChanged:Function,opened:Boolean,openOnFieldClick:Boolean,placeholder:String,readOnly:Boolean,rtlEnabled:Boolean,searchEnabled:Boolean,searchExpr:[Array,Function,String],searchMode:String,searchTimeout:Number,selectAllMode:String,selectAllText:String,selectedItems:Array,showClearButton:Boolean,showDataBeforeSearch:Boolean,showDropDownButton:Boolean,showMultiTagOnly:Boolean,showSelectionControls:Boolean,stylingMode:String,tabIndex:Number,tagTemplate:{},text:String,useItemTextAsTitle:Boolean,validationError:{},validationErrors:Array,validationMessageMode:String,validationStatus:String,value:Array,valueExpr:[Function,String],visible:Boolean,width:[Function,Number,String],wrapItemText:Boolean},emits:{"update:isActive":null,"update:hoveredElement":null,"update:acceptCustomValue":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:applyValueMode":null,"update:buttons":null,"update:dataSource":null,"update:deferRendering":null,"update:disabled":null,"update:displayExpr":null,"update:dropDownButtonTemplate":null,"update:dropDownOptions":null,"update:elementAttr":null,"update:fieldTemplate":null,"update:focusStateEnabled":null,"update:grouped":null,"update:groupTemplate":null,"update:height":null,"update:hideSelectedItems":null,"update:hint":null,"update:hoverStateEnabled":null,"update:inputAttr":null,"update:isValid":null,"update:items":null,"update:itemTemplate":null,"update:label":null,"update:labelMode":null,"update:maxDisplayedTags":null,"update:maxFilterQueryLength":null,"update:maxLength":null,"update:minSearchLength":null,"update:multiline":null,"update:name":null,"update:noDataText":null,"update:onChange":null,"update:onClosed":null,"update:onContentReady":null,"update:onCustomItemCreating":null,"update:onDisposing":null,"update:onEnterKey":null,"update:onFocusIn":null,"update:onFocusOut":null,"update:onInitialized":null,"update:onInput":null,"update:onItemClick":null,"update:onKeyDown":null,"update:onKeyUp":null,"update:onMultiTagPreparing":null,"update:onOpened":null,"update:onOptionChanged":null,"update:onSelectAllValueChanged":null,"update:onSelectionChanged":null,"update:onValueChanged":null,"update:opened":null,"update:openOnFieldClick":null,"update:placeholder":null,"update:readOnly":null,"update:rtlEnabled":null,"update:searchEnabled":null,"update:searchExpr":null,"update:searchMode":null,"update:searchTimeout":null,"update:selectAllMode":null,"update:selectAllText":null,"update:selectedItems":null,"update:showClearButton":null,"update:showDataBeforeSearch":null,"update:showDropDownButton":null,"update:showMultiTagOnly":null,"update:showSelectionControls":null,"update:stylingMode":null,"update:tabIndex":null,"update:tagTemplate":null,"update:text":null,"update:useItemTextAsTitle":null,"update:validationError":null,"update:validationErrors":null,"update:validationMessageMode":null,"update:validationStatus":null,"update:value":null,"update:valueExpr":null,"update:visible":null,"update:width":null,"update:wrapItemText":null},model:{prop:"value",event:"update:value"},computed:{instance:function(){return this.$_instance}},beforeCreate:function(){this.$_WidgetClass=Dt.default,this.$_hasAsyncTemplate=!0,this.$_expectedChildren={button:{isCollectionItem:!0,optionName:"buttons"},dropDownOptions:{isCollectionItem:!1,optionName:"dropDownOptions"},item:{isCollectionItem:!0,optionName:"items"}}}}),Et=o.DxTagBox=_e,Z=d.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:hide":null,"update:show":null},props:{hide:[Object,Number,String],show:[Object,Number,String]}}),It=o.DxAnimation=Z;Z.$_optionName="animation";Z.$_expectedChildren={hide:{isCollectionItem:!1,optionName:"hide"},show:{isCollectionItem:!1,optionName:"show"}};var ge=d.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:String,y:String}}),Ft=o.DxAt=ge;ge.$_optionName="at";var fe=d.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:Number,y:Number}}),Bt=o.DxBoundaryOffset=fe;fe.$_optionName="boundaryOffset";var $=d.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:location":null,"update:name":null,"update:options":null},props:{location:String,name:String,options:Object}}),At=o.DxButton=$;$.$_optionName="buttons";$.$_isCollectionItem=!0;$.$_expectedChildren={options:{isCollectionItem:!1,optionName:"options"}};var ve=d.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:String,y:String}}),wt=o.DxCollision=ve;ve.$_optionName="collision";var q=d.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:animation":null,"update:bindingOptions":null,"update:closeOnOutsideClick":null,"update:container":null,"update:contentTemplate":null,"update:copyRootClassesToWrapper":null,"update:deferRendering":null,"update:disabled":null,"update:dragAndResizeArea":null,"update:dragEnabled":null,"update:dragOutsideBoundary":null,"update:elementAttr":null,"update:focusStateEnabled":null,"update:fullScreen":null,"update:height":null,"update:hideOnParentScroll":null,"update:hint":null,"update:hoverStateEnabled":null,"update:maxHeight":null,"update:maxWidth":null,"update:minHeight":null,"update:minWidth":null,"update:onContentReady":null,"update:onDisposing":null,"update:onFocusIn":null,"update:onFocusOut":null,"update:onHidden":null,"update:onHiding":null,"update:onInitialized":null,"update:onOptionChanged":null,"update:onResize":null,"update:onResizeEnd":null,"update:onResizeStart":null,"update:onShowing":null,"update:onShown":null,"update:onTitleRendered":null,"update:position":null,"update:resizeEnabled":null,"update:restorePosition":null,"update:rtlEnabled":null,"update:shading":null,"update:shadingColor":null,"update:showCloseButton":null,"update:showTitle":null,"update:tabIndex":null,"update:title":null,"update:titleTemplate":null,"update:toolbarItems":null,"update:visible":null,"update:width":null,"update:wrapperAttr":null},props:{accessKey:String,activeStateEnabled:Boolean,animation:Object,bindingOptions:Object,closeOnOutsideClick:[Boolean,Function],container:{},contentTemplate:{},copyRootClassesToWrapper:Boolean,deferRendering:Boolean,disabled:Boolean,dragAndResizeArea:{},dragEnabled:Boolean,dragOutsideBoundary:Boolean,elementAttr:{},focusStateEnabled:Boolean,fullScreen:Boolean,height:[Function,Number,String],hideOnParentScroll:Boolean,hint:String,hoverStateEnabled:Boolean,maxHeight:[Function,Number,String],maxWidth:[Function,Number,String],minHeight:[Function,Number,String],minWidth:[Function,Number,String],onContentReady:Function,onDisposing:Function,onFocusIn:Function,onFocusOut:Function,onHidden:Function,onHiding:Function,onInitialized:Function,onOptionChanged:Function,onResize:Function,onResizeEnd:Function,onResizeStart:Function,onShowing:Function,onShown:Function,onTitleRendered:Function,position:[Function,Object,String],resizeEnabled:Boolean,restorePosition:Boolean,rtlEnabled:Boolean,shading:Boolean,shadingColor:String,showCloseButton:Boolean,showTitle:Boolean,tabIndex:Number,title:String,titleTemplate:{},toolbarItems:Array,visible:Boolean,width:[Function,Number,String],wrapperAttr:{}}}),Ot=o.DxDropDownOptions=q;q.$_optionName="dropDownOptions";q.$_expectedChildren={animation:{isCollectionItem:!1,optionName:"animation"},position:{isCollectionItem:!1,optionName:"position"},toolbarItem:{isCollectionItem:!0,optionName:"toolbarItems"}};var J=d.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:left":null,"update:opacity":null,"update:position":null,"update:scale":null,"update:top":null},props:{left:Number,opacity:Number,position:Object,scale:Number,top:Number}}),Vt=o.DxFrom=J;J.$_optionName="from";J.$_expectedChildren={position:{isCollectionItem:!1,optionName:"position"}};var Q=d.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:complete":null,"update:delay":null,"update:direction":null,"update:duration":null,"update:easing":null,"update:from":null,"update:staggerDelay":null,"update:start":null,"update:to":null,"update:type":null},props:{complete:Function,delay:Number,direction:String,duration:Number,easing:String,from:Object,staggerDelay:Number,start:Function,to:Object,type:String}}),Lt=o.DxHide=Q;Q.$_optionName="hide";Q.$_expectedChildren={from:{isCollectionItem:!1,optionName:"from"},to:{isCollectionItem:!1,optionName:"to"}};var Y=d.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:disabled":null,"update:html":null,"update:template":null,"update:text":null,"update:visible":null},props:{disabled:Boolean,html:String,template:{},text:String,visible:Boolean}}),Nt=o.DxItem=Y;Y.$_optionName="items";Y.$_isCollectionItem=!0;var xe=d.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:String,y:String}}),$t=o.DxMy=xe;xe.$_optionName="my";var Te=d.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:Number,y:Number}}),Pt=o.DxOffset=Te;Te.$_optionName="offset";var Se=d.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:bindingOptions":null,"update:disabled":null,"update:elementAttr":null,"update:focusStateEnabled":null,"update:height":null,"update:hint":null,"update:hoverStateEnabled":null,"update:icon":null,"update:onClick":null,"update:onContentReady":null,"update:onDisposing":null,"update:onFocusIn":null,"update:onFocusOut":null,"update:onInitialized":null,"update:onOptionChanged":null,"update:rtlEnabled":null,"update:stylingMode":null,"update:tabIndex":null,"update:template":null,"update:text":null,"update:type":null,"update:useSubmitBehavior":null,"update:validationGroup":null,"update:visible":null,"update:width":null},props:{accessKey:String,activeStateEnabled:Boolean,bindingOptions:Object,disabled:Boolean,elementAttr:Object,focusStateEnabled:Boolean,height:[Function,Number,String],hint:String,hoverStateEnabled:Boolean,icon:String,onClick:Function,onContentReady:Function,onDisposing:Function,onFocusIn:Function,onFocusOut:Function,onInitialized:Function,onOptionChanged:Function,rtlEnabled:Boolean,stylingMode:String,tabIndex:Number,template:{},text:String,type:String,useSubmitBehavior:Boolean,validationGroup:String,visible:Boolean,width:[Function,Number,String]}}),Mt=o.DxOptions=Se;Se.$_optionName="options";var Ce=d.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:at":null,"update:boundary":null,"update:boundaryOffset":null,"update:collision":null,"update:my":null,"update:of":null,"update:offset":null},props:{at:[Object,String],boundary:{},boundaryOffset:[Object,String],collision:[Object,String],my:[Object,String],of:{},offset:[Object,String]}}),Rt=o.DxPosition=Ce;Ce.$_optionName="position";var be=d.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:complete":null,"update:delay":null,"update:direction":null,"update:duration":null,"update:easing":null,"update:from":null,"update:staggerDelay":null,"update:start":null,"update:to":null,"update:type":null},props:{complete:Function,delay:Number,direction:String,duration:Number,easing:String,from:Object,staggerDelay:Number,start:Function,to:Object,type:String}}),Ut=o.DxShow=be;be.$_optionName="show";var De=d.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:left":null,"update:opacity":null,"update:position":null,"update:scale":null,"update:top":null},props:{left:Number,opacity:Number,position:Object,scale:Number,top:Number}}),kt=o.DxTo=De;De.$_optionName="to";var ee=d.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:disabled":null,"update:html":null,"update:location":null,"update:options":null,"update:template":null,"update:text":null,"update:toolbar":null,"update:visible":null,"update:widget":null},props:{disabled:Boolean,html:String,location:String,options:{},template:{},text:String,toolbar:String,visible:Boolean,widget:String}});bt=o.DxToolbarItem=ee;ee.$_optionName="toolbarItems";ee.$_isCollectionItem=!0;var Gt=o.default=_e;const jt={components:{DxTagBox:Gt},props:{value:{type:Array,default:()=>[]},onValueChanged:{type:Function,default:()=>{}},dataSource:{type:Object,default:()=>{}},dataGridComponent:{type:Object,default:()=>{}}},data(){return{currentValue:Array.from(this.value,e=>e.roleId)}},created(){console.log("roletagboxcomponent - created -> ",this.value)},methods:{created(){},onSelectionChanged(){this.dataGridComponent.updateDimensions()}}};function Ht(e,t,n,i,a,l){const r=u("DxTagBox");return T(),O(r,{"data-source":n.dataSource,value:a.currentValue,"onUpdate:value":t[0]||(t[0]=m=>a.currentValue=m),"show-selection-controls":!0,"max-displayed-tags":5,"show-multi-tag-only":!1,"on-value-changed":m=>n.onValueChanged(m.value),"on-selection-changed":l.onSelectionChanged,"search-enabled":!0,"value-expr":"id","display-expr":"name","apply-value-mode":"useButtons"},null,8,["data-source","value","on-value-changed","on-selection-changed"])}var zt=X(jt,[["render",Ht]]);const Kt="https://kameyo-api.azurewebsites.net",Wt=`${Kt}/api/files/images/profiles/users/`,Xt={props:{userId:{type:String,default:""}},components:{DxFileUploader:ut,DxProgressBar:dt},data(){return{uploadUrl:`${Wt}${this.userId}`,isDropZoneActive:!1,imageSource:"",textVisible:!0,progressVisible:!1,progressValue:0,allowedFileExtensions:[".png"]}},created(){console.log("UserFileUploader - this.userData - ",this.userId),console.log("UserFileUploader - this.userData.value - ",this.userId)},mounted(){console.log("UserFileUploader - this.userData - ",this.userId)},methods:{onDropZoneEnter(e){e.dropZoneElement.id==="dropzone-external"&&(this.isDropZoneActive=!0)},onDropZoneLeave(e){e.dropZoneElement.id==="dropzone-external"&&(this.isDropZoneActive=!1)},onUploaded(e){const{file:t}=e,n=new FileReader;n.onload=()=>{this.isDropZoneActive=!1,this.imageSource=n.result},n.readAsDataURL(t),this.textVisible=!1,this.progressVisible=!1,this.progressValue=0},onProgress(e){this.progressValue=e.bytesLoaded/e.bytesTotal*100},onUploadStarted(){this.imageSource="",this.progressVisible=!0}}},Zt={class:"widget-container flex-box"},qt=D("span",null,"Foto de perfil",-1),Jt=["src"],Qt={key:1,id:"dropzone-text",class:"flex-box"},Yt=D("span",null,"Arrastra y suelta el archivo deseado",-1),en=D("span",null,"\u2026o haga clic para buscar un archivo en su lugar.",-1),tn=[Yt,en];function nn(e,t,n,i,a,l){const r=u("DxProgressBar"),m=u("DxFileUploader");return T(),N("div",Zt,[qt,D("div",{id:"dropzone-external",class:st(["flex-box",[a.isDropZoneActive?"dx-theme-accent-as-border-color dropzone-active":"dx-theme-border-color"]])},[a.imageSource?(T(),N("img",{key:0,id:"dropzone-image",src:a.imageSource,alt:""},null,8,Jt)):F("",!0),a.textVisible?(T(),N("div",Qt,tn)):F("",!0),s(r,{id:"upload-progress",min:0,max:100,width:"30%","show-status":!1,visible:a.progressVisible,value:a.progressValue},null,8,["visible","value"])],2),s(m,{id:"file-uploader","dialog-trigger":"#dropzone-external","drop-zone":"#dropzone-external",multiple:!1,"allowed-file-extensions":a.allowedFileExtensions,"upload-mode":"instantly","upload-url":a.uploadUrl,visible:!1,onDropZoneEnter:l.onDropZoneEnter,onDropZoneLeave:l.onDropZoneLeave,onUploaded:l.onUploaded,onProgress:l.onProgress,onUploadStarted:l.onUploadStarted},null,8,["allowed-file-extensions","upload-url","onDropZoneEnter","onDropZoneLeave","onUploaded","onProgress","onUploadStarted"])])}var an=X(Xt,[["render",nn]]);const Bn=await he.GetPersonTypes(),ln=await he.GetPersonLookUp(),ye="https://kameyo-api.azurewebsites.net",W=`${ye}/api/Users`,on=`${ye}/api/roles`;function sn(e){return e!=null&&e!==""}function rn(e){if(console.log("checkStatus",e),e.status>=200&&e.status<300)return e;var t=new Error(e.statusText);throw t.response=e,t}function un(e){return console.log("parseJSON",e),e.json()}const dn={name:"UsersView",components:{BreadCrumb:Be,DxDataGrid:Ae,DxColumn:we,DxScrolling:Oe,DxPager:Ve,DxPaging:Le,DxEditing:Ne,DxForm:$e,DxItem:Ge,DxFilterRow:Pe,DxToolbar:Me,RolesTagBoxComponent:zt,DxLookup:Re,DxPopup:Ue,UserFileUploader:an,cellLink:tt,DxButton:ke},data(){return{isEditing:!1,displayModes:[{text:"Display Mode 'full'",value:"full"},{text:"Display Mode 'compact'",value:"compact"}],displayMode:"full",pageSizes:[5,10,"all"],setStateValue(e,t){e.personId=null,this.defaultSetCellValue(e,t)},rolesDS:new te({key:"id",load:this.loadRoles}),personTypesDS:[],personLookUpDS:[],dataSource:new te({key:"id",load:this.loadData,remove:e=>this.sendRequest(`${W}/${e}`,"DELETE"),errorHandler:e=>{console.log(e.message)}}),calculateFilterExpressionUserRoles:function(e,t,n){debugger;return n==="search"&&typeof e=="string"?[this.dataField,"contains",e]:function(i){return(i.userRoles||[]).indexOf(e)!==-1}}}},methods:{sendRequest(e,t="GET",n={}){const i=Object.keys(n).map(a=>`${encodeURIComponent(a)}=${encodeURIComponent(n[a])}`).join("&");return console.log("data ",n),console.log("params ",i),t==="GET"?fetch(e,{method:t}).then(a=>a.json().then(l=>{if(a.ok)return l.data;throw l.Message})):fetch(e,{method:t,body:i,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}}).then(a=>a.ok?a.text().then(l=>l&&JSON.parse(l)):a.json().then(l=>{throw l.Message}))},loadData(e){console.log("loadData - loadOptions",e);let t="?";return["skip","take","requireTotalCount","requireGroupCount","sort","filter","totalSummary","group","groupSummary"].forEach(n=>{n in e&&sn(e[n])&&(t+=`${n}=${JSON.stringify(e[n])}&`)}),t=t.slice(0,-1),fetch(`${W}${t}`,{method:"GET",headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(n=>n.json()).then(n=>(console.log("loadData.data -> ",n),{data:n.data.data,totalCount:n.data.totalCount,summary:n.data.summary,groupCount:n.data.groupCount})).catch(()=>{throw new Error("Data Loading Error")})},createUser(){this.$router.push({name:"userCreateView"})},async updateUser(e={}){console.log("updateUser - data ->",e);const t="PUT";fetch(`${W}/${e.key}`,{method:t,body:JSON.stringify(e.values),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(async n=>{if(console.log("updateUser - result ",n),n.ok){const a=await n.text();return a&&JSON.parse(a)}throw(await n.json()).Message})},async loadDataFetch(e){return await fetch(`${e}`).then(rn).then(un).then(t=>(console.log(`loadDataFetch -> ${e}`,t.data.data),t.data.data))},async loadRoles(){return await this.loadDataFetch(`${on}`).then(e=>e)},roleCellTemplate(e,t){var n="\xA0",i=(t.value||[]).map(a=>t.column.lookup.calculateCellValue(a.roleId)).join(", ");e.textContent=i||n,e.title=i},getFilteredPersons:e=>({store:ln,filter:e.data?["personTypeId","=",e.data.personTypeId]:null}),onRoleValueChanged(e,t){var n=[];console.log("onRoleValueChanged - value ->",e),e.forEach(i=>{n.push({roleId:i,userId:t.row.isNewRow?"0":t.key})}),t.setValue(n),t.component.updateDimensions()}},async mounted(){this.personTypeDS=await this.loadPersonTypes(),this.personDS=await this.loadPersonLookUp()}},pn={id:"main-content"},cn={class:"container-fluid"},hn={class:"block-header"},mn={class:"row clearfix"},_n={class:"col-md-12"};function gn(e,t,n,i,a,l){const r=u("bread-crumb"),m=u("DxFilterRow"),c=u("DxScrolling"),g=u("DxPaging"),I=u("DxPager"),f=u("DxPopup"),v=u("UserFileUploader"),p=u("DxItem"),P=u("DxForm"),M=u("DxEditing"),S=u("DxColumn"),B=u("DxLookup"),R=u("DxToolbar"),U=u("RolesTagBoxComponent"),k=u("DxButton"),Ee=u("cellLink"),Ie=u("DxDataGrid");return T(),N("div",pn,[D("div",cn,[D("div",hn,[s(r)]),D("div",mn,[D("div",_n,[s(Ie,{id:"dataGridUsers","key-expr":"id","data-source":a.dataSource,"show-borders":!0,"repaint-changes-only":!0,"remote-operations":!0},{"avatar-template":h(({data:C})=>[s(v,{"user-data":C.value},null,8,["user-data"])]),tagBoxEditor:h(({data:C})=>[s(U,{value:C.value,"on-value-changed":Fe=>l.onRoleValueChanged(Fe,C),"data-source":a.rolesDS,"data-grid-component":C.component},null,8,["value","on-value-changed","data-source","data-grid-component"])]),createUserTemplate:h(()=>[s(k,{icon:"user",text:"nuevo usuario",onClick:l.createUser},null,8,["onClick"])]),"cell-link-template":h(({data:C})=>[s(Ee,{"cell-data":C,routePath:{name:"userView",params:{id:C.data.id}}},null,8,["cell-data","routePath"])]),default:h(()=>[s(m,{visible:!0}),s(c,{"row-rendering-mode":"virtual"}),s(g,{"page-size":10}),s(I,{visible:!0,"allowed-page-sizes":[10,20,50],"display-mode":a.displayMode,"show-page-size-selector":!0,"show-info":!1,"show-navigation-buttons":!0},null,8,["display-mode"]),s(M,{"refresh-mode":e.full,"allow-updating":!1,"allow-adding":!1,"allow-deleting":!0,mode:"popup"},{default:h(()=>[s(f,{"show-title":!0,width:700,height:600,title:"Informacion del usuario"}),s(P,null,{default:h(()=>[s(p,{"col-count":2,"col-span":2,"item-type":"group"},{default:h(()=>[a.isEditing?(T(),O(p,{key:0,"col-span":1},{default:h(()=>[s(v,{"user-id":e.id},null,8,["user-id"])]),_:1})):F("",!0),a.isEditing?(T(),O(p,{key:1,"item-type":"group","col-span":1},{default:h(()=>[s(p,{"data-field":"email"}),s(p,{"data-field":"password",editorType:"dxTextBox","editor-options":{mode:"password"}})]),_:1})):F("",!0),a.isEditing?F("",!0):(T(),O(p,{key:2,"data-field":"email"})),a.isEditing?F("",!0):(T(),O(p,{key:3,"data-field":"password",editorType:"dxTextBox","editor-options":{mode:"password"}})),s(p,{"data-field":"personTypeId"}),s(p,{"data-field":"personId"}),s(p,{"col-span":2,"data-field":"userRoles"})]),_:1})]),_:1})]),_:1},8,["refresh-mode"]),s(S,{"data-field":"id",caption:"id","data-type":"string",visible:!1,width:200}),s(S,{"data-field":"password",caption:"Contrase\xF1a","data-type":"string",visible:!1,width:200}),s(S,{"data-field":"email",caption:"Email","data-type":"string",width:300,"cell-template":"cell-link-template"}),s(S,{"data-field":"userRoles",caption:"Roles","allow-sorting":!1,width:130,visible:!0,"cell-template":l.roleCellTemplate,"calculate-filter-expression":a.calculateFilterExpressionUserRoles,"edit-cell-template":"tagBoxEditor"},{default:h(()=>[s(B,{"data-source":a.rolesDS,"value-expr":"id","display-expr":"name"},null,8,["data-source"])]),_:1},8,["cell-template","calculate-filter-expression"]),s(S,{"set-cell-value":a.setStateValue,"data-field":"personTypeId","data-type":"string",caption:"Tipo de persona",width:300},{default:h(()=>[s(B,{"data-source":a.personTypesDS,"display-expr":"name","value-expr":"id"},null,8,["data-source"])]),_:1},8,["set-cell-value"]),s(S,{"data-field":"personId",caption:"Persona","data-type":"string",width:200},{default:h(()=>[s(B,{"data-source":l.getFilteredPersons,"display-expr":"fullName","value-expr":"id"},null,8,["data-source"])]),_:1}),s(R,null,{default:h(()=>[s(p,{location:"after",template:"createUserTemplate"})]),_:1})]),_:1},8,["data-source"])])])])])}var An=X(dn,[["render",gn]]);export{An as default};
