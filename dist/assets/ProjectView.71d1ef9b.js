import{D as C,a as ge,b as fe,c as he,d as ye}from"./form.181df029.js";import{D as we,a as be}from"./load-indicator.7a18b1f7.js";import{D as F,a as G,b as B,c as H,d as A,e as M,f as L,g as V,h as O,i as N,k as W,l as q,n as z,t as J,u as U,v as Y,j as K,z as Pe,x as se,w as de,A as ke}from"./data-grid.24b081de.js";import{c as ve}from"./CellLinkTemplate.75b044c2.js";import{C as Q}from"./index.3bbb47f2.js";import{R as _}from"./RepositoryFactory.1ead146f.js";import{e as X,F as Z}from"./FileSaver.min.34d9f25a.js";import{e as $}from"./excel_exporter.6e076f26.js";import{r as o,o as I,a as T,f as t,w as i,c as re,b as ue,e as pe}from"./vendor.7710df40.js";import{_ as S}from"./index.7b655b97.js";import{_ as Re,D as je}from"./toolbar.58f20e48.js";import{D as Ee,a as Ie}from"./tab-panel.6a570691.js";import{B as Te}from"./BreadCrumb.9367f10a.js";import"./toast.a475c820.js";const De=_.get("catalogs"),ee=_.get("projectTasks"),Se=await De.Get("NAME","PROJECTTASKTYPE"),Ce=await De.Get("NAME","PROJECTTASKSTATE"),Fe={components:{DxDataGrid:F,DxColumn:G,DxScrolling:B,DxPager:H,DxPaging:A,DxEditing:M,DxRequiredRule:L,DxPopup:V,DxLookup:O,DxFilterRow:N,DxHeaderFilter:W,DxSearchPanel:q,DxExport:z,DxSelection:J,DxGroupPanel:U,DxGrouping:Y,DxForm:K,DxItem:C,DxFormat:Pe,DxCustomRule:se,DxRangeRule:de,cellLink:ve},props:{dataProject:{type:Object,default:()=>({})}},data(){return{tasks:new Q({key:"id",load:()=>this.getTasks(),insert:e=>this.createTask(e),update:(e,a)=>(a.id=e,this.updateTask(a)),remove:e=>this.deleteTask(e)}),projectTaskType:Se.data.data,projectTaskState:Ce.data.data,onlyPositiveFormat:{signDisplay:"never"},maxDate:new Date(this.dataProject.endDate),minDate:new Date(this.dataProject.startDate),setFullDates(e,a,r){if(r.startDate!=null&&a!=null){const l=Math.abs(a-new Date(r.startDate)),n=Math.ceil(l/(1e3*60*60));e.durationHour=n}if(r.endDate!=null&&a!=null){const l=Math.abs(new Date(r.endDate)-a),n=Math.ceil(l/(1e3*60*60));e.durationHour=n}this.defaultSetCellValue(e,a)},setOrden(e,a){var r=Math.abs(Math.round(a));this.defaultSetCellValue(e,r)}}},methods:{insertProjectTask:async function(e){console.log(e)},getTasks:async function(){const{data:e}=await ee.Get("PROJECTID",this.dataProject.id);return e.totalCount=e.data.length,e},createTask:async function(e){e.projectId=this.dataProject.id;const{data:a}=await ee.Create(e);return a},updateTask:async function(e){const{data:a}=await ee.Update(e);return a},deleteTask:async function(e){const{data:a}=await ee.Delete(e);return a},startDateValidation:function(e){return e.data.startDate!=null&&e.data.endDate!=null?e.data.startDate<e.data.endDate:!0},endDateValidation:function(e){return e.data.startDate!=null&&e.data.endDate!=null?e.data.endDate>e.data.startDate:!0},closeDateValidation:function(e){return e.data.endDate!=null&&e.data.closeDate!=null?e.data.endDate<e.data.closeDate:!0},onExporting(e){const a=new X.exports.Workbook,r=a.addWorksheet("Tareas");$({component:e.component,worksheet:r,autoFilterEnabled:!0}).then(()=>{a.xlsx.writeBuffer().then(l=>{Z.exports.saveAs(new Blob([l],{type:"application/octet-stream"}),"Tareas.xlsx")})}),e.cancel=!0}},async created(){}};function Ge(e,a,r,l,n,m){const w=o("DxHeaderFilter"),b=o("DxGroupPanel"),P=o("DxGrouping"),c=o("DxExport"),u=o("DxSelection"),h=o("DxSearchPanel"),k=o("DxFilterRow"),g=o("DxScrolling"),v=o("DxPaging"),R=o("DxPager"),x=o("DxPopup"),s=o("DxItem"),j=o("DxForm"),y=o("DxEditing"),p=o("DxRequiredRule"),d=o("DxColumn"),D=o("DxLookup"),f=o("DxRangeRule"),E=o("DxCustomRule"),ie=o("cellLink"),_e=o("DxDataGrid");return I(),T("div",null,[t(_e,{id:"dataGridProjectTask","data-source":n.tasks,"show-borders":!0,"repaint-changes-only":!0,"remote-operations":!0,onRowInserting:e.insertTask,onExporting:m.onExporting,"key-expr":"id"},{"cell-link-template":i(({data:ce})=>[t(ie,{"cell-data":ce,routePath:{name:"projectTaskView",params:{id:ce.data.id}}},null,8,["cell-data","routePath"])]),default:i(()=>[t(w,{visible:!0}),t(b,{visible:!0}),t(P,{"auto-expand-all":!0}),t(c,{enabled:!0,"allow-export-selected-data":!0}),t(u,{mode:"multiple"}),t(h,{visible:!0,width:240,placeholder:"Search..."}),t(k,{visible:!0}),t(g,{"row-rendering-mode":"virtual"}),t(v,{"page-size":10}),t(R,{visible:!0,"allowed-page-sizes":[10,20,50],"display-mode":e.displayMode,"show-page-size-selector":!0,"show-info":!1,"show-navigation-buttons":!0},null,8,["display-mode"]),t(y,{"refresh-mode":e.full,"allow-updating":!0,"allow-adding":!0,"allow-deleting":!0,mode:"popup"},{default:i(()=>[t(x,{"show-title":!0,width:700,height:525,title:"Informaci\xF3n de la Tarea"}),t(j,null,{default:i(()=>[t(s,{"col-count":1,"col-span":2,"item-type":"group"},{default:i(()=>[t(s,{"data-field":"name"}),t(s,{"data-field":"description"}),t(s,{"data-field":"order"})]),_:1}),t(s,{"col-count":2,"col-span":2,"item-type":"group",caption:"Tiempos de la tarea"},{default:i(()=>[t(s,{"data-field":"catalogTaskTypeId"}),t(s,{"data-field":"catalogTaskStateId"}),t(s,{"data-field":"startDate"}),t(s,{"data-field":"endDate"}),t(s,{"data-field":"durationHour"}),t(s,{"data-field":"closeDate"}),t(s,{"data-field":"progress"})]),_:1})]),_:1})]),_:1},8,["refresh-mode"]),t(d,{width:150,"data-field":"name",caption:"Nombre","cell-template":"cell-link-template"},{default:i(()=>[t(p)]),_:1}),t(d,{width:0,"data-field":"projectId"}),t(d,{width:200,"data-field":"description",caption:"Descripci\xF3n"}),t(d,{width:0,"set-cell-value":n.setOrden,"data-field":"order",caption:"Orden","data-type":"number"},null,8,["set-cell-value"]),t(d,{width:0,"data-field":"catalogTaskTypeId",caption:"Tipo de Tarea"},{default:i(()=>[t(D,{"data-source":n.projectTaskType,"value-expr":"id","display-expr":"value"},null,8,["data-source"])]),_:1}),t(d,{width:150,"data-field":"catalogTaskStateId",caption:"Estado de Tarea"},{default:i(()=>[t(D,{"data-source":n.projectTaskState,"value-expr":"id","display-expr":"value"},null,8,["data-source"])]),_:1}),t(d,{width:150,"set-cell-value":n.setFullDates,"data-field":"startDate",caption:"Fecha de Inicio","data-type":"datetime"},{default:i(()=>[t(f,{max:n.maxDate,min:n.minDate,message:"La fecha de inicio de la tarea se encuentra fuera de los tiempos del proyecto."},null,8,["max","min"]),t(E,{"validation-callback":m.startDateValidation,message:"La fecha de inicio no puede ser mayor o igual a la fecha de fin."},null,8,["validation-callback"])]),_:1},8,["set-cell-value"]),t(d,{width:150,"set-cell-value":n.setFullDates,"data-field":"endDate",caption:"Fecha de Fin","data-type":"datetime"},{default:i(()=>[t(f,{max:n.maxDate,min:n.minDate,message:"La fecha de fin de la tarea se encuentra fuera de los tiempos del proyecto."},null,8,["max","min"]),t(E,{"validation-callback":m.endDateValidation,message:"La fecha de fin no puede ser menor o igual a la fecha de inicio."},null,8,["validation-callback"])]),_:1},8,["set-cell-value"]),t(d,{width:100,"allow-editing":!1,"data-field":"durationHour",caption:"Duraci\xF3n","data-type":"number"}),t(d,{width:150,"data-field":"closeDate",caption:"Fecha de Cierre","data-type":"datetime"},{default:i(()=>[t(E,{"validation-callback":m.closeDateValidation,message:"La fecha de cierre no puede ser menor o igual a la fecha de fin."},null,8,["validation-callback"])]),_:1}),t(d,{width:100,"data-field":"progress",caption:"Progreso","data-type":"number"})]),_:1},8,["data-source","onRowInserting","onExporting"])])}var Be=S(Fe,[["render",Ge]]);const He=_.get("projectResources"),Ae=_.get("projectTasks"),te=_.get("taskActivities"),Me={components:{DxDataGrid:F,DxColumn:G,DxScrolling:B,DxPaging:A,DxPager:H,DxFilterRow:N,DxHeaderFilter:W,DxSearchPanel:q,DxExport:z,DxSelection:J,DxGroupPanel:U,DxGrouping:Y,DxEditing:M,DxRequiredRule:L,DxPopup:V,DxLookup:O,DxForm:K,DxItem:C,DxCustomRule:se,DxRangeRule:de},props:{dataProject:{type:Object,default:()=>({})}},data(){return{activities:new Q({key:"id",load:()=>this.getActivities(),insert:e=>(console.log("insert",e),this.createActivity(e)),update:(e,a)=>(a.id=e,this.updateActivity(a)),remove:e=>this.deleteActivity(e)}),employees:{},tasks:{},taskStartDate:null,taskEndDate:null,setFullDates(e,a,r){if(r.startDate!=null&&a!=null){const l=Math.abs(a-new Date(r.startDate)),n=Math.ceil(l/(1e3*60*60));e.totalTimeHour=n}if(r.endDate!=null&&a!=null){const l=Math.abs(new Date(r.endDate)-a),n=Math.ceil(l/(1e3*60*60));e.totalTimeHour=n}this.defaultSetCellValue(e,a)}}},methods:{setTaskValue(e,a){e.startDate=null,e.endDate=null,this.tasks.forEach(r=>{r.id==a&&(this.taskStartDate=new Date(r.startDate),this.taskEndDate=new Date(r.endDate))}),e.projectTaskId=a},getEmployees:async function(){const{data:e}=await He.Get("PROJECTID",this.dataProject.id);this.employees=e.data,console.log(this.employees)},getTasks:async function(){const{data:e}=await Ae.Get("PROJECTID",this.dataProject.id);this.tasks=e.data,console.log("tasks",this.tasks)},getActivities:async function(){const{data:e}=await te.Get("PROJECTID",this.dataProject.id);return e.totalCount=e.data.length,e},createActivity:async function(e){const{data:a}=await te.Create(e);return a},updateActivity:async function(e){const{data:a}=await te.Update(e);return a},deleteActivity:async function(e){const{data:a}=await te.Delete(e);return a},insertActivity:function(e){console.log(e.data)},startDateValidation:function(e){return e.data.startDate!=null&&e.data.endDate!=null?e.data.startDate<e.data.endDate:!0},endDateValidation:function(e){return e.data.startDate!=null&&e.data.endDate!=null?e.data.endDate>e.data.startDate:!0},onExporting(e){const a=new X.exports.Workbook,r=a.addWorksheet("Actividades");$({component:e.component,worksheet:r,autoFilterEnabled:!0}).then(()=>{a.xlsx.writeBuffer().then(l=>{Z.exports.saveAs(new Blob([l],{type:"application/octet-stream"}),"Actividades.xlsx")})}),e.cancel=!0}},async created(){await this.getEmployees(),await this.getTasks()}};function Le(e,a,r,l,n,m){const w=o("DxHeaderFilter"),b=o("DxGroupPanel"),P=o("DxGrouping"),c=o("DxExport"),u=o("DxSelection"),h=o("DxSearchPanel"),k=o("DxFilterRow"),g=o("DxPaging"),v=o("DxScrolling"),R=o("DxPopup"),x=o("DxItem"),s=o("DxForm"),j=o("DxEditing"),y=o("DxLookup"),p=o("DxRequiredRule"),d=o("DxColumn"),D=o("DxRangeRule"),f=o("DxCustomRule"),E=o("DxDataGrid");return I(),T("div",null,[t(E,{id:"dataGridTaskActivity","data-source":n.activities,"show-borders":!0,"repaint-changes-only":!0,"remote-operations":!0,onExporting:m.onExporting,"key-expr":"id"},{default:i(()=>[t(w,{visible:!0}),t(b,{visible:!0}),t(P,{"auto-expand-all":!0}),t(c,{enabled:!0,"allow-export-selected-data":!0}),t(u,{mode:"multiple"}),t(h,{visible:!0,width:240,placeholder:"Search..."}),t(k,{visible:!0}),t(g,{"page-size":10,enabled:"true"}),t(v,{"row-rendering-mode":"virtual"}),t(j,{"refresh-mode":e.full,"allow-updating":!0,"allow-adding":!0,"allow-deleting":!0,mode:"popup"},{default:i(()=>[t(R,{"show-title":!0,width:700,height:525,title:"Informaci\xF3n de la Actividad"}),t(s,null,{default:i(()=>[t(x,{"col-count":1,"col-span":2,"item-type":"group"},{default:i(()=>[t(x,{"data-field":"projectTaskId"}),t(x,{"data-field":"employeeId"}),t(x,{"data-field":"description"})]),_:1}),t(x,{"col-count":2,"col-span":2,"item-type":"group",caption:"Tiempos de la actividad"},{default:i(()=>[t(x,{"data-field":"startDate"}),t(x,{"data-field":"endDate"}),t(x,{"data-field":"totalTimeHour"})]),_:1})]),_:1})]),_:1},8,["refresh-mode"]),t(d,{width:150,"data-field":"employeeId",caption:"Empleado"},{default:i(()=>[t(y,{"data-source":n.employees,"value-expr":"employeeId","display-expr":"employeName"},null,8,["data-source"]),t(p)]),_:1}),t(d,{width:150,"data-field":"projectTaskId",caption:"Tarea","set-cell-value":m.setTaskValue},{default:i(()=>[t(y,{"data-source":n.tasks,"value-expr":"id","display-expr":"name"},null,8,["data-source"]),t(p)]),_:1},8,["set-cell-value"]),t(d,{width:200,"data-field":"description",caption:"Descripci\xF3n"}),t(d,{width:150,"set-cell-value":n.setFullDates,"data-field":"startDate",caption:"Fecha de Inicio","data-type":"datetime"},{default:i(()=>[t(D,{max:n.taskEndDate,min:n.taskStartDate,message:"La fecha de inicio de la actividad se encuentra fuera de los tiempos de la tarea."},null,8,["max","min"]),t(f,{"validation-callback":m.startDateValidation,message:"La fecha de inicio no puede ser mayor o igual a la fecha de fin."},null,8,["validation-callback"])]),_:1},8,["set-cell-value"]),t(d,{width:150,"set-cell-value":n.setFullDates,"data-field":"endDate",caption:"Fecha de Fin","data-type":"datetime"},{default:i(()=>[t(D,{max:n.taskEndDate,min:n.taskStartDate,message:"La fecha de fin de la actividad se encuentra fuera de los tiempos de la tarea."},null,8,["max","min"]),t(f,{"validation-callback":m.endDateValidation,message:"La fecha de fin no puede ser menor o igual a la fecha de inicio."},null,8,["validation-callback"])]),_:1},8,["set-cell-value"]),t(d,{width:100,"allow-editing":!1,"data-field":"totalTimeHour",caption:"Duraci\xF3n","data-type":"number"})]),_:1},8,["data-source","onExporting"])])}var Ve=S(Me,[["render",Le]]);const Oe=_.get("catalogs"),Ne=_.get("employees"),ae=_.get("projectResources"),We=_.get("taskActivities"),qe={components:{DxDataGrid:F,DxColumn:G,DxScrolling:B,DxPager:H,DxPaging:A,DxEditing:M,DxRequiredRule:L,DxPopup:V,DxLookup:O,DxFilterRow:N,DxHeaderFilter:W,DxSearchPanel:q,DxExport:z,DxSelection:J,DxGroupPanel:U,DxGrouping:Y,DxForm:K,DxItem:C,DxAsyncRule:ke},props:{dataProject:{type:Object,default:()=>({})}},data(){return{resources:new Q({key:"id",load:()=>this.getResources(),insert:e=>this.createResource(e),update:(e,a)=>(a.id=e,this.updateResource(a)),remove:e=>this.deleteResource(e)}),employees:{},catalogEmployeeRols:{},employeeResources:{},setCalculateFactorProject(e,a){var r=Math.abs(a);this.defaultSetCellValue(e,r)}}},methods:{getCatalogEmployeeRols:async function(){const{data:e}=await Oe.Get("NAME","EMPLOYEEROL");this.catalogEmployeeRols=e.data},getEmployees:async function(){const{data:e}=await Ne.Get("SUBSIDIARYID",this.dataProject.subsidiaryId);this.employees=e.data},newRow(e){},getCalculateFactorEmployee:function(e){return e.employeeId!=null&&this.employees!=null?this.employees.filter(a=>a.id===e.employeeId)[0].calculateFactor:0},getResources:async function(){const{data:e}=await ae.Get("PROJECTID",this.dataProject.id);return this.employeeResources=e.data,e.totalCount=e.data.length,e},createResource:async function(e){e.projectId=this.dataProject.id;const{data:a}=await ae.Create(e);return a},updateResource:async function(e){const{data:a}=await ae.Update(e);return a},deleteResource:async function(e){const{data:a}=await ae.Delete(e);return a},employeeValidation:async function(e){return console.log(e),console.log(this.employeeResources),console.log(e.data.employeeId==null),this.employeeResources.filter(a=>a.employeeId==e.data.employeeId&&a.id!=e.data.id).length==0},factorProjectValidation:async function(e){const{data:a}=await We.Get("PROJECTID",this.dataProject.id);return a.data.filter(r=>r.employeeId==e.data.employeeId).length==0},onExporting(e){const a=new X.exports.Workbook,r=a.addWorksheet("Recursos");$({component:e.component,worksheet:r,autoFilterEnabled:!0}).then(()=>{a.xlsx.writeBuffer().then(l=>{Z.exports.saveAs(new Blob([l],{type:"application/octet-stream"}),"Recursos.xlsx")})}),e.cancel=!0}},async created(){await this.getEmployees(),await this.getCatalogEmployeeRols()}};function ze(e,a,r,l,n,m){const w=o("DxHeaderFilter"),b=o("DxGroupPanel"),P=o("DxGrouping"),c=o("DxExport"),u=o("DxSelection"),h=o("DxSearchPanel"),k=o("DxFilterRow"),g=o("DxScrolling"),v=o("DxPaging"),R=o("DxPager"),x=o("DxPopup"),s=o("DxItem"),j=o("DxForm"),y=o("DxEditing"),p=o("DxColumn"),d=o("DxLookup"),D=o("DxAsyncRule"),f=o("DxRequiredRule"),E=o("DxDataGrid");return I(),T("div",null,[t(E,{id:"dataGridProjectResource","data-source":n.resources,"show-borders":!0,"repaint-changes-only":!0,"remote-operations":!0,onExporting:m.onExporting,onInitNewRow:m.newRow,"key-expr":"id"},{default:i(()=>[t(w,{visible:!0}),t(b,{visible:!0}),t(P,{"auto-expand-all":!0}),t(c,{enabled:!0,"allow-export-selected-data":!0}),t(u,{mode:"multiple"}),t(h,{visible:!0,width:240,placeholder:"Search..."}),t(k,{visible:!0}),t(g,{"row-rendering-mode":"virtual"}),t(v,{"page-size":10}),t(R,{visible:!0,"allowed-page-sizes":[10,20,50],"display-mode":e.displayMode,"show-page-size-selector":!0,"show-info":!1,"show-navigation-buttons":!0},null,8,["display-mode"]),t(y,{"refresh-mode":e.full,"allow-updating":!0,"allow-adding":!0,"allow-deleting":!0,mode:"popup"},{default:i(()=>[t(x,{"show-title":!0,width:700,height:525,title:"Asignacion de Recurso a Proyecto"}),t(j,null,{default:i(()=>[t(s,{"col-count":1,"col-span":2,"item-type":"group"},{default:i(()=>[t(s,{"data-field":"employeeId"}),t(s,{"data-field":"catalogEmployeeRolId"}),t(s,{"data-field":"calculateFactorProject"}),t(s,{"data-field":"participationValue"})]),_:1})]),_:1})]),_:1},8,["refresh-mode"]),t(p,{width:0,"data-field":"projectId"}),t(p,{width:150,"set-cell-value":e.setEmployeeValue,"data-field":"employeeId",caption:"Empleado"},{default:i(()=>[t(d,{"data-source":n.employees,"value-expr":"id","display-expr":"fullName","item-template":"list-item"},null,8,["data-source"]),t(D,{"validation-callback":m.employeeValidation,message:"El empleado ya fue asignado al proyecto"},null,8,["validation-callback"]),t(f)]),_:1},8,["set-cell-value"]),t(p,{width:150,"data-field":"catalogEmployeeRolId",caption:"Rol"},{default:i(()=>[t(d,{"data-source":n.catalogEmployeeRols,"value-expr":"id","display-expr":"value"},null,8,["data-source"]),t(f)]),_:1}),t(p,{width:300,"calculate-cell-value":m.getCalculateFactorEmployee,"allow-editing":!1,caption:"Factor de Calculo del Empleado","data-type":"number"},null,8,["calculate-cell-value"]),t(p,{width:300,"set-cell-value":n.setCalculateFactorProject,"data-field":"calculateFactorProject",caption:"Factor de Calculo del Proyecto","data-type":"number"},{default:i(()=>[t(D,{"validation-callback":m.factorProjectValidation,message:"No se puede modificar un factor de calculo del proyecto cuando existe una actividad activa."},null,8,["validation-callback"])]),_:1},8,["set-cell-value"]),t(p,{width:300,"data-field":"participationValue",caption:"Valor de Participacion","data-type":"number"})]),_:1},8,["data-source","onExporting","onInitNewRow"])])}var Je=S(qe,[["render",ze]]);const Ue=_.get("hourBanks"),oe=_.get("projectHourBanks"),Ye={components:{DxDataGrid:F,DxColumn:G,DxScrolling:B,DxPager:H,DxPaging:A,DxEditing:M,DxRequiredRule:L,DxPopup:V,DxLookup:O,DxFilterRow:N,DxHeaderFilter:W,DxSearchPanel:q,DxExport:z,DxSelection:J,DxGroupPanel:U,DxGrouping:Y,DxForm:K,DxItem:C},props:{dataProject:{type:Object,default:()=>({})}},data(){return{projectHourBanks:new Q({key:"id",load:()=>this.getProjectHourBanks(),insert:e=>this.createProjectHourBank(e),update:(e,a)=>(a.id=e,this.updateProjectHourBank(a)),remove:e=>this.deleteProjectHourBank(e)}),hourBanks:{}}},methods:{getHourBanks:async function(){const{data:e}=await Ue.GetWithPagination({});this.hourBanks=e.data},getProjectHourBanks:async function(){const{data:e}=await oe.Get("PROJECTID",this.dataProject.id);return e.totalCount=e.data.length,e},createProjectHourBank:async function(e){e.projectId=this.dataProject.id;const{data:a}=await oe.Create(e);return a},updateProjectHourBank:async function(e){const{data:a}=await oe.Update(e);return a},deleteProjectHourBank:async function(e){const{data:a}=await oe.Delete(e);return a},onExporting(e){const a=new X.exports.Workbook,r=a.addWorksheet("Clientes");$({component:e.component,worksheet:r,autoFilterEnabled:!0}).then(()=>{a.xlsx.writeBuffer().then(l=>{Z.exports.saveAs(new Blob([l],{type:"application/octet-stream"}),"Clientes.xlsx")})}),e.cancel=!0}},async created(){await this.getHourBanks()}};function Ke(e,a,r,l,n,m){const w=o("DxHeaderFilter"),b=o("DxGroupPanel"),P=o("DxGrouping"),c=o("DxExport"),u=o("DxSelection"),h=o("DxSearchPanel"),k=o("DxFilterRow"),g=o("DxScrolling"),v=o("DxPaging"),R=o("DxPager"),x=o("DxPopup"),s=o("DxItem"),j=o("DxForm"),y=o("DxEditing"),p=o("DxColumn"),d=o("DxLookup"),D=o("DxRequiredRule"),f=o("DxDataGrid");return I(),T("div",null,[t(f,{id:"dataGridProjectHourBank","data-source":n.projectHourBanks,"show-borders":!0,"repaint-changes-only":!0,"remote-operations":!0,onRowInserting:e.insertHourBank,onExporting:m.onExporting,"key-expr":"id"},{default:i(()=>[t(w,{visible:!0}),t(b,{visible:!0}),t(P,{"auto-expand-all":!0}),t(c,{enabled:!0,"allow-export-selected-data":!0}),t(u,{mode:"multiple"}),t(h,{visible:!0,width:240,placeholder:"Search..."}),t(k,{visible:!0}),t(g,{"row-rendering-mode":"virtual"}),t(v,{"page-size":10}),t(R,{visible:!0,"allowed-page-sizes":[10,20,50],"display-mode":e.displayMode,"show-page-size-selector":!0,"show-info":!1,"show-navigation-buttons":!0},null,8,["display-mode"]),t(y,{"refresh-mode":e.full,"allow-adding":!0,"allow-deleting":!0,mode:"popup"},{default:i(()=>[t(x,{"show-title":!0,width:700,height:525,title:"Asignacion de Bolsa de Horas a Proyecto"}),t(j,null,{default:i(()=>[t(s,{"col-count":1,"col-span":2,"item-type":"group"},{default:i(()=>[t(s,{"data-field":"hourBankId"})]),_:1})]),_:1})]),_:1},8,["refresh-mode"]),t(p,{width:0,"data-field":"projectId"}),t(p,{width:150,"data-field":"hourBankId",caption:"Bolsa de Horas"},{default:i(()=>[t(d,{"data-source":n.hourBanks,"value-expr":"id","display-expr":"name"},null,8,["data-source"]),t(D)]),_:1}),t(p,{width:150,"data-field":"hourBalance",caption:"Saldo de Horas"}),t(p,{width:150,"data-field":"hourSet",caption:"Cantidad de Horas"})]),_:1},8,["data-source","onRowInserting","onExporting"])])}var Qe=S(Ye,[["render",Ke]]);const Xe=_.get("employees"),ne=_.get("projectManagers"),Ze={components:{DxDataGrid:F,DxColumn:G,DxScrolling:B,DxPaging:A,DxPager:H,DxFilterRow:N,DxHeaderFilter:W,DxSearchPanel:q,DxExport:z,DxSelection:J,DxGroupPanel:U,DxGrouping:Y,DxEditing:M,DxRequiredRule:L,DxPopup:V,DxLookup:O,DxForm:K,DxItem:C,DxCustomRule:se,DxRangeRule:de},props:{dataProject:{type:Object,default:()=>({})}},data(){return{managers:new Q({key:"id",load:()=>this.getManagers(),insert:e=>this.createManager(e),update:(e,a)=>(a.id=e,this.updateManager(a)),remove:e=>this.deleteManager(e)}),employees:{},maxDate:new Date(this.dataProject.endDate),minDate:new Date(this.dataProject.startDate),manager:{}}},methods:{getEmployees:async function(){const{data:e}=await Xe.Get("SUBSIDIARYID",this.dataProject.subsidiaryId);this.employees=e.data},getManagers:async function(){const{data:e}=await ne.Get("PROJECTID",this.dataProject.id);return this.manager=e.data,e.totalCount=e.data.length,e},createManager:async function(e){e.projectId=this.dataProject.id;const{data:a}=await ne.Create(e);return a},updateManager:async function(e){const{data:a}=await ne.Update(e);return a},deleteManager:async function(e){const{data:a}=await ne.Delete(e);return a},startDateManagerValidation:function(e){return console.log("params",e),e.data.id==null?this.manager.filter(a=>a.startDate<=e.data.startDate&&a.endDate>=e.data.startDate).length==0:!0},endDateManagerValidation:function(e){return e.data.id==null?this.manager.filter(a=>a.startDate<=e.data.endDate&&a.endDate>=e.data.endDate).length==0:!0},onExporting(e){const a=new X.exports.Workbook,r=a.addWorksheet("Administradores");$({component:e.component,worksheet:r,autoFilterEnabled:!0}).then(()=>{a.xlsx.writeBuffer().then(l=>{Z.exports.saveAs(new Blob([l],{type:"application/octet-stream"}),"Administradores.xlsx")})}),e.cancel=!0}},async created(){await this.getEmployees()}};function $e(e,a,r,l,n,m){const w=o("DxHeaderFilter"),b=o("DxGroupPanel"),P=o("DxGrouping"),c=o("DxExport"),u=o("DxSelection"),h=o("DxSearchPanel"),k=o("DxFilterRow"),g=o("DxPaging"),v=o("DxPager"),R=o("DxScrolling"),x=o("DxPopup"),s=o("DxItem"),j=o("DxForm"),y=o("DxEditing"),p=o("DxColumn"),d=o("DxLookup"),D=o("DxRequiredRule"),f=o("DxRangeRule"),E=o("DxCustomRule"),ie=o("DxDataGrid");return I(),T("div",null,[t(ie,{id:"dataGridProjectManager","data-source":n.managers,"show-borders":!0,showColumnHeaders:!1,"repaint-changes-only":!0,"remote-operations":!0,onRowInserting:e.insertManager,onExporting:m.onExporting,"key-expr":"id"},{default:i(()=>[t(w,{visible:!0}),t(b,{visible:!0}),t(P,{"auto-expand-all":!0}),t(c,{enabled:!0,"allow-export-selected-data":!0}),t(u,{mode:"multiple"}),t(h,{visible:!0,width:240,placeholder:"Search..."}),t(k,{visible:!0}),t(g,{"page-size":10,enabled:"true"}),t(v,{visible:!0,"allowed-page-sizes":e.pageSizes,"display-mode":e.displayMode,"show-navigation-buttons":e.showNavButtons},null,8,["allowed-page-sizes","display-mode","show-navigation-buttons"]),t(R,{"row-rendering-mode":"virtual"}),t(y,{"refresh-mode":e.full,"allow-updating":!0,"allow-adding":!0,"allow-deleting":!0,mode:"popup"},{default:i(()=>[t(x,{"show-title":!0,width:700,height:525,title:"Asignacion de Supervisor"}),t(j,null,{default:i(()=>[t(s,{"col-count":1,"col-span":1,"item-type":"group"},{default:i(()=>[t(s,{"data-field":"employeeId"}),t(s,{"data-field":"startDate"}),t(s,{"data-field":"endDate"})]),_:1})]),_:1})]),_:1},8,["refresh-mode"]),t(p,{width:0,"data-field":"projectId"}),t(p,{width:150,"data-field":"employeeId",caption:"Empleado"},{default:i(()=>[t(d,{"data-source":n.employees,"value-expr":"id","display-expr":"names"},null,8,["data-source"]),t(D)]),_:1}),t(p,{width:150,"data-field":"startDate",caption:"Fecha de Inicio","data-type":"datetime"},{default:i(()=>[t(f,{max:n.maxDate,min:n.minDate,message:"La fecha de inicio del administrador se encuentra fuera de los tiempos del proyecto."},null,8,["max","min"]),t(E,{"validation-callback":m.startDateManagerValidation,message:"La fecha de inicio del administrador ya se encuentra dentro de la programacion de otro administrador."},null,8,["validation-callback"])]),_:1}),t(p,{width:150,"data-field":"endDate",caption:"Fecha de Fin","data-type":"datetime"},{default:i(()=>[t(E,{"validation-callback":m.endDateManagerValidation,message:"La fecha de fin del administrador ya se encuentra dentro de la programacion de otro administrador."},null,8,["validation-callback"]),t(f,{max:n.maxDate,min:n.minDate,message:"La fecha de fin del administrador se encuentra fuera de los tiempos del proyecto."},null,8,["max","min"])]),_:1})]),_:1},8,["data-source","onRowInserting","onExporting"])])}var et=S(Ze,[["render",$e]]);const me=_.get("projects"),le=_.get("catalogs"),xe=_.get("customers"),tt=_.get("contacts"),at=_.get("subsidiaries"),ot=await le.Get("NAME","PROJECTTYPE"),nt=await le.Get("NAME","PROJECTCATEGORY"),it=await le.Get("NAME","PROJECTSTATE"),rt={components:{DxForm:ge,DxSimpleItem:fe,DxGroupItem:he,DxLabel:ye,DxToolbar:Re,DxItemToolbar:je,DxTabPanel:Ee,DxItem:Ie,DxToast:we,DxLoadIndicator:be,TaskTab:Be,ActivityTab:Ve,ResourceTab:Je,HourBankTab:Qe,ManagerTab:et,BreadCrumb:Te},data(){return{project:{},projectType:ot.data.data,projectCategory:nt.data.data,projectState:it.data.data,customer:{},contact:{},subsidiary:{},saveButtonOptions:{text:"Grabar",onClick:async()=>{let e={id:this.project.id,name:this.project.name,customerId:this.project.customerId,description:this.project.description,mainContactId:this.project.mainContactId,catalogProjectTypeId:this.project.catalogProjectTypeId,catalogProjectCategoryId:this.project.catalogProjectCategoryId,catalogProjectStateId:this.project.catalogProjectStateId,startDate:this.project.startDate,endDate:this.project.endDate,durationHour:this.project.durationHour,closeDate:this.project.closeDate,costHourMenCustomer:this.project.costHourMenCustomer,costHourMenProject:this.project.costHourMenProject};this.updateProject(e)}},showWhenLoad:!1,loadIndicatorVisible:!0,isVisible:!1,message:"",type:"info"}},methods:{getProjectById:async function(e){const{data:a}=await me.Get("ID",e);var r=[];a.data[0].projectTasks.forEach(l=>{r.push(...l.taskActivities)}),a.data[0].taskActivities=r,this.project=a.data[0],this.showWhenLoad=!0,this.loadIndicatorVisible=!1},getSubsidiaries:async function(){const{data:e}=await at.GetWithPagination({});this.subsidiary=e.data},getCustomers:async function(){const{data:e}=await xe.GetWithPagination({});this.customer=e.data},getCustomersBySubsidiaryId:async function(e){const{data:a}=await xe.Get("SUBSIDIARYID",e);return a.data},getContactsByCustomerId:async function(){const{data:e}=await tt.Get("CUSTOMERID",this.project.customerId);this.contact=e.data},updateProject:async function(e){const{data:a}=await me.Update(e).then(function(r){return r}).catch(function(r){return r.response});this.type=a.succeeded?"success":"error",this.message=a.succeeded?"El proyecto fue actualizado exitosamente.":a.errors[0].message,this.isVisible=!0}},async created(){var e=this.$route.params.id;await this.getProjectById(e).then(()=>this.getSubsidiaries()).then(()=>this.getCustomers()).then(()=>this.getContactsByCustomerId())}},st={id:"main-content"},dt={class:"container-fluid"},lt={class:"block-header"},ct={class:"row clearfix"};function ut(e,a,r,l,n,m){const w=o("bread-crumb"),b=o("DxItemToolbar"),P=o("DxToolbar"),c=o("DxLabel"),u=o("DxSimpleItem"),h=o("DxGroupItem"),k=o("DxForm"),g=o("DxItem"),v=o("ResourceTab"),R=o("TaskTab"),x=o("ActivityTab"),s=o("HourBankTab"),j=o("ManagerTab"),y=o("DxTabPanel"),p=o("DxToast"),d=o("DxLoadIndicator");return I(),T("div",st,[re("div",dt,[re("div",lt,[t(w)]),re("div",ct,[t(P,null,{default:i(()=>[t(b,{options:n.saveButtonOptions,location:"after","locate-in-menu":"auto",widget:"dxButton"},null,8,["options"])]),_:1}),n.showWhenLoad?(I(),ue(k,{key:0,id:"formProject","form-data":n.project,"col-count":2},{default:i(()=>[t(h,{caption:"Informaci\xF3n del Proyecto","col-count":2},{default:i(()=>[t(u,{"data-field":"name"},{default:i(()=>[t(c,{text:"Nombre"})]),_:1}),t(u,{"editor-options":{valueExpr:"id",searchEnabled:!0,items:n.subsidiary,displayExpr:"name",disabled:!0},"data-field":"subsidiaryId","editor-type":"dxSelectBox"},{default:i(()=>[t(c,{text:"Subsidiaria"})]),_:1},8,["editor-options"]),t(u,{"editor-options":{valueExpr:"id",searchEnabled:!0,items:n.customer,displayExpr:"name",disabled:!0},"data-field":"customerId","editor-type":"dxSelectBox"},{default:i(()=>[t(c,{text:"Cliente"})]),_:1},8,["editor-options"]),t(u,{"data-field":"description",caption:"Descripci\xF3n"},{default:i(()=>[t(c,{text:"Descripci\xF3n"})]),_:1}),t(u,{"editor-options":{valueExpr:"id",searchEnabled:!0,items:n.contact,displayExpr:"names"},"data-field":"mainContactId","editor-type":"dxSelectBox"},{default:i(()=>[t(c,{text:"Contacto Principal"})]),_:1},8,["editor-options"]),t(u,{"editor-options":{valueExpr:"id",searchEnabled:!0,displayExpr:"value",items:n.projectType},"data-field":"catalogProjectTypeId","editor-type":"dxSelectBox"},{default:i(()=>[t(c,{text:"Tipo de Proyecto"})]),_:1},8,["editor-options"]),t(u,{"editor-options":{valueExpr:"id",searchEnabled:!0,displayExpr:"value",items:n.projectCategory},"data-field":"catalogProjectCategoryId","editor-type":"dxSelectBox"},{default:i(()=>[t(c,{text:"Categoria de Proyecto"})]),_:1},8,["editor-options"]),t(u,{"editor-options":{valueExpr:"id",searchEnabled:!0,displayExpr:"value",items:n.projectState},"data-field":"catalogProjectStateId","editor-type":"dxSelectBox"},{default:i(()=>[t(c,{text:"Estado de Proyecto"})]),_:1},8,["editor-options"]),t(u,{"editor-options":{disabled:!0},"data-field":"costHourMenCustomer","editor-type":"dxNumberBox"},{default:i(()=>[t(c,{text:"Costo Hora Cliente"})]),_:1}),t(u,{"data-field":"costHourMenProject","editor-type":"dxNumberBox"},{default:i(()=>[t(c,{text:"Costo Hora Proyecto"})]),_:1})]),_:1}),t(h,{caption:"Tiempos del Proyecto","col-count":2},{default:i(()=>[t(u,{"editor-options":{type:"datetime"},"data-field":"startDate","editor-type":"dxDateBox"},{default:i(()=>[t(c,{text:"Fecha de Inicio"})]),_:1}),t(u,{"editor-options":{type:"datetime"},"data-field":"endDate","editor-type":"dxDateBox"},{default:i(()=>[t(c,{text:"Fecha de Fin"})]),_:1}),t(u,{"data-field":"durationHour"},{default:i(()=>[t(c,{text:"Duraci\xF3n"})]),_:1}),t(u,{"data-field":"closeDate","editor-type":"dxDateBox"},{default:i(()=>[t(c,{text:"Fecha de Cierre"})]),_:1})]),_:1})]),_:1},8,["form-data"])):pe("",!0),n.showWhenLoad?(I(),ue(y,{key:1,id:"tabPanelProject"},{"resource-tab":i(()=>[t(v,{"data-project":n.project},null,8,["data-project"])]),"task-tab":i(()=>[t(R,{"data-project":n.project},null,8,["data-project"])]),"activity-tab":i(()=>[t(x,{"data-project":n.project},null,8,["data-project"])]),"hourbank-tab":i(()=>[t(s,{"data-project":n.project},null,8,["data-project"])]),"projectmanager-tab":i(()=>[t(j,{"data-project":n.project},null,8,["data-project"])]),default:i(()=>[t(g,{title:"Recursos",template:"resource-tab"}),t(g,{title:"Tareas",template:"task-tab"}),t(g,{title:"Actividades",template:"activity-tab"}),t(g,{title:"Bolsa Horas",template:"hourbank-tab"}),t(g,{title:"Administradores",template:"projectmanager-tab"})]),_:1})):pe("",!0),t(p,{visible:n.isVisible,"onUpdate:visible":a[0]||(a[0]=D=>n.isVisible=D),message:n.message,"onUpdate:message":a[1]||(a[1]=D=>n.message=D),type:n.type,"onUpdate:type":a[2]||(a[2]=D=>n.type=D)},null,8,["visible","message","type"]),t(d,{id:"large-indicator",height:60,width:60,visible:n.loadIndicatorVisible},null,8,["visible"])])])])}var Rt=S(rt,[["render",ut]]);export{Rt as default};
