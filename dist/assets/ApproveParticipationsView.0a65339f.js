import{C as T}from"./index.3bbb47f2.js";import{B as k}from"./BreadCrumb.9367f10a.js";import{D as C}from"./validator.a755279e.js";import{a as B,b as I,c as q,d as A}from"./form.181df029.js";import{D as L}from"./select-box.029c2d7e.js";import{_ as N}from"./date-box.adbab50c.js";import{R as h}from"./RepositoryFactory.1ead146f.js";import{_ as M}from"./number-box.9a45bbe3.js";import{_ as V}from"./button.996b9c36.js";import{g as j,n as H,D as U,a as J,v as z,u as Y,c as K,d as W,l as $,e as Q,i as X,b as Z,h as ee,k as te}from"./data-grid.24b081de.js";import{c as oe}from"./CellLinkTemplate.75b044c2.js";import{c as s,g as ae,r,o as ie,a as re,f as e,w as n}from"./vendor.7710df40.js";import{_ as ne}from"./index.7b655b97.js";const se="https://kameyo-api.azurewebsites.net",le=h.get("subsidiaries"),Ne=h.get("employees"),m=`${se}/api/FinancialParticipation`,f=h.get("financialParticipation");function ce(t){return t!=null&&t!==""}const de={name:"ApproveParticipationsView",components:{BreadCrumb:k,DxForm:B,DxSimpleItem:I,DxGroupItem:q,DxLabel:A,DxNumberBox:M,DxRequiredRule:C,DxPopup:j,DxExport:H,DxSelectBox:L,DxDateBox:N,DxButton:V,DxDataGrid:U,DxColumn:J,DxGrouping:z,DxGroupPanel:Y,DxPager:K,DxPaging:W,DxSearchPanel:$,DxEditing:Q,DxFilterRow:X,DxScrolling:Z,DxLookup:ee,DxHeaderFilter:te,cellLink:oe},data(){return{idSubsidiary:0,years:[],dataSource:{},employeeParentId:"78ebf29f-dcfe-4e3c-bf77-069b158262e8",subsidiary:[],months:[],year:0,month:0,searchModeOption:"contains",searchExprOption:"name",searchTimeoutOption:200,minSearchLengthOption:0,showDataBeforeSearchOption:!1,saleAmountFormat:{style:"currency",currency:"USD",useGrouping:!0,minimumSignificantDigits:3}}},methods:{subsidiaryChange:async function(t){let a=[];a.skip=0,a.take=0,a.requireTotalCount=!0,a.filter='["subsidiaryId","=","'+t.value+'"]'},loadPeriods:async function(){const t=["(Todos)","Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];let a=new Date;for(let i=0;i<=12;i++)this.months=[...this.months,{value:i,text:t[i]}];this.years=[{value:0,text:"(Todos)"}];for(let i=a.getFullYear()-4;i<=a.getFullYear();i++)this.years=[...this.years,{value:i,text:`${i}`}]},changeHandle:async function(){await this.loadDataSource(),console.log("changeHandle")},getSubsidiaries:async function(){const{data:t}=await le.GetWithPagination({});this.subsidiary=t.data},loadDataSource:async function(){this.dataSource=new T({key:"id",load:t=>{let a={};return["skip","take","requireTotalCount","requireGroupCount","sort","filter","totalSummary","group","groupSummary"].forEach(i=>{i in t&&ce(t[i])&&(a[i]=JSON.stringify(t[i]))}),console.log(a),this.sendRequest(`${m}/filter/parent/${this.employeeParentId}/${this.year}/${this.month}/A`,"GET",a).then(i=>(console.log("sendrequet",i),i.data.map(u=>{u.status_str=f.GetStatus(u.status).value,u.tipo_str=f.GetType(u.type).value}),console.log(i),i))},insert:t=>(t.ProjectTaskId=this.idTask,t.ProjectId=this.idProject,console.log("insert",t),this.sendRequest(`${m}`,"POST",{values:JSON.stringify(t)})),update:(t,a)=>(a.id=t,console.log("update",a),this.sendRequest(`${m}`,"PUT",{key:t,values:JSON.stringify(a)})),remove:t=>this.sendRequest(`${m}/${t}`,"DELETE",{}),byKey:t=>this.sendRequest(`${m}`,"GET",{Field:"ID",Value:t}).then(a=>a)}),console.log("datasource",this.dataSource.load)},sendRequest(t,a="GET",i={}){const u=Object.keys(i).map(o=>`${encodeURIComponent(o)}=${encodeURIComponent(i[o])}`).join("&");return a==="GET"?fetch(`${t}?${u}`,{method:a}).then(o=>o.json().then(l=>{if(o.ok)return l.data;throw l.Message})):fetch(t,{method:a,body:i.values,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(o=>o.ok?o.text().then(l=>l&&JSON.parse(l)):o.json().then(l=>{throw l.Message}))}},async mounted(){await this.loadPeriods(),this.year=0,this.month=0,await this.loadDataSource()}},ue={id:"main-content"},pe={class:"container-fluid"},me={class:"block-header"},he={class:"row clearfix"},xe={class:"col-md-12 cont"},_e={class:"dx-field"},fe=s("div",{class:"dx-field-label"},"A\xF1o",-1),De={class:"dx-field-value"},ge={class:"dx-field"},ye=s("div",{class:"dx-field-label"},"Mes",-1),be={class:"dx-field-value"},we={class:"row clearfix"},ve={class:"col-md-12 cont"},Se=ae(" s ");function Pe(t,a,i,u,o,l){const D=r("bread-crumb"),x=r("DxSelectBox"),_=r("DxGroupItem"),g=r("DxForm"),y=r("DxHeaderFilter"),b=r("DxGroupPanel"),w=r("DxGrouping"),v=r("DxExport"),S=r("DxSearchPanel"),P=r("DxFilterRow"),G=r("DxScrolling"),R=r("DxPaging"),F=r("DxPager"),c=r("DxRequiredRule"),d=r("DxColumn"),E=r("cellLink"),O=r("DxDataGrid");return ie(),re("div",ue,[s("div",pe,[s("div",me,[e(D)]),s("div",he,[s("div",xe,[e(g,{"form-data":t.project,"col-count":2},{default:n(()=>[e(_,{"col-count":1},{default:n(()=>[s("div",_e,[fe,s("div",De,[e(x,{items:o.years,onValueChanged:l.changeHandle,"display-expr":"text",value:o.year,"onUpdate:value":a[0]||(a[0]=p=>o.year=p),"value-expr":"value","search-enable":"true","search-enabled":!0,"search-mode":o.searchModeOption,"search-expr":o.searchExprOption,"search-timeout":o.searchTimeoutOption,"min-search-length":o.minSearchLengthOption,"show-data-before-search":o.showDataBeforeSearchOption},null,8,["items","onValueChanged","value","search-mode","search-expr","search-timeout","min-search-length","show-data-before-search"])])])]),_:1}),e(_,{"col-count":1},{default:n(()=>[s("div",ge,[ye,s("div",be,[e(x,{items:o.months,onValueChanged:l.changeHandle,"display-expr":"text",value:o.month,"onUpdate:value":a[1]||(a[1]=p=>o.month=p),"value-expr":"value","search-enable":"true","search-enabled":!0,"search-mode":o.searchModeOption,"search-expr":o.searchExprOption,"search-timeout":o.searchTimeoutOption,"min-search-length":o.minSearchLengthOption,"show-data-before-search":o.showDataBeforeSearchOption},null,8,["items","onValueChanged","value","search-mode","search-expr","search-timeout","min-search-length","show-data-before-search"])])])]),_:1})]),_:1},8,["form-data"])])]),s("div",we,[s("div",ve,[e(O,{id:"dataGridActivities","show-borders":!0,"data-source":o.dataSource,"column-auto-width":!1,"repaint-changes-only":!0,"remote-operations":!0},{"cell-link-template":n(({data:p})=>[e(E,{"cell-data":p,routePath:{name:"DirectParticipation",params:{id:p.data.id}}},null,8,["cell-data","routePath"])]),default:n(()=>[e(y,{visible:!0}),e(b,{visible:!0}),e(w,{"auto-expand-all":!0}),e(v,{enabled:!0,"allow-export-selected-data":!0}),e(S,{visible:!0,width:240,placeholder:"Buscar..."}),e(P,{visible:!0}),e(G,{"row-rendering-mode":"virtual"}),e(R,{"page-size":10}),e(F,{visible:!0,"allowed-page-sizes":[10,20,50],"display-mode":t.displayMode,"show-page-size-selector":!0,"show-info":!1,"show-navigation-buttons":!0},null,8,["display-mode"]),e(d,{"allow-editing":!1,"data-field":"year",caption:"A\xF1o"},{default:n(()=>[e(c)]),_:1}),e(d,{"allow-editing":!1,"data-field":"month",caption:"Mes"},{default:n(()=>[e(c)]),_:1}),e(d,{"allow-editing":!1,"data-field":"date",caption:"Fecha"},{default:n(()=>[e(c)]),_:1}),e(d,{"allow-editing":!1,width:150,"data-field":"employee.fullName",caption:"Empleado"},{default:n(()=>[e(c)]),_:1}),e(d,{"allow-editing":!1,width:150,"data-field":"tipo_str",caption:"Tipo","cell-template":"cell-link-template"},{default:n(()=>[e(c)]),_:1}),e(d,{"allow-editing":!1,"data-field":"description",caption:"Detalle"},{default:n(()=>[e(c)]),_:1}),e(d,{"allow-editing":!1,"data-field":"status_str",caption:"Estado"},{default:n(()=>[e(c)]),_:1}),e(d,{"allow-editing":!1,format:o.saleAmountFormat,"data-field":"value",caption:"Valor"},{default:n(()=>[e(c)]),_:1},8,["format"])]),_:1},8,["data-source"])])]),Se])])}var Me=ne(de,[["render",Pe]]);export{Me as default};
