import{C as _}from"./index.3bbb47f2.js";import{B as j}from"./BreadCrumb.9367f10a.js";import{D as G}from"./validator.a755279e.js";import{a as P,b as O,c as F,d as E}from"./form.181df029.js";import{D as B}from"./select-box.029c2d7e.js";import{_ as M}from"./date-box.adbab50c.js";import{R as u}from"./RepositoryFactory.1ead146f.js";import{_ as I}from"./number-box.9a45bbe3.js";import{_ as q}from"./button.996b9c36.js";import{g as N,D as U,a as V,v as L,u as A,c as J,d as W,l as z,e as K,i as H,b as Y,h as Q,k as X}from"./data-grid.24b081de.js";import{_ as Z,a as $}from"./index.7b655b97.js";import{c as r,r as c,o as ee,a as te,f as s,w as d}from"./vendor.7710df40.js";const f="https://kameyo-api.azurewebsites.net",oe=u.get("subsidiaries"),ae=u.get("customers"),se=u.get("projects"),re=u.get("projectTasks"),ie=u.get("projectReport"),Ve=`${f}/api/taskactivities`,y=`${f}/api/employee`,b=`${f}/api/projectTasks`,x=`${f}/api/ProjectReport`;function ne(o){return o!=null&&o!==""}const ce={name:"ActivitiesView",components:{BreadCrumb:j,DxForm:P,DxSimpleItem:O,DxGroupItem:F,DxLabel:E,DxNumberBox:I,DxRequiredRule:G,DxPopup:N,DxSelectBox:B,DxDateBox:M,DxButton:q,DxDataGrid:U,DxColumn:V,DxGrouping:L,DxGroupPanel:A,DxPager:J,DxPaging:W,DxSearchPanel:z,DxEditing:K,DxFilterRow:H,DxScrolling:Y,DxLookup:Q,DxHeaderFilter:X},data(){return{idSubsidiary:0,idCustomer:0,idProject:0,idTask:0,years:[],months:[],year:0,userName:"",month:0,dataSource:{},subsidiary:[],customer:[],project:[],task:[],searchModeOption:"contains",searchExprOption:"name",searchTimeoutOption:200,minSearchLengthOption:0,showDataBeforeSearchOption:!1,employee:new _({key:"id",load:()=>this.sendRequest(`${y}/paginated`,"GET",{}).then(o=>{let e=o.map(a=>({id:a.id,name:`${a.lastName} ${a.names}`}));return console.log("carga",e),e}),byKey:o=>this.sendRequest(`${y}`,"GET",{Field:"ID",Value:o}).then(e=>e.map(i=>({id:i.id,name:`${i.lastName} ${i.names}`})))}),projects:new _({key:"id",load:()=>this.sendRequest(`${b}/paginated`,"GET",{}).then(o=>o),byKey:o=>this.sendRequest(`${b}`,"GET",{Field:"ID",Value:o}).then(e=>e)})}},methods:{subsidiaryChange:async function(o){this.customer=null,this.project=[],this.task=[];let e=[];e.skip=0,e.take=0,e.requireTotalCount=!0,e.filter='["subsidiaryId","=","'+o.value+'"]';const{data:a}=await ae.GetWithFilter(e);this.customer=a.data.data,this.idCustomer=0,this.idProject=0,this.idTask=0},customerChange:async function(o){this.project=[],this.task=[],this.dataSource={};let e=[];e.skip=0,e.take=0,e.requireTotalCount=!0,e.filter='["CustomerId","=","'+o.value+'"]';const{data:a}=await se.GetWithFilter(e);this.project=a.data.data,this.idProject=0,this.idTask=0},validateUser:async function(){const o=$();if(o.isAuthenticated){const e=o.getAuthenticatedUser;this.userName=e.userName,console.log(this.userName)}},projectChange:async function(o){this.task=[];let e=[];this.dataSource={},e.skip=0,e.take=0,e.requireTotalCount=!0,e.filter='["projectId","=","'+o.value+'"]';const{data:a}=await re.GetWithFilter(e);this.task=a.data.data,this.idTask=0},taskChange:async function(o){},getSubsidiaries:async function(){const{data:o}=await oe.GetWithPagination({});this.subsidiary=o.data},handleSearch:async function(o){console.log("buscar",o),this.loadDataSource(22)},right:(o,e)=>o.substr(o.length-e,o.length),loadPeriods:async function(){const o=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];let e=new Date;for(let a=0;a<12;a++)this.months=[...this.months,{value:a+1,text:o[a]}];for(let a=2018;a<=e.getFullYear();a++)this.years=[...this.years,{value:a,text:`${a}`}]},loadDataSource:async function(o){console.log("carga data",this.year,this.month,this.idCustomer),this.year!=0&&this.month!=0&&this.idCustomer!=0&&(this.dataSource=new _({key:"id",load:e=>{console.log(e,e.filter,e.length);let a={};return["skip","take","requireTotalCount","requireGroupCount","sort","filter","totalSummary","group","groupSummary"].forEach(i=>{i in e&&ne(e[i])&&(a[i]=JSON.stringify(e[i]))}),console.log(a),this.sendRequest(`${x}/generator/${this.idCustomer}/${this.year}/${this.month}`,"GET",a).then(i=>(console.log(ie),console.log("datos,",`${x}/generator/${this.idCustomer}/${this.year}/${this.month}`,i),{data:i,totalCount:i.length}))},byKey:e=>this.sendRequest(`${x}`,"GET",{Field:"ID",Value:e}).then(a=>a),update:(e,a)=>{const i=new Date;return a.ProjectId=e,a.ProjectReportDate=i,a.state="G",a.by=this.userName,a.year=this.year,a.month=this.month,a.Period=this.periodo,console.log(e,a),this.sendRequest(`${x}`,"POST",{values:JSON.stringify(a)})}}))},addMonth:(o,e)=>new Date(o.setMonth(o.getMonth()+e)),sendRequest(o,e="GET",a={}){const i=Object.keys(a).map(t=>`${encodeURIComponent(t)}=${encodeURIComponent(a[t])}`).join("&");return e==="GET"?fetch(`${o}?${i}`,{method:e}).then(t=>t.json().then(n=>{if(t.ok)return n.data;throw n.Message})):fetch(o,{method:e,body:a.values,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(t=>t.ok?t.text().then(n=>n&&JSON.parse(n)):t.json().then(n=>{throw n.Message}))}},async mounted(){await this.validateUser(),await this.getSubsidiaries(),await this.loadDataSource(22),await this.loadPeriods();let o=new Date;this.year=o.getFullYear(),this.month=o.getMonth()+1}},de={id:"main-content"},le={class:"container-fluid"},he={class:"block-header"},ue={class:"row clearfix"},me={class:"col-md-12 cont"},pe={class:"dx-field"},xe=r("div",{class:"dx-field-label"},"Subsidiaria",-1),fe={class:"dx-field-value"},_e={class:"dx-field"},ge=r("div",{class:"dx-field-label"},"Cliente",-1),De={class:"dx-field-value"},ye={class:"dx-field"},be=r("div",{class:"dx-field-label"},"A\xF1o",-1),we={class:"dx-field-value"},ve={class:"dx-field"},Se=r("div",{class:"dx-field-label"},"Mes",-1),Ce={class:"dx-field-value"},Re={class:"row clearfix"},ke={class:"col-md-12 cont"};function Te(o,e,a,i,t,n){const w=c("bread-crumb"),m=c("DxSelectBox"),g=c("DxGroupItem"),v=c("DxForm"),p=c("DxRequiredRule"),h=c("DxColumn"),D=c("DxButton"),S=c("DxFilterRow"),C=c("DxScrolling"),R=c("DxPaging"),k=c("DxEditing"),T=c("DxDataGrid");return ee(),te("div",de,[r("div",le,[r("div",he,[s(w)]),r("div",ue,[r("div",me,[s(v,{"form-data":t.project,"col-count":2},{default:d(()=>[s(g,{"col-count":2},{default:d(()=>[r("div",pe,[xe,r("div",fe,[s(m,{items:t.subsidiary,onValueChanged:n.subsidiaryChange,"display-expr":"name",value:t.idSubsidiary,"onUpdate:value":e[0]||(e[0]=l=>t.idSubsidiary=l),"search-enabled":!0,"search-mode":t.searchModeOption,"search-expr":t.searchExprOption,"search-timeout":t.searchTimeoutOption,"min-search-length":t.minSearchLengthOption,"show-data-before-search":t.showDataBeforeSearchOption,"value-expr":"id"},null,8,["items","onValueChanged","value","search-mode","search-expr","search-timeout","min-search-length","show-data-before-search"])])]),r("div",_e,[ge,r("div",De,[s(m,{items:t.customer,onValueChanged:n.loadDataSource,"display-expr":"name",value:t.idCustomer,"onUpdate:value":e[1]||(e[1]=l=>t.idCustomer=l),"value-expr":"id","data-field":"Position","search-enable":"true",id:"idcustomer","search-enabled":!0,"search-mode":t.searchModeOption,"search-expr":t.searchExprOption,"search-timeout":t.searchTimeoutOption,"min-search-length":t.minSearchLengthOption,"show-data-before-search":t.showDataBeforeSearchOption},null,8,["items","onValueChanged","value","search-mode","search-expr","search-timeout","min-search-length","show-data-before-search"])])])]),_:1}),s(g,{"col-count":3},{default:d(()=>[r("div",ye,[be,r("div",we,[s(m,{items:t.years,onValueChanged:n.loadDataSource,"display-expr":"text",value:t.year,"onUpdate:value":e[2]||(e[2]=l=>t.year=l),"value-expr":"value","search-enable":"true","search-enabled":!0,"search-mode":t.searchModeOption,"search-expr":t.searchExprOption,"search-timeout":t.searchTimeoutOption,"min-search-length":t.minSearchLengthOption,"show-data-before-search":t.showDataBeforeSearchOption},null,8,["items","onValueChanged","value","search-mode","search-expr","search-timeout","min-search-length","show-data-before-search"])])]),r("div",ve,[Se,r("div",Ce,[s(m,{items:t.months,onValueChanged:n.loadDataSource,"display-expr":"text",value:t.month,"onUpdate:value":e[3]||(e[3]=l=>t.month=l),"value-expr":"value","search-enable":"true","search-enabled":!0,"search-mode":t.searchModeOption,"search-expr":t.searchExprOption,"search-timeout":t.searchTimeoutOption,"min-search-length":t.minSearchLengthOption,"show-data-before-search":t.showDataBeforeSearchOption},null,8,["items","onValueChanged","value","search-mode","search-expr","search-timeout","min-search-length","show-data-before-search"])])])]),_:1})]),_:1},8,["form-data"])]),r("div",Re,[r("div",ke,[s(T,{id:"dataGridActivities","show-borders":!0,"data-source":t.dataSource,"column-auto-width":!0,"repaint-changes-only":!0,"remote-operations":!0},{default:d(()=>[s(h,{"allow-editing":!1,width:300,"data-field":"name",caption:"Nombre"},{default:d(()=>[s(p)]),_:1}),s(h,{"allow-editing":!1,"data-field":"startDate","data-type":"date",format:"yyyy-MM-dd",caption:"Fecha Inicio"},{default:d(()=>[s(p)]),_:1}),s(h,{"allow-editing":!1,"data-field":"endDate","data-type":"date",format:"yyyy-MM-dd",caption:"Fecha Fin"},{default:d(()=>[s(p)]),_:1}),s(h,{width:150,alignment:"center","data-field":"InProjectReport",caption:"Generar",editorType:"dxCheckBox"},{default:d(()=>[s(p)]),_:1}),s(h,{type:"buttons",width:110},{default:d(()=>[s(D,{name:"delete"}),s(D,{hint:"Clone",icon:"copy"})]),_:1}),s(k,{"allow-updating":!0,"refresh-mode":"full",mode:"row"},{default:d(()=>[s(S,{visible:!0}),s(C,{"row-rendering-mode":"virtual"}),s(R,{"page-size":10})]),_:1})]),_:1},8,["data-source"])])])])])])}var Le=Z(ce,[["render",Te]]);export{Le as default};
