import{C as f}from"./index.3bbb47f2.js";import{B}from"./BreadCrumb.9367f10a.js";import{D as I}from"./validator.a755279e.js";import{a as M,b as V,c as q,d as L}from"./form.181df029.js";import{D as H}from"./select-box.029c2d7e.js";import{_ as N}from"./date-box.adbab50c.js";import{R as x}from"./RepositoryFactory.1ead146f.js";import{_ as A}from"./number-box.9a45bbe3.js";import{_ as U}from"./button.996b9c36.js";import{g as j,n as J,D as z,a as W,v as Y,u as K,c as Q,d as X,l as Z,e as $,i as ee,b as te,h as oe,k as ae,F as se,G as ie}from"./data-grid.24b081de.js";import{c as re}from"./CellLinkTemplate.75b044c2.js";import{c as r,g as ne,r as i,o as le,a as ce,f as t,w as n}from"./vendor.7710df40.js";import{_ as de}from"./index.7b655b97.js";const ue="https://kameyo-api.azurewebsites.net",he=x.get("subsidiaries"),me=x.get("employees"),m=`${ue}/api/FinancialParticipation`,D=x.get("financialParticipation");function pe(o){return o!=null&&o!==""}const xe={name:"ActivitiesView",components:{BreadCrumb:B,DxForm:M,DxSimpleItem:V,DxGroupItem:q,DxLabel:L,DxNumberBox:A,DxRequiredRule:I,DxPopup:j,DxExport:J,DxSelectBox:H,DxDateBox:N,DxButton:U,DxDataGrid:z,DxColumn:W,DxGrouping:Y,DxGroupPanel:K,DxPager:Q,DxPaging:X,DxSearchPanel:Z,DxEditing:$,DxFilterRow:ee,DxScrolling:te,DxLookup:oe,DxHeaderFilter:ae,DxSummary:se,DxTotalItem:ie,cellLink:re},data(){return{idSubsidiary:0,idEmployee:null,years:[],dataSource:{},subsidiary:[],employee:[],months:[],year:0,month:0,searchModeOption:"contains",searchExprOption:"name",searchTimeoutOption:200,minSearchLengthOption:0,showDataBeforeSearchOption:!1,saleAmountFormat:{style:"currency",currency:"USD",useGrouping:!0,minimumSignificantDigits:3}}},methods:{subsidiaryChange:async function(o){this.employee=[];let a=[];a.skip=0,a.take=0,a.requireTotalCount=!0,a.filter='["subsidiaryId","=","'+o.value+'"]';const{data:s}=await me.GetWithFilter(a);this.employee=s.data},loadPeriods:async function(){const o=["(Todos)","Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];let a=new Date;for(let s=0;s<=12;s++)this.months=[...this.months,{value:s,text:o[s]}];this.years=[{value:0,text:"(Todos)"}];for(let s=a.getFullYear()-4;s<=a.getFullYear();s++)this.years=[...this.years,{value:s,text:`${s}`}]},changeHandle:async function(){this.year>=0&&this.month>=0&&this.idEmployee!=null?(await this.loadDataSource(),console.log("changeHandle")):(console.log("changeHandle else"),this.dataSource=new f)},getSubsidiaries:async function(){const{data:o}=await he.GetWithPagination({});this.subsidiary=o.data},loadDataSource:async function(){this.dataSource=new f({key:"id",load:o=>{let a={};return["skip","take","requireTotalCount","requireGroupCount","sort","filter","totalSummary","group","groupSummary"].forEach(s=>{s in o&&pe(o[s])&&(a[s]=JSON.stringify(o[s]))}),console.log(a),this.sendRequest(`${m}/filter/${this.idEmployee}/${this.year}/${this.month}`,"GET",a).then(s=>(console.log("sendrequet",s),s.data.map(d=>{d.status_str=D.GetStatus(d.status).value,d.tipo_str=D.GetType(d.type).value}),s))},insert:o=>(o.ProjectTaskId=this.idTask,o.ProjectId=this.idProject,console.log("insert",o),this.sendRequest(`${m}`,"POST",{values:JSON.stringify(o)})),update:(o,a)=>(a.id=o,console.log("update",a),this.sendRequest(`${m}`,"PUT",{key:o,values:JSON.stringify(a)})),remove:o=>this.sendRequest(`${m}/${o}`,"DELETE",{}),byKey:o=>this.sendRequest(`${m}`,"GET",{Field:"ID",Value:o}).then(a=>a)}),console.log("datasource",this.dataSource.load)},sendRequest(o,a="GET",s={}){const d=Object.keys(s).map(e=>`${encodeURIComponent(e)}=${encodeURIComponent(s[e])}`).join("&");return a==="GET"?fetch(`${o}?${d}`,{method:a}).then(e=>e.json().then(l=>{if(e.ok)return l.data;throw l.Message})):fetch(o,{method:a,body:s.values,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(e=>e.ok?e.text().then(l=>l&&JSON.parse(l)):e.json().then(l=>{throw l.Message}))}},async mounted(){await this.getSubsidiaries(),await this.loadPeriods(),this.year=0,this.month=0}},_e={id:"main-content"},fe={class:"container-fluid"},De={class:"block-header"},ge={class:"row clearfix"},ye={class:"col-md-12 cont"},be={class:"dx-field"},ve=r("div",{class:"dx-field-label"},"Subsidiaria",-1),Se={class:"dx-field-value"},we={class:"dx-field"},Pe=r("div",{class:"dx-field-label"},"Empleado",-1),Oe={class:"dx-field-value"},Ee={class:"dx-field"},Ge=r("div",{class:"dx-field-label"},"A\xF1o",-1),Te={class:"dx-field-value"},Fe={class:"dx-field"},Re=r("div",{class:"dx-field-label"},"Mes",-1),Ce={class:"dx-field-value"},ke={class:"row clearfix"},Be={class:"col-md-12 cont"},Ie=ne(" s ");function Me(o,a,s,d,e,l){const g=i("bread-crumb"),p=i("DxSelectBox"),_=i("DxGroupItem"),y=i("DxForm"),b=i("DxHeaderFilter"),v=i("DxGroupPanel"),S=i("DxGrouping"),w=i("DxExport"),P=i("DxSearchPanel"),O=i("DxFilterRow"),E=i("DxScrolling"),G=i("DxPaging"),T=i("DxPager"),u=i("DxRequiredRule"),h=i("DxColumn"),F=i("DxTotalItem"),R=i("DxSummary"),C=i("cellLink"),k=i("DxDataGrid");return le(),ce("div",_e,[r("div",fe,[r("div",De,[t(g)]),r("div",ge,[r("div",ye,[t(y,{"form-data":o.project,"col-count":2},{default:n(()=>[t(_,{"col-count":2},{default:n(()=>[r("div",be,[ve,r("div",Se,[t(p,{items:e.subsidiary,onValueChanged:l.subsidiaryChange,"display-expr":"name",value:e.idSubsidiary,"onUpdate:value":a[0]||(a[0]=c=>e.idSubsidiary=c),"search-enabled":!0,"search-mode":e.searchModeOption,"search-expr":e.searchExprOption,"search-timeout":e.searchTimeoutOption,"min-search-length":e.minSearchLengthOption,"show-data-before-search":e.showDataBeforeSearchOption,"value-expr":"id"},null,8,["items","onValueChanged","value","search-mode","search-expr","search-timeout","min-search-length","show-data-before-search"])])]),r("div",we,[Pe,r("div",Oe,[t(p,{items:e.employee,onValueChanged:l.changeHandle,"display-expr":"fullName",value:e.idEmployee,"onUpdate:value":a[1]||(a[1]=c=>e.idEmployee=c),"value-expr":"id","data-field":"Position","search-enable":"true",id:"idemployee","search-enabled":!0,"search-mode":e.searchModeOption,"search-expr":e.searchExprOption,"search-timeout":e.searchTimeoutOption,"min-search-length":e.minSearchLengthOption,"show-data-before-search":e.showDataBeforeSearchOption},null,8,["items","onValueChanged","value","search-mode","search-expr","search-timeout","min-search-length","show-data-before-search"])])])]),_:1}),t(_,{"col-count":3},{default:n(()=>[r("div",Ee,[Ge,r("div",Te,[t(p,{items:e.years,onValueChanged:l.changeHandle,"display-expr":"text",value:e.year,"onUpdate:value":a[2]||(a[2]=c=>e.year=c),"value-expr":"value","search-enable":"true","search-enabled":!0,"search-mode":e.searchModeOption,"search-expr":e.searchExprOption,"search-timeout":e.searchTimeoutOption,"min-search-length":e.minSearchLengthOption,"show-data-before-search":e.showDataBeforeSearchOption},null,8,["items","onValueChanged","value","search-mode","search-expr","search-timeout","min-search-length","show-data-before-search"])])]),r("div",Fe,[Re,r("div",Ce,[t(p,{items:e.months,onValueChanged:l.changeHandle,"display-expr":"text",value:e.month,"onUpdate:value":a[3]||(a[3]=c=>e.month=c),"value-expr":"value","search-enable":"true","search-enabled":!0,"search-mode":e.searchModeOption,"search-expr":e.searchExprOption,"search-timeout":e.searchTimeoutOption,"min-search-length":e.minSearchLengthOption,"show-data-before-search":e.showDataBeforeSearchOption},null,8,["items","onValueChanged","value","search-mode","search-expr","search-timeout","min-search-length","show-data-before-search"])])])]),_:1})]),_:1},8,["form-data"])])]),r("div",ke,[r("div",Be,[t(k,{id:"dataGridActivities","show-borders":!0,"data-source":e.dataSource,"column-auto-width":!1,"repaint-changes-only":!0,"remote-operations":!0},{"cell-link-template":n(({data:c})=>[t(C,{"cell-data":c,routePath:{name:"DirectParticipation",params:{id:c.data.id}}},null,8,["cell-data","routePath"])]),default:n(()=>[t(b,{visible:!0}),t(v,{visible:!0}),t(S,{"auto-expand-all":!0}),t(w,{enabled:!0,"allow-export-selected-data":!0}),t(P,{visible:!0,width:240,placeholder:"Buscar..."}),t(O,{visible:!0}),t(E,{"row-rendering-mode":"virtual"}),t(G,{"page-size":10}),t(T,{visible:!0,"allowed-page-sizes":[10,20,50],"display-mode":o.displayMode,"show-page-size-selector":!0,"show-info":!1,"show-navigation-buttons":!0},null,8,["display-mode"]),t(h,{"allow-editing":!1,"data-field":"year",caption:"A\xF1o"},{default:n(()=>[t(u)]),_:1}),t(h,{"allow-editing":!1,"data-field":"month",caption:"Mes"},{default:n(()=>[t(u)]),_:1}),t(h,{"allow-editing":!1,"data-type":"date",format:"yyyy-MM-dd HH:mm:ss","data-field":"date",caption:"Fecha"},{default:n(()=>[t(u)]),_:1}),t(h,{"allow-editing":!1,"data-field":"tipo_str",caption:"Tipo","cell-template":"cell-link-template"},{default:n(()=>[t(u)]),_:1}),t(h,{"allow-editing":!1,"data-field":"description",caption:"Detalle"},{default:n(()=>[t(u)]),_:1}),t(h,{"allow-editing":!1,"data-field":"status_str",caption:"Estado"},{default:n(()=>[t(u)]),_:1}),t(h,{"allow-editing":!1,format:e.saleAmountFormat,width:150,"data-field":"value",caption:"Valor"},{default:n(()=>[t(u)]),_:1},8,["format"]),t(R,null,{default:n(()=>[t(F,{column:"value","summary-type":"sum"})]),_:1})]),_:1},8,["data-source"])])]),Ie])])}var Qe=de(xe,[["render",Me]]);export{Qe as default};
